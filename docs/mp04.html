<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Mini Project 4 – STA 9750 2024 Submission Material</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link href="site_libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="site_libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="site_libs/datatables-binding-0.33/datatables.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="site_libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="site_libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="site_libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script>
<link href="site_libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">
<script src="site_libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">STA 9750 2024 Submission Material</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-projects" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Projects</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-projects">    
        <li>
    <a class="dropdown-item" href="./mp01.html">
 <span class="dropdown-text">Mini Project 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./mp02.html">
 <span class="dropdown-text">Mini Project 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./mp03.html">
 <span class="dropdown-text">Mini Project 3</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="./contact.html"> 
<span class="menu-text">Contact</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Mini Project 4</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>In this project, we will use R to make an important personal financial decision. New faculty hired at CUNY have 30 days to choose one of two retirement plans. This is an important and early choice that faculty must make, as it is essentially permanent and cannot be changed. Financial forecasting is quite difficult, and it is far from clear which plan is the better long-term choice. In this mini-project, we will use historical financial data and a bootstrap inference strategy to estimate the probability that one plan is better than the other.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gt)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span> (tidyverse)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DT)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(striprtf)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr2)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tibble)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>First, let’s start by creating our API keys to retrieve the datasets from Alpha Vantage and FRED. <a href="https://www.alphavantage.co/support/#api-key">Alpha Vantage</a> and <a href="https://fredaccount.stlouisfed.org/login/secure/">FRED</a>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>alpha_vantage_key <span class="ot">&lt;-</span> <span class="fu">read_rtf</span>(<span class="st">"~/STA9750-2024-FALL/API key.rtf"</span>) </span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>fred_key <span class="ot">&lt;-</span> <span class="fu">read_rtf</span>(<span class="st">"~/STA9750-2024-FALL/FRED API key.rtf"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="set-up-and-exploration" class="level1">
<h1>Set-Up and Exploration</h1>
<section id="data-acquisition" class="level2">
<h2 class="anchored" data-anchor-id="data-acquisition">Data Acquisition</h2>
<p>To begin your Monte Carlo analysis, you will need historical data covering (at a minimum) the following:</p>
<ul>
<li>Wage growth</li>
<li>Inflation</li>
<li>US Equity Market total returns</li>
<li>International Equity Market total returns</li>
<li>Bond market total returns</li>
<li>Short-term debt returns</li>
</ul>
<ol type="1">
<li>Wage Growth</li>
</ol>
<p>I will use the dataset from FRED that shows the <a href="https://fred.stlouisfed.org/series/CEU0500000003">Average Hourly Earnings of All Employees</a> to gather data history for wage growth.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fetch Wage Growth data</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>wage_growth_response <span class="ot">&lt;-</span> <span class="fu">request</span>(<span class="st">"https://api.stlouisfed.org/fred/series/observations"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_url_query</span>(<span class="at">series_id =</span> <span class="st">"CES0500000003"</span>,</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">api_key =</span> fred_key,</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">file_type =</span> <span class="st">"json"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_perform</span>()</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Parse JSON response</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>wage_data <span class="ot">&lt;-</span> wage_growth_response <span class="sc">|&gt;</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">resp_body_json</span>() <span class="sc">%&gt;%</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  .<span class="sc">$</span>observations</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>wage_growth_df <span class="ot">&lt;-</span> wage_data <span class="sc">|&gt;</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_dfr</span>(as_tibble) <span class="sc">|&gt;</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">date =</span> <span class="fu">as.Date</span>(date),</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">wage =</span> <span class="fu">as.numeric</span>(value)</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(date) <span class="sc">|&gt;</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate percentage change in wages</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">wage_growth =</span> (wage <span class="sc">/</span> <span class="fu">lag</span>(wage) <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date, wage_growth)</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to monthly data</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>wage_growth_monthly <span class="ot">&lt;-</span> wage_growth_df <span class="sc">|&gt;</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">year =</span> <span class="fu">year</span>(date),</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">month =</span> <span class="fu">month</span>(date)</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, month) <span class="sc">|&gt;</span></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">date =</span> <span class="fu">floor_date</span>(<span class="fu">first</span>(date), <span class="at">unit =</span> <span class="st">"month"</span>),</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">wage_growth =</span>  <span class="fu">median</span>(wage_growth, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),  <span class="co"># Median for robust aggregation</span></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(date)</span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>wage_growth_monthly <span class="ot">&lt;-</span> wage_growth_monthly <span class="sc">|&gt;</span></span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">wage_growth =</span> <span class="fu">pmin</span>(<span class="fu">pmax</span>(wage_growth, <span class="sc">-</span><span class="fl">0.1</span>), <span class="fl">0.1</span>)  <span class="co"># Cap between -10% and 10%</span></span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>wage_growth_df  <span class="ot">&lt;-</span> wage_growth_monthly <span class="sc">|&gt;</span> <span class="fu">select</span>(date, wage_growth)</span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a>wage_growth_df <span class="sc">|&gt;</span> DT<span class="sc">::</span><span class="fu">datatable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-ea5ad03b628a05adeb10" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-ea5ad03b628a05adeb10">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149","150","151","152","153","154","155","156","157","158","159","160","161","162","163","164","165","166","167","168","169","170","171","172","173","174","175","176","177","178","179","180","181","182","183","184","185","186","187","188","189","190","191","192","193","194","195","196","197","198","199","200","201","202","203","204","205","206","207","208","209","210","211","212","213","214","215","216","217","218","219","220","221","222","223","224","225"],["2006-03-01","2006-04-01","2006-05-01","2006-06-01","2006-07-01","2006-08-01","2006-09-01","2006-10-01","2006-11-01","2006-12-01","2007-01-01","2007-02-01","2007-03-01","2007-04-01","2007-05-01","2007-06-01","2007-07-01","2007-08-01","2007-09-01","2007-10-01","2007-11-01","2007-12-01","2008-01-01","2008-02-01","2008-03-01","2008-04-01","2008-05-01","2008-06-01","2008-07-01","2008-08-01","2008-09-01","2008-10-01","2008-11-01","2008-12-01","2009-01-01","2009-02-01","2009-03-01","2009-04-01","2009-05-01","2009-06-01","2009-07-01","2009-08-01","2009-09-01","2009-10-01","2009-11-01","2009-12-01","2010-01-01","2010-02-01","2010-03-01","2010-04-01","2010-05-01","2010-06-01","2010-07-01","2010-08-01","2010-09-01","2010-10-01","2010-11-01","2010-12-01","2011-01-01","2011-02-01","2011-03-01","2011-04-01","2011-05-01","2011-06-01","2011-07-01","2011-08-01","2011-09-01","2011-10-01","2011-11-01","2011-12-01","2012-01-01","2012-02-01","2012-03-01","2012-04-01","2012-05-01","2012-06-01","2012-07-01","2012-08-01","2012-09-01","2012-10-01","2012-11-01","2012-12-01","2013-01-01","2013-02-01","2013-03-01","2013-04-01","2013-05-01","2013-06-01","2013-07-01","2013-08-01","2013-09-01","2013-10-01","2013-11-01","2013-12-01","2014-01-01","2014-02-01","2014-03-01","2014-04-01","2014-05-01","2014-06-01","2014-07-01","2014-08-01","2014-09-01","2014-10-01","2014-11-01","2014-12-01","2015-01-01","2015-02-01","2015-03-01","2015-04-01","2015-05-01","2015-06-01","2015-07-01","2015-08-01","2015-09-01","2015-10-01","2015-11-01","2015-12-01","2016-01-01","2016-02-01","2016-03-01","2016-04-01","2016-05-01","2016-06-01","2016-07-01","2016-08-01","2016-09-01","2016-10-01","2016-11-01","2016-12-01","2017-01-01","2017-02-01","2017-03-01","2017-04-01","2017-05-01","2017-06-01","2017-07-01","2017-08-01","2017-09-01","2017-10-01","2017-11-01","2017-12-01","2018-01-01","2018-02-01","2018-03-01","2018-04-01","2018-05-01","2018-06-01","2018-07-01","2018-08-01","2018-09-01","2018-10-01","2018-11-01","2018-12-01","2019-01-01","2019-02-01","2019-03-01","2019-04-01","2019-05-01","2019-06-01","2019-07-01","2019-08-01","2019-09-01","2019-10-01","2019-11-01","2019-12-01","2020-01-01","2020-02-01","2020-03-01","2020-04-01","2020-05-01","2020-06-01","2020-07-01","2020-08-01","2020-09-01","2020-10-01","2020-11-01","2020-12-01","2021-01-01","2021-02-01","2021-03-01","2021-04-01","2021-05-01","2021-06-01","2021-07-01","2021-08-01","2021-09-01","2021-10-01","2021-11-01","2021-12-01","2022-01-01","2022-02-01","2022-03-01","2022-04-01","2022-05-01","2022-06-01","2022-07-01","2022-08-01","2022-09-01","2022-10-01","2022-11-01","2022-12-01","2023-01-01","2023-02-01","2023-03-01","2023-04-01","2023-05-01","2023-06-01","2023-07-01","2023-08-01","2023-09-01","2023-10-01","2023-11-01","2023-12-01","2024-01-01","2024-02-01","2024-03-01","2024-04-01","2024-05-01","2024-06-01","2024-07-01","2024-08-01","2024-09-01","2024-10-01","2024-11-01"],[null,0.004987531172069737,-0.0009925558312654514,0.004967709885742799,0.002965892239248591,0.001478560867422374,0.00442913385826782,0.0009799118079372171,0.002936857562408246,0.003904343582235237,0.000972289742343202,0.004371053909664857,0.002417794970986487,0.002411963338157186,0.002887391722810273,0.00527831094049902,0,0.002386634844868674,0.001904761904761854,0.0009505703422052481,0.002849002849002913,0.00236742424242431,0.001417099669343225,0.002830188679245449,0.00470366886171214,0.000936329588014928,0.004209541627689495,0.001863064741499887,0.004184100418409997,0.004629629629629539,0.0009216589861751334,0.001841620626151119,0.005055147058823595,0.003200731595793371,0.0009115770282588365,0.00136612021857907,0.00318326512050926,0.001359927470534927,0.0009053870529651675,0.001356852103120865,0.001806684733513864,0.002254283137962165,0.001799370220422869,0.001347103726986987,0.00224215246636783,0.0004474272930647949,0.002236135957066177,0.001784917447567924,0.0004454342984410165,0.001335707925200325,0.001778568252556845,0,0.002663115845539243,0.001328021248339972,0.002210433244915988,0.003087781208645612,-0.0004397537379067229,0.001319841619005668,0.004393673110720364,0.0004374453193352057,0,0.00174901617839951,0.003055434308162353,0.001305483028720689,0.003911342894393766,-0.001298701298701355,0.00216731686172511,0.003460207612456578,-0.0004310344827584967,0.001293661060801865,0.001291989664082838,0.00129032258064532,0.003436426116838476,0.001284246575342429,0.0004275331338177146,0.002564102564102555,0.001705029838022121,-0.0008510638297871687,0.003833049403747957,-0.0004242681374629909,0.002971137521222467,0.004231908590774491,0.0008428150021069225,0.001263157894736855,0.000841042893187538,0.002941176470588225,0.0008378718056136769,0.002930096274591953,0.0008347245409014992,0.001668056713928223,0.001665278934221526,0.001246882793017434,0.002905770029057786,0.0008278145695364003,0.002067824648469774,0.004127115146512539,-0.0004110152075625928,0.000822368421052655,0.002465078060805315,0.002459016393442814,0.0008176614881438837,0.002450980392156854,0.0004074979625101616,0.001221995926680153,0.003254678600488337,-0.001622060016220561,0.005280259951259136,0.001616161616161627,0.002823719241629608,0.001206757843926098,0.003214142225793415,0,0.00120144173007608,0.003600000000000048,0.0007971303308089706,0.003185981680605465,0.002381897578404013,-0.0003960396039605074,0.005546751188589605,0,0.002758077226162392,0.003143418467583592,0.001958480219349745,0.001563721657545036,0.002732240437158584,0.001167769560139975,0.001944012441679632,0.00465657741559955,0.0003862495171880198,0.0007722007722008595,0.003086419753086433,0.002692307692307772,0.0015343306482547,0.002297970126388549,0.001528467711119585,0.001907668828691422,0.003808073115003641,0.0007587253414262918,0.004169825625473855,0,0.001510003775009539,0.003015454202789147,0.004509582863585049,0.0007482229704451893,0.00411214953271033,0.001861504095308941,0.002601263470828785,0.002223869532987255,0.001849112426035582,0.004060538944259839,0.004411764705882337,0.001830161054172885,0.002557544757033181,0.004008746355685044,0.001451905626134176,0.004349401957230992,0.003247924936846003,-0.0007194244604316058,0.002879769618430394,0.003230437903804839,0.002504472271914082,0.003925767309064909,0.001421969427657377,0.002129925452609038,0.004250797024442088,0.000705467372134061,0.002467395135706818,0.003867791842475432,0.007705779334500784,0.04310045185957612,-0.009663445518160674,-0.01144010767160164,0,0.003403675970047759,0.001017639077340649,0.001016604540833521,0.0030467163168586,0.009112386095173841,0.001003344481605328,0.004343468092215197,0,0.004990019960079861,0.005958291956305928,0.004935834155972207,0.003601833660772824,0.003915171288743968,0.005849853753656209,0.00646203554119551,0.002889245585874889,0.00512163892445594,0.007324840764331153,0.0006323110970596346,0.006003159557661952,0.003454773869346672,0.00406885758998432,0.003740648379052525,0.004037267080745144,0.003402412619857742,0.003082614056720168,0.004917025199754343,0.003975535168195599,0.003350593968930893,0.003946569520340004,0.002419110976715988,0.004826546003016796,0.003902731912338586,0.002990430622009654,0.004770423375074717,0.004154302670623222,0.002068557919621572,0.002948982601002736,0.002646280505733678,0.003812316715542385,0.003213555360794818,0.004950495049504733,0.001448855404230676,0.003761574074073959,0.001729605073508278,0.00374100719424475,0.003153669724770714,0.002286367533580913,0.004277159965782706,0.003123225440090804,0.004245683555052393,0.00366403607666288]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>date<\/th>\n      <th>wage_growth<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":2},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"date","targets":1},{"name":"wage_growth","targets":2}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<ol start="2" type="1">
<li>Inflation</li>
</ol>
<p>For inflation; I selected the dataset from FRED, Consumer Price Index for <a href="https://fred.stlouisfed.org/series/CPIAUCSL">All Urban Consumers: All Items in U.S. City Average</a>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fetch Inflation data</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>inflation_response <span class="ot">&lt;-</span> <span class="fu">request</span>(<span class="st">"https://api.stlouisfed.org/fred/series/observations"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_url_query</span>(<span class="at">series_id =</span> <span class="st">"CPIAUCSL"</span>,</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">api_key =</span> fred_key,</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">file_type =</span> <span class="st">"json"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_perform</span>()</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Parse JSON response</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>inflation_data <span class="ot">&lt;-</span> inflation_response <span class="sc">|&gt;</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">resp_body_json</span>() <span class="sc">%&gt;%</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  .<span class="sc">$</span>observations</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to a data frame</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>inflation_df <span class="ot">&lt;-</span> inflation_data <span class="sc">|&gt;</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_dfr</span>(as_tibble) <span class="sc">|&gt;</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">date =</span> <span class="fu">as.Date</span>(date),</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">value =</span> <span class="fu">as.numeric</span>(value) <span class="co"># Convert CPI data to numeric</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date, <span class="at">CPI =</span> value)</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>inflation_df <span class="sc">|&gt;</span> DT<span class="sc">::</span><span class="fu">datatable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-d7286be52691d960c9a7" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-d7286be52691d960c9a7">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149","150","151","152","153","154","155","156","157","158","159","160","161","162","163","164","165","166","167","168","169","170","171","172","173","174","175","176","177","178","179","180","181","182","183","184","185","186","187","188","189","190","191","192","193","194","195","196","197","198","199","200","201","202","203","204","205","206","207","208","209","210","211","212","213","214","215","216","217","218","219","220","221","222","223","224","225","226","227","228","229","230","231","232","233","234","235","236","237","238","239","240","241","242","243","244","245","246","247","248","249","250","251","252","253","254","255","256","257","258","259","260","261","262","263","264","265","266","267","268","269","270","271","272","273","274","275","276","277","278","279","280","281","282","283","284","285","286","287","288","289","290","291","292","293","294","295","296","297","298","299","300","301","302","303","304","305","306","307","308","309","310","311","312","313","314","315","316","317","318","319","320","321","322","323","324","325","326","327","328","329","330","331","332","333","334","335","336","337","338","339","340","341","342","343","344","345","346","347","348","349","350","351","352","353","354","355","356","357","358","359","360","361","362","363","364","365","366","367","368","369","370","371","372","373","374","375","376","377","378","379","380","381","382","383","384","385","386","387","388","389","390","391","392","393","394","395","396","397","398","399","400","401","402","403","404","405","406","407","408","409","410","411","412","413","414","415","416","417","418","419","420","421","422","423","424","425","426","427","428","429","430","431","432","433","434","435","436","437","438","439","440","441","442","443","444","445","446","447","448","449","450","451","452","453","454","455","456","457","458","459","460","461","462","463","464","465","466","467","468","469","470","471","472","473","474","475","476","477","478","479","480","481","482","483","484","485","486","487","488","489","490","491","492","493","494","495","496","497","498","499","500","501","502","503","504","505","506","507","508","509","510","511","512","513","514","515","516","517","518","519","520","521","522","523","524","525","526","527","528","529","530","531","532","533","534","535","536","537","538","539","540","541","542","543","544","545","546","547","548","549","550","551","552","553","554","555","556","557","558","559","560","561","562","563","564","565","566","567","568","569","570","571","572","573","574","575","576","577","578","579","580","581","582","583","584","585","586","587","588","589","590","591","592","593","594","595","596","597","598","599","600","601","602","603","604","605","606","607","608","609","610","611","612","613","614","615","616","617","618","619","620","621","622","623","624","625","626","627","628","629","630","631","632","633","634","635","636","637","638","639","640","641","642","643","644","645","646","647","648","649","650","651","652","653","654","655","656","657","658","659","660","661","662","663","664","665","666","667","668","669","670","671","672","673","674","675","676","677","678","679","680","681","682","683","684","685","686","687","688","689","690","691","692","693","694","695","696","697","698","699","700","701","702","703","704","705","706","707","708","709","710","711","712","713","714","715","716","717","718","719","720","721","722","723","724","725","726","727","728","729","730","731","732","733","734","735","736","737","738","739","740","741","742","743","744","745","746","747","748","749","750","751","752","753","754","755","756","757","758","759","760","761","762","763","764","765","766","767","768","769","770","771","772","773","774","775","776","777","778","779","780","781","782","783","784","785","786","787","788","789","790","791","792","793","794","795","796","797","798","799","800","801","802","803","804","805","806","807","808","809","810","811","812","813","814","815","816","817","818","819","820","821","822","823","824","825","826","827","828","829","830","831","832","833","834","835","836","837","838","839","840","841","842","843","844","845","846","847","848","849","850","851","852","853","854","855","856","857","858","859","860","861","862","863","864","865","866","867","868","869","870","871","872","873","874","875","876","877","878","879","880","881","882","883","884","885","886","887","888","889","890","891","892","893","894","895","896","897","898","899","900","901","902","903","904","905","906","907","908","909","910","911","912","913","914","915","916","917","918","919","920","921","922","923","924","925","926","927","928","929","930","931","932","933","934"],["1947-01-01","1947-02-01","1947-03-01","1947-04-01","1947-05-01","1947-06-01","1947-07-01","1947-08-01","1947-09-01","1947-10-01","1947-11-01","1947-12-01","1948-01-01","1948-02-01","1948-03-01","1948-04-01","1948-05-01","1948-06-01","1948-07-01","1948-08-01","1948-09-01","1948-10-01","1948-11-01","1948-12-01","1949-01-01","1949-02-01","1949-03-01","1949-04-01","1949-05-01","1949-06-01","1949-07-01","1949-08-01","1949-09-01","1949-10-01","1949-11-01","1949-12-01","1950-01-01","1950-02-01","1950-03-01","1950-04-01","1950-05-01","1950-06-01","1950-07-01","1950-08-01","1950-09-01","1950-10-01","1950-11-01","1950-12-01","1951-01-01","1951-02-01","1951-03-01","1951-04-01","1951-05-01","1951-06-01","1951-07-01","1951-08-01","1951-09-01","1951-10-01","1951-11-01","1951-12-01","1952-01-01","1952-02-01","1952-03-01","1952-04-01","1952-05-01","1952-06-01","1952-07-01","1952-08-01","1952-09-01","1952-10-01","1952-11-01","1952-12-01","1953-01-01","1953-02-01","1953-03-01","1953-04-01","1953-05-01","1953-06-01","1953-07-01","1953-08-01","1953-09-01","1953-10-01","1953-11-01","1953-12-01","1954-01-01","1954-02-01","1954-03-01","1954-04-01","1954-05-01","1954-06-01","1954-07-01","1954-08-01","1954-09-01","1954-10-01","1954-11-01","1954-12-01","1955-01-01","1955-02-01","1955-03-01","1955-04-01","1955-05-01","1955-06-01","1955-07-01","1955-08-01","1955-09-01","1955-10-01","1955-11-01","1955-12-01","1956-01-01","1956-02-01","1956-03-01","1956-04-01","1956-05-01","1956-06-01","1956-07-01","1956-08-01","1956-09-01","1956-10-01","1956-11-01","1956-12-01","1957-01-01","1957-02-01","1957-03-01","1957-04-01","1957-05-01","1957-06-01","1957-07-01","1957-08-01","1957-09-01","1957-10-01","1957-11-01","1957-12-01","1958-01-01","1958-02-01","1958-03-01","1958-04-01","1958-05-01","1958-06-01","1958-07-01","1958-08-01","1958-09-01","1958-10-01","1958-11-01","1958-12-01","1959-01-01","1959-02-01","1959-03-01","1959-04-01","1959-05-01","1959-06-01","1959-07-01","1959-08-01","1959-09-01","1959-10-01","1959-11-01","1959-12-01","1960-01-01","1960-02-01","1960-03-01","1960-04-01","1960-05-01","1960-06-01","1960-07-01","1960-08-01","1960-09-01","1960-10-01","1960-11-01","1960-12-01","1961-01-01","1961-02-01","1961-03-01","1961-04-01","1961-05-01","1961-06-01","1961-07-01","1961-08-01","1961-09-01","1961-10-01","1961-11-01","1961-12-01","1962-01-01","1962-02-01","1962-03-01","1962-04-01","1962-05-01","1962-06-01","1962-07-01","1962-08-01","1962-09-01","1962-10-01","1962-11-01","1962-12-01","1963-01-01","1963-02-01","1963-03-01","1963-04-01","1963-05-01","1963-06-01","1963-07-01","1963-08-01","1963-09-01","1963-10-01","1963-11-01","1963-12-01","1964-01-01","1964-02-01","1964-03-01","1964-04-01","1964-05-01","1964-06-01","1964-07-01","1964-08-01","1964-09-01","1964-10-01","1964-11-01","1964-12-01","1965-01-01","1965-02-01","1965-03-01","1965-04-01","1965-05-01","1965-06-01","1965-07-01","1965-08-01","1965-09-01","1965-10-01","1965-11-01","1965-12-01","1966-01-01","1966-02-01","1966-03-01","1966-04-01","1966-05-01","1966-06-01","1966-07-01","1966-08-01","1966-09-01","1966-10-01","1966-11-01","1966-12-01","1967-01-01","1967-02-01","1967-03-01","1967-04-01","1967-05-01","1967-06-01","1967-07-01","1967-08-01","1967-09-01","1967-10-01","1967-11-01","1967-12-01","1968-01-01","1968-02-01","1968-03-01","1968-04-01","1968-05-01","1968-06-01","1968-07-01","1968-08-01","1968-09-01","1968-10-01","1968-11-01","1968-12-01","1969-01-01","1969-02-01","1969-03-01","1969-04-01","1969-05-01","1969-06-01","1969-07-01","1969-08-01","1969-09-01","1969-10-01","1969-11-01","1969-12-01","1970-01-01","1970-02-01","1970-03-01","1970-04-01","1970-05-01","1970-06-01","1970-07-01","1970-08-01","1970-09-01","1970-10-01","1970-11-01","1970-12-01","1971-01-01","1971-02-01","1971-03-01","1971-04-01","1971-05-01","1971-06-01","1971-07-01","1971-08-01","1971-09-01","1971-10-01","1971-11-01","1971-12-01","1972-01-01","1972-02-01","1972-03-01","1972-04-01","1972-05-01","1972-06-01","1972-07-01","1972-08-01","1972-09-01","1972-10-01","1972-11-01","1972-12-01","1973-01-01","1973-02-01","1973-03-01","1973-04-01","1973-05-01","1973-06-01","1973-07-01","1973-08-01","1973-09-01","1973-10-01","1973-11-01","1973-12-01","1974-01-01","1974-02-01","1974-03-01","1974-04-01","1974-05-01","1974-06-01","1974-07-01","1974-08-01","1974-09-01","1974-10-01","1974-11-01","1974-12-01","1975-01-01","1975-02-01","1975-03-01","1975-04-01","1975-05-01","1975-06-01","1975-07-01","1975-08-01","1975-09-01","1975-10-01","1975-11-01","1975-12-01","1976-01-01","1976-02-01","1976-03-01","1976-04-01","1976-05-01","1976-06-01","1976-07-01","1976-08-01","1976-09-01","1976-10-01","1976-11-01","1976-12-01","1977-01-01","1977-02-01","1977-03-01","1977-04-01","1977-05-01","1977-06-01","1977-07-01","1977-08-01","1977-09-01","1977-10-01","1977-11-01","1977-12-01","1978-01-01","1978-02-01","1978-03-01","1978-04-01","1978-05-01","1978-06-01","1978-07-01","1978-08-01","1978-09-01","1978-10-01","1978-11-01","1978-12-01","1979-01-01","1979-02-01","1979-03-01","1979-04-01","1979-05-01","1979-06-01","1979-07-01","1979-08-01","1979-09-01","1979-10-01","1979-11-01","1979-12-01","1980-01-01","1980-02-01","1980-03-01","1980-04-01","1980-05-01","1980-06-01","1980-07-01","1980-08-01","1980-09-01","1980-10-01","1980-11-01","1980-12-01","1981-01-01","1981-02-01","1981-03-01","1981-04-01","1981-05-01","1981-06-01","1981-07-01","1981-08-01","1981-09-01","1981-10-01","1981-11-01","1981-12-01","1982-01-01","1982-02-01","1982-03-01","1982-04-01","1982-05-01","1982-06-01","1982-07-01","1982-08-01","1982-09-01","1982-10-01","1982-11-01","1982-12-01","1983-01-01","1983-02-01","1983-03-01","1983-04-01","1983-05-01","1983-06-01","1983-07-01","1983-08-01","1983-09-01","1983-10-01","1983-11-01","1983-12-01","1984-01-01","1984-02-01","1984-03-01","1984-04-01","1984-05-01","1984-06-01","1984-07-01","1984-08-01","1984-09-01","1984-10-01","1984-11-01","1984-12-01","1985-01-01","1985-02-01","1985-03-01","1985-04-01","1985-05-01","1985-06-01","1985-07-01","1985-08-01","1985-09-01","1985-10-01","1985-11-01","1985-12-01","1986-01-01","1986-02-01","1986-03-01","1986-04-01","1986-05-01","1986-06-01","1986-07-01","1986-08-01","1986-09-01","1986-10-01","1986-11-01","1986-12-01","1987-01-01","1987-02-01","1987-03-01","1987-04-01","1987-05-01","1987-06-01","1987-07-01","1987-08-01","1987-09-01","1987-10-01","1987-11-01","1987-12-01","1988-01-01","1988-02-01","1988-03-01","1988-04-01","1988-05-01","1988-06-01","1988-07-01","1988-08-01","1988-09-01","1988-10-01","1988-11-01","1988-12-01","1989-01-01","1989-02-01","1989-03-01","1989-04-01","1989-05-01","1989-06-01","1989-07-01","1989-08-01","1989-09-01","1989-10-01","1989-11-01","1989-12-01","1990-01-01","1990-02-01","1990-03-01","1990-04-01","1990-05-01","1990-06-01","1990-07-01","1990-08-01","1990-09-01","1990-10-01","1990-11-01","1990-12-01","1991-01-01","1991-02-01","1991-03-01","1991-04-01","1991-05-01","1991-06-01","1991-07-01","1991-08-01","1991-09-01","1991-10-01","1991-11-01","1991-12-01","1992-01-01","1992-02-01","1992-03-01","1992-04-01","1992-05-01","1992-06-01","1992-07-01","1992-08-01","1992-09-01","1992-10-01","1992-11-01","1992-12-01","1993-01-01","1993-02-01","1993-03-01","1993-04-01","1993-05-01","1993-06-01","1993-07-01","1993-08-01","1993-09-01","1993-10-01","1993-11-01","1993-12-01","1994-01-01","1994-02-01","1994-03-01","1994-04-01","1994-05-01","1994-06-01","1994-07-01","1994-08-01","1994-09-01","1994-10-01","1994-11-01","1994-12-01","1995-01-01","1995-02-01","1995-03-01","1995-04-01","1995-05-01","1995-06-01","1995-07-01","1995-08-01","1995-09-01","1995-10-01","1995-11-01","1995-12-01","1996-01-01","1996-02-01","1996-03-01","1996-04-01","1996-05-01","1996-06-01","1996-07-01","1996-08-01","1996-09-01","1996-10-01","1996-11-01","1996-12-01","1997-01-01","1997-02-01","1997-03-01","1997-04-01","1997-05-01","1997-06-01","1997-07-01","1997-08-01","1997-09-01","1997-10-01","1997-11-01","1997-12-01","1998-01-01","1998-02-01","1998-03-01","1998-04-01","1998-05-01","1998-06-01","1998-07-01","1998-08-01","1998-09-01","1998-10-01","1998-11-01","1998-12-01","1999-01-01","1999-02-01","1999-03-01","1999-04-01","1999-05-01","1999-06-01","1999-07-01","1999-08-01","1999-09-01","1999-10-01","1999-11-01","1999-12-01","2000-01-01","2000-02-01","2000-03-01","2000-04-01","2000-05-01","2000-06-01","2000-07-01","2000-08-01","2000-09-01","2000-10-01","2000-11-01","2000-12-01","2001-01-01","2001-02-01","2001-03-01","2001-04-01","2001-05-01","2001-06-01","2001-07-01","2001-08-01","2001-09-01","2001-10-01","2001-11-01","2001-12-01","2002-01-01","2002-02-01","2002-03-01","2002-04-01","2002-05-01","2002-06-01","2002-07-01","2002-08-01","2002-09-01","2002-10-01","2002-11-01","2002-12-01","2003-01-01","2003-02-01","2003-03-01","2003-04-01","2003-05-01","2003-06-01","2003-07-01","2003-08-01","2003-09-01","2003-10-01","2003-11-01","2003-12-01","2004-01-01","2004-02-01","2004-03-01","2004-04-01","2004-05-01","2004-06-01","2004-07-01","2004-08-01","2004-09-01","2004-10-01","2004-11-01","2004-12-01","2005-01-01","2005-02-01","2005-03-01","2005-04-01","2005-05-01","2005-06-01","2005-07-01","2005-08-01","2005-09-01","2005-10-01","2005-11-01","2005-12-01","2006-01-01","2006-02-01","2006-03-01","2006-04-01","2006-05-01","2006-06-01","2006-07-01","2006-08-01","2006-09-01","2006-10-01","2006-11-01","2006-12-01","2007-01-01","2007-02-01","2007-03-01","2007-04-01","2007-05-01","2007-06-01","2007-07-01","2007-08-01","2007-09-01","2007-10-01","2007-11-01","2007-12-01","2008-01-01","2008-02-01","2008-03-01","2008-04-01","2008-05-01","2008-06-01","2008-07-01","2008-08-01","2008-09-01","2008-10-01","2008-11-01","2008-12-01","2009-01-01","2009-02-01","2009-03-01","2009-04-01","2009-05-01","2009-06-01","2009-07-01","2009-08-01","2009-09-01","2009-10-01","2009-11-01","2009-12-01","2010-01-01","2010-02-01","2010-03-01","2010-04-01","2010-05-01","2010-06-01","2010-07-01","2010-08-01","2010-09-01","2010-10-01","2010-11-01","2010-12-01","2011-01-01","2011-02-01","2011-03-01","2011-04-01","2011-05-01","2011-06-01","2011-07-01","2011-08-01","2011-09-01","2011-10-01","2011-11-01","2011-12-01","2012-01-01","2012-02-01","2012-03-01","2012-04-01","2012-05-01","2012-06-01","2012-07-01","2012-08-01","2012-09-01","2012-10-01","2012-11-01","2012-12-01","2013-01-01","2013-02-01","2013-03-01","2013-04-01","2013-05-01","2013-06-01","2013-07-01","2013-08-01","2013-09-01","2013-10-01","2013-11-01","2013-12-01","2014-01-01","2014-02-01","2014-03-01","2014-04-01","2014-05-01","2014-06-01","2014-07-01","2014-08-01","2014-09-01","2014-10-01","2014-11-01","2014-12-01","2015-01-01","2015-02-01","2015-03-01","2015-04-01","2015-05-01","2015-06-01","2015-07-01","2015-08-01","2015-09-01","2015-10-01","2015-11-01","2015-12-01","2016-01-01","2016-02-01","2016-03-01","2016-04-01","2016-05-01","2016-06-01","2016-07-01","2016-08-01","2016-09-01","2016-10-01","2016-11-01","2016-12-01","2017-01-01","2017-02-01","2017-03-01","2017-04-01","2017-05-01","2017-06-01","2017-07-01","2017-08-01","2017-09-01","2017-10-01","2017-11-01","2017-12-01","2018-01-01","2018-02-01","2018-03-01","2018-04-01","2018-05-01","2018-06-01","2018-07-01","2018-08-01","2018-09-01","2018-10-01","2018-11-01","2018-12-01","2019-01-01","2019-02-01","2019-03-01","2019-04-01","2019-05-01","2019-06-01","2019-07-01","2019-08-01","2019-09-01","2019-10-01","2019-11-01","2019-12-01","2020-01-01","2020-02-01","2020-03-01","2020-04-01","2020-05-01","2020-06-01","2020-07-01","2020-08-01","2020-09-01","2020-10-01","2020-11-01","2020-12-01","2021-01-01","2021-02-01","2021-03-01","2021-04-01","2021-05-01","2021-06-01","2021-07-01","2021-08-01","2021-09-01","2021-10-01","2021-11-01","2021-12-01","2022-01-01","2022-02-01","2022-03-01","2022-04-01","2022-05-01","2022-06-01","2022-07-01","2022-08-01","2022-09-01","2022-10-01","2022-11-01","2022-12-01","2023-01-01","2023-02-01","2023-03-01","2023-04-01","2023-05-01","2023-06-01","2023-07-01","2023-08-01","2023-09-01","2023-10-01","2023-11-01","2023-12-01","2024-01-01","2024-02-01","2024-03-01","2024-04-01","2024-05-01","2024-06-01","2024-07-01","2024-08-01","2024-09-01","2024-10-01"],[21.48,21.62,22,22,21.95,22.08,22.23,22.4,22.84,22.91,23.06,23.41,23.68,23.67,23.5,23.82,24.01,24.15,24.4,24.43,24.36,24.31,24.16,24.05,24.01,23.91,23.91,23.92,23.91,23.92,23.7,23.7,23.75,23.67,23.7,23.61,23.51,23.61,23.64,23.65,23.77,23.88,24.07,24.2,24.34,24.5,24.6,24.98,25.38,25.83,25.88,25.92,25.99,25.93,25.91,25.86,26.03,26.16,26.32,26.47,26.45,26.41,26.39,26.46,26.47,26.53,26.68,26.69,26.63,26.69,26.69,26.71,26.64,26.59,26.63,26.69,26.7,26.77,26.79,26.85,26.89,26.95,26.85,26.87,26.94,26.99,26.93,26.86,26.93,26.94,26.86,26.85,26.81,26.72,26.78,26.77,26.77,26.82,26.79,26.79,26.77,26.71,26.76,26.72,26.85,26.82,26.88,26.87,26.83,26.86,26.89,26.93,27.03,27.15,27.29,27.31,27.35,27.51,27.51,27.63,27.67,27.8,27.86,27.93,28,28.11,28.19,28.28,28.32,28.32,28.41,28.47,28.64,28.7,28.87,28.94,28.94,28.91,28.89,28.94,28.91,28.91,28.95,28.97,29.01,29,28.97,28.98,29.04,29.11,29.15,29.18,29.25,29.35,29.35,29.41,29.37,29.41,29.41,29.54,29.57,29.61,29.55,29.61,29.61,29.75,29.78,29.81,29.84,29.84,29.84,29.81,29.84,29.84,29.92,29.94,29.98,29.98,29.98,30.01,30.04,30.11,30.17,30.21,30.24,30.21,30.22,30.28,30.42,30.38,30.38,30.38,30.44,30.48,30.51,30.48,30.51,30.61,30.69,30.75,30.72,30.75,30.78,30.88,30.94,30.91,30.94,30.95,30.98,31.01,31.02,31.05,31.08,31.12,31.21,31.25,31.28,31.28,31.31,31.38,31.48,31.61,31.58,31.55,31.62,31.65,31.75,31.85,31.88,32.08,32.18,32.28,32.35,32.38,32.45,32.65,32.75,32.85,32.88,32.92,32.9,33,33,33.1,33.1,33.3,33.4,33.5,33.6,33.7,33.9,34,34.1,34.2,34.3,34.4,34.5,34.7,34.9,35,35.1,35.3,35.4,35.6,35.7,35.8,36.1,36.3,36.4,36.6,36.8,36.9,37.1,37.3,37.5,37.7,37.9,38.1,38.3,38.5,38.6,38.8,38.9,39,39.2,39.4,39.6,39.8,39.9,39.9,40,40.1,40.3,40.5,40.6,40.7,40.8,40.9,41,41.1,41.2,41.4,41.4,41.5,41.6,41.7,41.8,41.9,42.1,42.2,42.4,42.5,42.7,43,43.4,43.7,43.9,44.2,44.2,45,45.2,45.6,45.9,46.3,46.8,47.3,47.8,48.1,48.6,49,49.3,49.9,50.6,51,51.5,51.9,52.3,52.6,52.8,53,53.1,53.5,54,54.2,54.6,54.9,55.3,55.6,55.8,55.9,56,56.1,56.4,56.7,57,57.3,57.6,57.9,58.1,58.4,58.7,59.3,59.6,60,60.2,60.5,60.8,61.1,61.3,61.6,62,62.3,62.7,63,63.4,63.9,64.5,65,65.5,65.90000000000001,66.5,67.09999999999999,67.5,67.90000000000001,68.5,69.2,69.90000000000001,70.59999999999999,71.40000000000001,72.2,73,73.7,74.40000000000001,75.2,76,76.90000000000001,78,79,80.09999999999999,80.90000000000001,81.7,82.5,82.59999999999999,83.2,83.90000000000001,84.7,85.59999999999999,86.40000000000001,87.2,88,88.59999999999999,89.09999999999999,89.7,90.5,91.5,92.2,93.09999999999999,93.40000000000001,93.8,94.09999999999999,94.40000000000001,94.7,94.7,95,95.90000000000001,97,97.5,97.7,97.7,98.09999999999999,98,97.7,97.90000000000001,98,98.09999999999999,98.8,99.2,99.40000000000001,99.8,100.1,100.4,100.8,101.1,101.4,102.1,102.6,102.9,103.3,103.5,103.7,104.1,104.4,104.7,105.1,105.3,105.5,105.7,106.3,106.8,107,107.2,107.5,107.7,107.9,108.1,108.5,109,109.5,109.9,109.7,109.1,108.7,109,109.4,109.5,109.6,110,110.2,110.4,110.8,111.4,111.8,112.2,112.7,113,113.5,113.8,114.3,114.7,115,115.4,115.6,116,116.2,116.5,117.2,117.5,118,118.5,119,119.5,119.9,120.3,120.7,121.2,121.6,122.2,123.1,123.7,124.1,124.5,124.5,124.8,125.4,125.9,126.3,127.5,128,128.6,128.9,129.1,129.9,130.5,131.6,132.5,133.4,133.7,134.2,134.7,134.8,134.8,135.1,135.6,136,136.2,136.6,137,137.2,137.8,138.2,138.3,138.6,139.1,139.4,139.7,140.1,140.5,140.8,141.1,141.7,142.1,142.3,142.8,143.1,143.3,143.8,144.2,144.3,144.5,144.8,145,145.6,146,146.3,146.3,146.7,147.1,147.2,147.5,147.9,148.4,149,149.3,149.4,149.8,150.1,150.5,150.9,151.2,151.8,152.1,152.4,152.6,152.9,153.1,153.5,153.7,153.9,154.7,155,155.5,156.1,156.4,156.7,157,157.2,157.7,158.2,158.7,159.1,159.4,159.7,159.8,159.9,159.9,160.2,160.4,160.8,161.2,161.5,161.7,161.8,162,162,162,162.2,162.6,162.8,163.2,163.4,163.5,163.9,164.1,164.4,164.7,164.7,164.8,165.9,166,166,166.7,167.1,167.8,168.1,168.4,168.8,169.3,170,171,170.9,171.2,172.2,172.7,172.7,173.6,173.9,174.2,174.6,175.6,176,176.1,176.4,177.3,177.7,177.4,177.4,178.1,177.6,177.5,177.4,177.7,178,178.5,179.3,179.5,179.6,180,180.5,180.8,181.2,181.5,181.8,182.6,183.6,183.9,183.2,182.9,183.1,183.7,184.5,185.1,184.9,185,185.5,186.3,186.7,187.1,187.4,188.2,188.9,189.1,189.2,189.8,190.8,191.7,191.7,191.6,192.4,193.1,193.7,193.6,193.7,194.9,196.1,198.8,199.1,198.1,198.1,199.3,199.4,199.7,200.7,201.3,201.8,202.9,203.8,202.8,201.9,202,203.1,203.437,204.226,205.288,205.904,206.755,207.234,207.603,207.667,208.547,209.19,210.834,211.445,212.174,212.687,213.448,213.942,215.208,217.463,219.016,218.69,218.877,216.995,213.153,211.398,211.933,212.705,212.495,212.709,213.022,214.79,214.726,215.445,215.861,216.509,217.234,217.347,217.488,217.281,217.353,217.403,217.29,217.199,217.605,217.923,218.275,219.035,219.59,220.472,221.187,221.898,223.046,224.093,224.806,224.806,225.395,226.106,226.597,226.75,227.169,227.223,227.842,228.329,228.807,229.187,228.713,228.524,228.59,229.918,231.015,231.638,231.249,231.221,231.679,232.937,232.282,231.797,231.893,232.445,232.9,233.456,233.544,233.669,234.1,234.719,235.288,235.547,236.028,236.468,236.918,237.231,237.498,237.46,237.477,237.43,236.983,236.252,234.747,235.342,235.976,236.222,237.001,237.657,238.034,238.033,237.498,237.733,238.017,237.761,237.652,237.336,238.08,238.992,239.557,240.222,240.101,240.545,241.176,241.741,242.026,242.637,243.618,244.006,243.892,244.193,244.004,244.163,244.243,245.183,246.435,246.626,247.284,247.805,248.859,249.529,249.577,250.227,250.792,251.018,251.214,251.663,252.182,252.772,252.594,252.767,252.561,253.319,254.277,255.233,255.296,255.213,255.802,256.036,256.43,257.155,257.879,258.63,258.906,259.246,258.15,256.126,255.848,257.004,258.408,259.366,259.951,260.249,260.895,262.005,262.518,263.583,264.91,266.752,268.452,270.664,271.994,272.789,273.887,276.434,278.799,280.808,282.39,284.535,287.553,288.764,291.359,294.996,294.977,295.209,296.341,297.863,298.648,298.812,300.356,301.509,301.744,303.032,303.365,304.003,304.628,306.187,307.288,307.531,308.024,308.742,309.685,311.054,312.23,313.207,313.225,313.049,313.534,314.121,314.686,315.454]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>date<\/th>\n      <th>CPI<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":2},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"date","targets":1},{"name":"CPI","targets":2}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>To visualize better the fluctuation of the inflation rate over the years, here is a visual:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>inflation_df <span class="ot">&lt;-</span> inflation_df <span class="sc">|&gt;</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(date) <span class="sc">|&gt;</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">mom_inflation =</span> (CPI <span class="sc">/</span> <span class="fu">lag</span>(CPI) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="dv">100</span>, <span class="co"># Month-over-Month Inflation</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">yoy_inflation =</span> (CPI <span class="sc">/</span> <span class="fu">lag</span>(CPI, <span class="dv">12</span>) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="dv">100</span> <span class="co"># Year-over-Year Inflation</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>inflation_df <span class="ot">&lt;-</span> inflation_df <span class="sc">|&gt;</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">inflation_cpi =</span> CPI,                <span class="co"># CPI column</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">mom_inflation_rate =</span> mom_inflation, <span class="co"># Month-over-month inflation</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">yoy_inflation_rate =</span> yoy_inflation  <span class="co"># Year-over-year inflation</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(inflation_df, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> yoy_inflation_rate)) <span class="sc">+</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Adjusted Year-over-Year Inflation Rate"</span>, <span class="at">x =</span> <span class="st">"Date"</span>, <span class="at">y =</span> <span class="st">"YoY Inflation Rate (%)"</span>) <span class="sc">+</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ol start="3" type="1">
<li>U.S. Equity Market Total Returns</li>
</ol>
<p>After looking at the different datasets Alpha Vantage has to offer, I chose the <a href="https://www.alphavantage.co/documentation/#monthlyadj">TIME_SERIES_MONTHLY_ADJUSTED</a> data that shows the US equity market and selected to analyze the S&amp;P 500 ETF “SPY”.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the base URL for the Alpha Vantage API</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>base_url <span class="ot">&lt;-</span> <span class="st">"https://www.alphavantage.co/query"</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the API endpoint and parameters</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>us_equity_response <span class="ot">&lt;-</span> <span class="fu">request</span>(base_url) <span class="sc">|&gt;</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_options</span>(<span class="at">cookies =</span> <span class="cn">NULL</span>) <span class="sc">|&gt;</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_url_query</span>(</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">function</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"TIME_SERIES_MONTHLY_ADJUSTED"</span>, <span class="co"># Enclose 'function' in backticks</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">symbol =</span> <span class="st">"SPY"</span>, <span class="co"># Example: S&amp;P 500 ETF</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">apikey =</span> alpha_vantage_key</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_perform</span>()</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Parse JSON response</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>equity_data <span class="ot">&lt;-</span> us_equity_response <span class="sc">|&gt;</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">resp_body_json</span>() <span class="sc">%&gt;%</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>  .<span class="sc">$</span><span class="st">`</span><span class="at">Monthly Adjusted Time Series</span><span class="st">`</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert JSON data to a data frame</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>equity_df <span class="ot">&lt;-</span> equity_data <span class="sc">|&gt;</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_dfr</span>(as_tibble, <span class="at">.id =</span> <span class="st">"date"</span>) <span class="sc">|&gt;</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">date =</span> <span class="fu">as.Date</span>(date), <span class="co"># Convert date to Date type</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">us_equity_return =</span> <span class="fu">as.numeric</span>(<span class="st">`</span><span class="at">5. adjusted close</span><span class="st">`</span>) <span class="co"># Adjusted close price</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date, us_equity_return)</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>equity_df <span class="ot">&lt;-</span> equity_df <span class="sc">|&gt;</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(date) <span class="sc">|&gt;</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">us_equity_monthly_return =</span> (us_equity_return <span class="sc">-</span> <span class="fu">lag</span>(us_equity_return)) <span class="sc">/</span> <span class="fu">lag</span>(us_equity_return) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>equity_df <span class="ot">&lt;-</span> equity_df <span class="sc">|&gt;</span></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">us_equity_adjusted =</span> us_equity_return,  <span class="co"># Adjusted close column</span></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>equity_df <span class="ot">&lt;-</span> equity_df <span class="sc">|&gt;</span></span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> date <span class="sc">|&gt;</span></span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>           <span class="fu">floor_date</span>(<span class="at">unit =</span> <span class="st">"month"</span>) <span class="sc">|&gt;</span>  <span class="co"># Get the first of the current month</span></span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>           <span class="fu">add_with_rollback</span>(<span class="fu">months</span>(<span class="dv">1</span>)))  <span class="co"># Add one month</span></span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove Empty Values</span></span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>equity_df <span class="ot">&lt;-</span> equity_df <span class="sc">|&gt;</span></span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(us_equity_monthly_return))</span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a><span class="co"># View the updated data frame</span></span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>equity_df <span class="sc">|&gt;</span> DT<span class="sc">:::</span><span class="fu">datatable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-653186074a6894027e72" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-653186074a6894027e72">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149","150","151","152","153","154","155","156","157","158","159","160","161","162","163","164","165","166","167","168","169","170","171","172","173","174","175","176","177","178","179","180","181","182","183","184","185","186","187","188","189","190","191","192","193","194","195","196","197","198","199","200","201","202","203","204","205","206","207","208","209","210","211","212","213","214","215","216","217","218","219","220","221","222","223","224","225","226","227","228","229","230","231","232","233","234","235","236","237","238","239","240","241","242","243","244","245","246","247","248","249","250","251","252","253","254","255","256","257","258","259","260","261","262","263","264","265","266","267","268","269","270","271","272","273","274","275","276","277","278","279","280","281","282","283","284","285","286","287","288","289","290","291","292","293","294","295","296","297","298","299","300"],["2000-02-01","2000-03-01","2000-04-01","2000-05-01","2000-06-01","2000-07-01","2000-08-01","2000-09-01","2000-10-01","2000-11-01","2000-12-01","2001-01-01","2001-02-01","2001-03-01","2001-04-01","2001-05-01","2001-06-01","2001-07-01","2001-08-01","2001-09-01","2001-10-01","2001-11-01","2001-12-01","2002-01-01","2002-02-01","2002-03-01","2002-04-01","2002-05-01","2002-06-01","2002-07-01","2002-08-01","2002-09-01","2002-10-01","2002-11-01","2002-12-01","2003-01-01","2003-02-01","2003-03-01","2003-04-01","2003-05-01","2003-06-01","2003-07-01","2003-08-01","2003-09-01","2003-10-01","2003-11-01","2003-12-01","2004-01-01","2004-02-01","2004-03-01","2004-04-01","2004-05-01","2004-06-01","2004-07-01","2004-08-01","2004-09-01","2004-10-01","2004-11-01","2004-12-01","2005-01-01","2005-02-01","2005-03-01","2005-04-01","2005-05-01","2005-06-01","2005-07-01","2005-08-01","2005-09-01","2005-10-01","2005-11-01","2005-12-01","2006-01-01","2006-02-01","2006-03-01","2006-04-01","2006-05-01","2006-06-01","2006-07-01","2006-08-01","2006-09-01","2006-10-01","2006-11-01","2006-12-01","2007-01-01","2007-02-01","2007-03-01","2007-04-01","2007-05-01","2007-06-01","2007-07-01","2007-08-01","2007-09-01","2007-10-01","2007-11-01","2007-12-01","2008-01-01","2008-02-01","2008-03-01","2008-04-01","2008-05-01","2008-06-01","2008-07-01","2008-08-01","2008-09-01","2008-10-01","2008-11-01","2008-12-01","2009-01-01","2009-02-01","2009-03-01","2009-04-01","2009-05-01","2009-06-01","2009-07-01","2009-08-01","2009-09-01","2009-10-01","2009-11-01","2009-12-01","2010-01-01","2010-02-01","2010-03-01","2010-04-01","2010-05-01","2010-06-01","2010-07-01","2010-08-01","2010-09-01","2010-10-01","2010-11-01","2010-12-01","2011-01-01","2011-02-01","2011-03-01","2011-04-01","2011-05-01","2011-06-01","2011-07-01","2011-08-01","2011-09-01","2011-10-01","2011-11-01","2011-12-01","2012-01-01","2012-02-01","2012-03-01","2012-04-01","2012-05-01","2012-06-01","2012-07-01","2012-08-01","2012-09-01","2012-10-01","2012-11-01","2012-12-01","2013-01-01","2013-02-01","2013-03-01","2013-04-01","2013-05-01","2013-06-01","2013-07-01","2013-08-01","2013-09-01","2013-10-01","2013-11-01","2013-12-01","2014-01-01","2014-02-01","2014-03-01","2014-04-01","2014-05-01","2014-06-01","2014-07-01","2014-08-01","2014-09-01","2014-10-01","2014-11-01","2014-12-01","2015-01-01","2015-02-01","2015-03-01","2015-04-01","2015-05-01","2015-06-01","2015-07-01","2015-08-01","2015-09-01","2015-10-01","2015-11-01","2015-12-01","2016-01-01","2016-02-01","2016-03-01","2016-04-01","2016-05-01","2016-06-01","2016-07-01","2016-08-01","2016-09-01","2016-10-01","2016-11-01","2016-12-01","2017-01-01","2017-02-01","2017-03-01","2017-04-01","2017-05-01","2017-06-01","2017-07-01","2017-08-01","2017-09-01","2017-10-01","2017-11-01","2017-12-01","2018-01-01","2018-02-01","2018-03-01","2018-04-01","2018-05-01","2018-06-01","2018-07-01","2018-08-01","2018-09-01","2018-10-01","2018-11-01","2018-12-01","2019-01-01","2019-02-01","2019-03-01","2019-04-01","2019-05-01","2019-06-01","2019-07-01","2019-08-01","2019-09-01","2019-10-01","2019-11-01","2019-12-01","2020-01-01","2020-02-01","2020-03-01","2020-04-01","2020-05-01","2020-06-01","2020-07-01","2020-08-01","2020-09-01","2020-10-01","2020-11-01","2020-12-01","2021-01-01","2021-02-01","2021-03-01","2021-04-01","2021-05-01","2021-06-01","2021-07-01","2021-08-01","2021-09-01","2021-10-01","2021-11-01","2021-12-01","2022-01-01","2022-02-01","2022-03-01","2022-04-01","2022-05-01","2022-06-01","2022-07-01","2022-08-01","2022-09-01","2022-10-01","2022-11-01","2022-12-01","2023-01-01","2023-02-01","2023-03-01","2023-04-01","2023-05-01","2023-06-01","2023-07-01","2023-08-01","2023-09-01","2023-10-01","2023-11-01","2023-12-01","2024-01-01","2024-02-01","2024-03-01","2024-04-01","2024-05-01","2024-06-01","2024-07-01","2024-08-01","2024-09-01","2024-10-01","2024-11-01","2024-12-01","2025-01-01"],[89.17140000000001,87.81359999999999,96.3223,92.93940000000001,91.4782,93.2807,91.816,97.81529999999999,92.4543,92.0218,85.1521,84.7133,88.4796,80.0397,75.55840000000001,82.0141,81.5543,79.6109,78.7992,74.1238,68.0758,68.9623,74.3398,74.7573,74.0248,72.69710000000001,75.11369999999999,70.7454,70.3257,65.13890000000001,60.0047,60.4128,54.0784,58.5282,62.1382,58.619,57.1772,56.4065,56.5227,61.3052,64.667,65.3565,66.5347,67.907,67.1677,70.76300000000001,71.53579999999999,75.1357,76.6211,77.6609,76.636,75.1859,76.4734,77.8875,75.3781,75.5617,76.31870000000001,77.30200000000001,80.7427,83.1773,81.3124,83.01220000000001,81.49460000000001,79.9678,82.5448,82.6683,85.8313,85.02670000000001,85.7063,83.6793,87.35720000000001,87.1913,89.2851,89.7963,91.2783,92.43129999999999,89.6472,89.8843,90.2868,92.25709999999999,94.7475,97.7336,99.67700000000001,101.0096,102.5288,100.5174,101.6836,106.1878,109.7897,108.1816,104.7944,106.1392,110.2467,111.7423,107.4143,106.197,99.77630000000001,97.1978,96.31999999999999,100.9108,102.4362,93.88290000000001,93.0393,94.47709999999999,85.56100000000001,71.42740000000001,66.4556,67.1092,61.5986,54.9799,59.5698,65.4879,69.3159,69.2692,74.4371,77.1867,79.92359999999999,78.387,83.2162,84.80329999999999,81.7213,84.2706,89.40309999999999,90.78619999999999,83.5728,79.24850000000001,84.66119999999999,80.8531,88.0938,91.4592,91.4592,97.5727,99.84610000000001,103.3145,103.3256,106.318,105.1257,103.3505,101.283,95.7149,89.0675,98.789,98.38760000000001,99.4147,104.025,108.5403,112.0306,111.2827,104.5995,108.8388,110.1263,112.8853,115.7477,113.6413,114.2844,115.3128,121.2157,122.7623,127.4242,129.8723,132.9386,131.1625,137.9405,133.8034,138.0424,144.4347,148.7155,152.5666,147.1889,153.8883,155.1672,156.2458,159.8717,163.1704,160.9778,167.3306,165.0229,168.9093,173.5496,173.1053,167.9763,177.4173,174.6239,176.3412,178.6082,175.0182,178.8944,167.9202,163.7239,177.6873,178.3367,175.273,166.5468,166.4092,177.599,178.299,181.3321,181.9663,188.6028,188.8287,188.8434,185.5694,192.4055,196.3081,199.821,207.6722,207.9335,209.9975,212.9612,214.3186,218.7238,219.362,223.7801,229.0533,236.0545,238.9076,252.3722,243.1959,236.5285,237.751,243.5305,244.932,254.0059,262.1138,263.6729,245.452,250.0049,228.0204,246.277,254.2603,258.857,269.432,252.25,269.8047,273.884,269.2982,274.5439,280.6126,290.7703,299.2124,299.0915,275.4137,241.0854,271.6993,284.6445,289.7,306.7611,328.172,315.8989,308.0225,341.5282,354.1873,350.5779,360.3259,376.6866,396.6172,399.2214,408.193,418.158,430.6023,410.5469,439.3523,435.8222,455.9957,431.9459,419.1961,434.9393,396.7651,397.6607,364.8659,398.4655,382.2073,346.8851,375.0784,395.9295,373.1336,396.5989,386.6274,400.9809,407.3866,409.2671,435.7934,450.0584,442.744,421.7609,412.6051,450.294,470.8556,478.3546,503.3185,519.789,498.8313,524.062,542.5534,549.1232,561.9538,573.76,568.64,602.55,602.8],[-4.978709256678122,-1.522685524731037,9.689501398416651,-3.512063146332669,-1.572207266240157,1.970414809211369,-1.57020691311278,6.534046353576708,-5.480737676007731,-0.4677986854045778,-7.465296266754176,-0.5153131866389677,4.445937060650454,-9.538808945790905,-5.598846572388441,8.543987167541918,-0.5606353053926109,-2.382952217111785,-1.019584001688213,-5.933308967603727,-8.159322646707267,1.302224872862306,7.797738764513361,0.5616103352443832,-0.9798374205595997,-1.793588094800652,3.324204129188081,-5.815583575299834,-0.5932541197024908,-7.375397614243429,-7.881926160865484,0.6801133911176915,-10.48519519042321,8.228423917867385,6.167966894590983,-5.663504897148611,-2.459612071171464,-1.347914903143207,0.2060046271263049,8.461202313406824,5.483711006570409,1.06623161736279,1.802728114265611,2.062532783645219,-1.088694832638756,5.352721620659944,1.092096151943797,5.032305502978936,1.97695636029211,1.357067439647825,-1.319711721084873,-1.892191659272394,1.712422142981589,1.849139700863313,-3.221826352110415,0.2435720719943835,1.001830292330645,1.288412931561989,4.450984450596352,3.01525710683443,-2.242078066972606,2.090456068201173,-1.828165016708389,-1.873498366762961,3.222547075197765,0.1496157238251314,3.826134080415342,-0.9374202651014182,0.7992783443318316,-2.365053677500955,4.395232751708019,-0.1899099330106822,2.401386376851821,0.5725479391298238,1.650402076700264,1.263169888133315,-3.012074914017216,0.264481210790742,0.4477978912891389,2.182268061333434,2.699412836518824,3.151639884957379,1.988466607185258,1.336918245934367,1.504015459916679,-1.96179024820344,1.160197139997656,4.429622869371263,3.392009251533604,-1.46470934887334,-3.131031524769468,1.283274678799637,3.869917994482719,1.356593893513362,-3.873197526809456,-1.133275550834474,-6.046027665564938,-2.584281036679057,-0.9031068604433513,4.766196013289038,1.511632055240871,-8.349880218126007,-0.898566192565429,1.545368462574413,-9.437313380702824,-16.51874101518215,-6.960634154400134,0.9835138047056942,-8.211392774761141,-10.74488705912147,8.348323660101236,9.93473202864538,5.845354638032374,-0.06737270958034347,7.460602980834199,3.693856961112135,3.545818126697982,-1.922586069696551,6.160715424751554,1.907200761390201,-3.634292533427347,3.119504951585452,6.090498940318442,1.547038078097962,-7.94548070081135,-5.174291156931434,6.830034637879565,-4.498046330550473,8.955377097476786,3.820246146720875,0,6.68440135054757,2.329954997658166,3.473746095240563,0.01074389364513113,2.896087707209059,-1.121446979815274,-1.688645117226328,-2.000474114784152,-5.497566225329029,-6.945000203730041,10.91475566283999,-0.4063205417607176,1.043932365460678,4.637442953607474,4.340591204037487,3.215671967002123,-0.6675854632573611,-6.00560554335939,4.052887442100584,1.182942112555444,2.505305272219261,2.535671163561592,-1.819820177852341,0.5659034171555622,0.8998603483939983,5.11903275265192,1.275907328836114,3.797501350170209,1.921220615864174,2.361011547497051,-1.336030317755726,5.167635566568182,-2.99919168047091,3.168080930678873,4.630678690025678,2.963830713810462,2.589575397319044,-3.524821291160716,4.551566048798515,0.8310573318439554,0.6951211338478714,2.320638378759622,2.063342042400247,-1.343748621073429,3.946382668914597,-1.379126113215402,2.355067084628866,2.747214037356141,-0.2560075044828674,-2.962936432333378,5.6204357400419,-1.57448005352354,0.9834278125731899,1.285575917596129,-2.009986103661536,2.214741095497487,-6.134456975735405,-2.49898463675008,8.528626547498568,0.3654735031710281,-1.717930184869413,-4.97863333200208,-0.08261941988677775,6.724267648663651,0.3941463634367407,1.701131245828631,0.3497450258393262,3.647103886818611,0.1197755282530247,0.007784833555494912,-1.733711636202272,3.683850893520153,2.028320396246472,1.789482960713288,3.929116559320595,0.125823292669893,0.9926250459882572,1.411302515506132,0.6373931025933423,2.055444557775204,0.291783518757439,2.014068070130656,2.356420432379824,3.056581153818776,1.208661559089114,5.635902750686872,-3.63601854720924,-2.741575824263479,0.5168510348647188,2.430904601873382,0.5754925974364602,3.704660885470257,3.192012469001716,0.5948179760088941,-6.910418173426251,1.854904421231033,-8.793627644898159,8.006564324946361,3.241593815094391,1.807871696839824,4.085267155224694,-6.377119273137569,6.959246778989109,1.511945492424702,-1.674358487534871,1.947914987920454,2.210466158599764,3.619830328360179,2.903357048501852,-0.04040607942719152,-7.916574025005723,-12.46426739120095,12.69836331855849,4.764531966037453,1.776075069077391,5.889230238177428,6.97966593547879,-3.739837646112404,-2.49332935315699,10.8776793903043,3.706604608345655,-1.019065336334757,2.780551768950636,4.540528449384295,5.291029731346968,0.6566028906461927,2.247274319462826,2.441247155144755,2.975980371055916,-4.657522730370929,7.016348193105348,-0.8034782109937753,4.628837172590104,-5.274128681476602,-2.9517122398893,3.755569290840254,-8.77690289196676,0.2257254985380523,-8.24693010901002,9.208753133685557,-4.080202677521654,-9.241634055655126,8.127561547036747,5.559131104323798,-5.757565425157765,6.288712675567146,-2.514253065250557,3.712489078632295,1.597507512203191,0.4616008479414985,6.481415193158695,3.273340073530252,-1.625211305910517,-4.739330177258197,-2.170850830411259,9.134375702093839,4.566261153823945,1.592632645762315,5.218701774792166,3.272381205936205,-4.031962969589582,5.05796248150427,3.528475638378665,1.210903848358518,2.336561267125484,2.100920040045995,-0.8923591745677643,5.963351153629707,0.04149033275246868]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>date<\/th>\n      <th>us_equity_adjusted<\/th>\n      <th>us_equity_monthly_return<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,3]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"date","targets":1},{"name":"us_equity_adjusted","targets":2},{"name":"us_equity_monthly_return","targets":3}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Here is the evolution of the adjusted close prices of the US Equity market from 2000 until now:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(equity_df, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> us_equity_adjusted)) <span class="sc">+</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"US Equity Market Adjusted Close Prices"</span>, <span class="at">x =</span> <span class="st">"Date"</span>, <span class="at">y =</span> <span class="st">"Adjusted Close ($)"</span>) <span class="sc">+</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ol start="4" type="1">
<li>International Equity Market Total Returns</li>
</ol>
<p>For the International Equity Market Total Returns, I will use the same data as US Equity Market Total Returns</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Request monthly adjusted data for VEU ETF</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>equity_response <span class="ot">&lt;-</span> <span class="fu">request</span>(base_url) <span class="sc">|&gt;</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_options</span>(<span class="at">cookies =</span> <span class="cn">NULL</span>) <span class="sc">|&gt;</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_url_query</span>(</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">function</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"TIME_SERIES_MONTHLY_ADJUSTED"</span>, <span class="co"># Monthly adjusted time series</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">symbol =</span> <span class="st">"VEU"</span>,                            </span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">apikey =</span> alpha_vantage_key</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_perform</span>()</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>intl_equity_data <span class="ot">&lt;-</span> equity_response <span class="sc">|&gt;</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">resp_body_json</span>() <span class="sc">%&gt;%</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>  .<span class="sc">$</span><span class="st">`</span><span class="at">Monthly Adjusted Time Series</span><span class="st">`</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert JSON data to a data frame</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>intl_equity_df <span class="ot">&lt;-</span> intl_equity_data <span class="sc">|&gt;</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_dfr</span>(as_tibble, <span class="at">.id =</span> <span class="st">"date"</span>) <span class="sc">|&gt;</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">date =</span> <span class="fu">as.Date</span>(date), <span class="co"># Convert date to Date type</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">intl_equity_return =</span> <span class="fu">as.numeric</span>(<span class="st">`</span><span class="at">5. adjusted close</span><span class="st">`</span>) <span class="co"># Adjusted close price</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date, intl_equity_return)</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>intl_equity_df <span class="ot">&lt;-</span> intl_equity_df <span class="sc">|&gt;</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(date) <span class="sc">|&gt;</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">monthly_return =</span> (intl_equity_return <span class="sc">-</span> <span class="fu">lag</span>(intl_equity_return)) <span class="sc">/</span> <span class="fu">lag</span>(intl_equity_return) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>intl_equity_df <span class="ot">&lt;-</span> intl_equity_df <span class="sc">|&gt;</span></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">intl_equity_adjusted =</span> intl_equity_return,  <span class="co"># Adjusted close column</span></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">intl_equity_monthly_return =</span> monthly_return <span class="co"># Monthly returns</span></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>intl_equity_df <span class="ot">&lt;-</span> intl_equity_df <span class="sc">|&gt;</span></span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> date <span class="sc">|&gt;</span></span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>           <span class="fu">floor_date</span>(<span class="at">unit =</span> <span class="st">"month"</span>) <span class="sc">|&gt;</span>  <span class="co"># Get the first of the current month</span></span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>           <span class="fu">add_with_rollback</span>(<span class="fu">months</span>(<span class="dv">1</span>)))  <span class="co"># Add one month</span></span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a><span class="co"># View the updated data frame</span></span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>intl_equity_df <span class="sc">|&gt;</span> DT<span class="sc">::</span><span class="fu">datatable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-31722f890b5feee49815" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-31722f890b5feee49815">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149","150","151","152","153","154","155","156","157","158","159","160","161","162","163","164","165","166","167","168","169","170","171","172","173","174","175","176","177","178","179","180","181","182","183","184","185","186","187","188","189","190","191","192","193","194","195","196","197","198","199","200","201","202","203","204","205","206","207","208","209","210","211","212","213"],["2007-05-01","2007-06-01","2007-07-01","2007-08-01","2007-09-01","2007-10-01","2007-11-01","2007-12-01","2008-01-01","2008-02-01","2008-03-01","2008-04-01","2008-05-01","2008-06-01","2008-07-01","2008-08-01","2008-09-01","2008-10-01","2008-11-01","2008-12-01","2009-01-01","2009-02-01","2009-03-01","2009-04-01","2009-05-01","2009-06-01","2009-07-01","2009-08-01","2009-09-01","2009-10-01","2009-11-01","2009-12-01","2010-01-01","2010-02-01","2010-03-01","2010-04-01","2010-05-01","2010-06-01","2010-07-01","2010-08-01","2010-09-01","2010-10-01","2010-11-01","2010-12-01","2011-01-01","2011-02-01","2011-03-01","2011-04-01","2011-05-01","2011-06-01","2011-07-01","2011-08-01","2011-09-01","2011-10-01","2011-11-01","2011-12-01","2012-01-01","2012-02-01","2012-03-01","2012-04-01","2012-05-01","2012-06-01","2012-07-01","2012-08-01","2012-09-01","2012-10-01","2012-11-01","2012-12-01","2013-01-01","2013-02-01","2013-03-01","2013-04-01","2013-05-01","2013-06-01","2013-07-01","2013-08-01","2013-09-01","2013-10-01","2013-11-01","2013-12-01","2014-01-01","2014-02-01","2014-03-01","2014-04-01","2014-05-01","2014-06-01","2014-07-01","2014-08-01","2014-09-01","2014-10-01","2014-11-01","2014-12-01","2015-01-01","2015-02-01","2015-03-01","2015-04-01","2015-05-01","2015-06-01","2015-07-01","2015-08-01","2015-09-01","2015-10-01","2015-11-01","2015-12-01","2016-01-01","2016-02-01","2016-03-01","2016-04-01","2016-05-01","2016-06-01","2016-07-01","2016-08-01","2016-09-01","2016-10-01","2016-11-01","2016-12-01","2017-01-01","2017-02-01","2017-03-01","2017-04-01","2017-05-01","2017-06-01","2017-07-01","2017-08-01","2017-09-01","2017-10-01","2017-11-01","2017-12-01","2018-01-01","2018-02-01","2018-03-01","2018-04-01","2018-05-01","2018-06-01","2018-07-01","2018-08-01","2018-09-01","2018-10-01","2018-11-01","2018-12-01","2019-01-01","2019-02-01","2019-03-01","2019-04-01","2019-05-01","2019-06-01","2019-07-01","2019-08-01","2019-09-01","2019-10-01","2019-11-01","2019-12-01","2020-01-01","2020-02-01","2020-03-01","2020-04-01","2020-05-01","2020-06-01","2020-07-01","2020-08-01","2020-09-01","2020-10-01","2020-11-01","2020-12-01","2021-01-01","2021-02-01","2021-03-01","2021-04-01","2021-05-01","2021-06-01","2021-07-01","2021-08-01","2021-09-01","2021-10-01","2021-11-01","2021-12-01","2022-01-01","2022-02-01","2022-03-01","2022-04-01","2022-05-01","2022-06-01","2022-07-01","2022-08-01","2022-09-01","2022-10-01","2022-11-01","2022-12-01","2023-01-01","2023-02-01","2023-03-01","2023-04-01","2023-05-01","2023-06-01","2023-07-01","2023-08-01","2023-09-01","2023-10-01","2023-11-01","2023-12-01","2024-01-01","2024-02-01","2024-03-01","2024-04-01","2024-05-01","2024-06-01","2024-07-01","2024-08-01","2024-09-01","2024-10-01","2024-11-01","2024-12-01","2025-01-01"],[33.7655,34.8869,35.1211,34.7144,34.6466,36.7785,39.12,37.1791,36.4251,33.6041,33.5295,33.4985,35.481,35.9844,32.9702,31.7583,30.1113,26.3761,20.3725,18.9928,20.5984,17.9216,16.271,17.9216,20.2925,23.3708,22.8864,25.3146,26.0539,27.5325,26.6594,27.9532,28.3421,26.7109,27.0618,28.8815,28.3746,25.2811,24.9431,27.6272,26.6784,29.5054,30.5648,29.3105,31.6901,31.9424,32.8188,32.7458,34.5318,33.4363,33.0711,32.2876,29.5522,25.7079,28.6625,27.9255,27.2467,29.1158,30.6619,30.3871,29.8373,26.4358,28.1606,28.298,29.0471,30.0604,30.2913,30.8371,32.3961,33.1821,32.7218,32.9251,34.1608,33.0316,31.8478,33.3458,32.6832,35.1601,36.3321,36.4551,36.9892,34.8455,36.8069,36.9765,37.5204,38.2407,38.8823,38.3097,38.6964,36.8088,36.8835,36.7639,35.3096,35.302,37.3666,36.8392,38.5855,38.1848,37.1129,37.0059,34.1393,32.7617,34.952,34.4908,33.6213,31.7392,30.9647,33.537,34.2443,33.9723,33.7286,35.1612,35.4052,35.9654,35.3559,34.6038,35.2733,36.7344,37.1975,38.3101,39.1111,40.3045,40.5082,41.8765,42.1437,42.9187,43.7574,44.0342,44.9358,47.4979,44.9768,44.7772,45.0325,44.1348,43.1921,44.4419,43.4004,43.5933,39.9752,40.5615,38.5595,41.4781,42.1549,42.5781,43.7922,41.364,43.799,43.0087,41.9608,43.1433,44.6304,45.0973,46.9759,45.3765,42.3788,35.9679,38.4143,40.2118,41.966,43.6143,45.5359,44.7711,43.8481,49.3769,52.1995,52.3963,53.4875,54.4202,55.8193,57.5861,57.3047,56.4911,57.3499,55.4384,56.9571,54.5108,56.5228,55.1669,53.479,53.2175,49.7707,50.5839,46.7004,48.2802,46.1583,41.6912,43.1103,48.7776,47.7086,51.8571,49.583,50.9914,51.9546,50.1808,52.4649,54.4416,52.0503,50.2959,48.6863,52.691,55.2739,54.3583,56.0813,57.9597,56.507,58.7404,58.4051,59.8892,61.4329,63,60.14,59.91,60.26],[null,3.321141401726597,0.6713121544189977,-1.157993343033108,-0.1953079989860067,6.153273337066268,6.366491292467057,-4.961400817995909,-2.028021119392341,-7.744659589129468,-0.2219967206382667,-0.09245589704588142,5.918175440691379,1.418787520081168,-8.376407554384684,-3.675743550236274,-5.186045852580266,-12.40464543211352,-22.76151515955734,-6.772364707326051,8.4537298344636,-12.99518409196831,-9.210115168288549,10.14442873824596,13.22928756361038,15.16964395712701,-2.072671881150841,10.60979446308725,2.920449068916752,5.675158037760183,-3.171161354762544,4.853072462245952,1.391253953035787,-5.755395683453237,1.313695906914417,6.724238594624146,-1.755102747433472,-10.90235633277651,-1.336967141461398,10.76089178971338,-3.434296635200087,10.59658750149935,3.590529191266683,-4.103740250222479,8.118592313334812,0.796147692812576,2.743688639551205,-0.2224334832474082,5.454134576037214,-3.172438158451035,-1.092226113535294,-2.369138008714569,-8.471983052317295,-13.00850698086775,11.49296519746849,-2.571303968600094,-2.430753254194192,6.859913310602749,5.310175231317701,-0.8962262612558225,-1.809320402407604,-11.40016020216306,6.524485735252947,0.4879157404316652,2.647183546540399,3.488472171060109,0.7681201846948088,1.801837491292879,5.055598613358576,2.426217970681661,-1.38719369780694,0.6212983393334067,3.753063772015883,-3.305543195709715,-3.583840928080984,4.703621600236115,-1.987056840741556,7.578511284084792,3.333323852890057,0.3385436019387942,1.465089932547147,-5.795475436073221,5.628847340402627,0.4607831683733285,1.470934242018581,1.919755652924795,1.677793555034306,-1.472649508902512,1.009404928777823,-4.87797314478866,0.202940601160592,-0.3242642373961213,-3.95578271075701,-0.02152389151959695,5.848393858704886,-1.411420894595709,4.740330951812214,-1.038473001516115,-2.80713791875301,-0.2883094557418213,-7.74633234159958,-4.035232122509838,6.685550505620895,-1.319523918516817,-2.520962111635573,-5.597939401510345,-2.440200131068205,8.307201426140082,2.109013924918757,-0.7942927728118419,-0.7173491344418745,4.247433928476132,0.6939467367439102,1.582253454294854,-1.694684335500242,-2.127226290378688,1.934758610326032,4.142226556630658,1.260671196480675,2.991061227233014,2.090832443663686,3.051307685030584,0.5054026225359572,3.377834611263887,0.6380666961183541,1.838946271922016,1.954159841747294,0.6325787181139682,2.047499443614286,5.701689966574537,-5.307813608601652,-0.4437843510431971,0.5701562402293987,-1.993449175595404,-2.135956206893415,2.893584706462509,-2.343509165899746,0.4444659496225879,-8.299669903402583,1.466659328783849,-4.935714902062307,7.569081549293943,1.631704441621,1.003916507926721,2.851465894438695,-5.544823050680267,5.886761435064313,-1.804379095413142,-2.436483781188454,2.818106423137797,3.446885147867683,1.046147917114781,4.165659584941905,-3.404724550248112,-6.606282987890213,-15.12761097529897,6.801620333686417,4.679247051228318,4.362401086248326,3.927703378925794,4.405894397021156,-1.67955393436827,-2.061597771776871,12.60898419771894,5.716438253515311,0.377015105508666,2.082589801188253,1.743771909324616,2.570920356779279,3.165213465593448,-0.4886595897273908,-1.419778831404743,1.520239471350346,-3.333048531906763,2.73943692458656,-4.294986928758651,3.69101168942667,-2.398854975337383,-3.059624521225588,-0.4889769816189496,-6.476816836566925,1.633893033451412,-7.677343977036168,3.38284040393658,-4.394969366324091,-9.677782760630256,3.40383582146832,13.14604630447943,-2.191579741520703,8.695497247875657,-4.38532042863948,2.840489683964262,1.888945979125893,-3.414134648327581,4.55174090488793,3.767661808180328,-4.392413154646449,-3.370585760312614,-3.200260856252697,8.22551723996278,4.90197566946916,-1.656478012226382,3.16970913365576,3.349423069721992,-2.506396685973185,3.952430672306092,-0.570816678129539,2.54104521694168,2.577593288940233,2.55091327285543,-4.539682539682539,-0.3824409710675157,0.5842096478050434]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>date<\/th>\n      <th>intl_equity_adjusted<\/th>\n      <th>intl_equity_monthly_return<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,3]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"date","targets":1},{"name":"intl_equity_adjusted","targets":2},{"name":"intl_equity_monthly_return","targets":3}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
</section>
<section id="bond-market-total-returns" class="level1">
<h1>Bond Market Total Returns</h1>
<p>For Bond Market Total Returns, I working with the same dataset from Alpha Vantage, TIME_SERIES_MONTHLY_ADJUSTED and I chose to analyze AGG which is iShares Core U.S. Aggregate Bond ETF and tracks the performance of the U.S. bond market.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Request monthly adjusted data for AGG ETF</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>bond_response <span class="ot">&lt;-</span> <span class="fu">request</span>(base_url) <span class="sc">|&gt;</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_options</span>(<span class="at">cookies =</span> <span class="cn">NULL</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_url_query</span>(</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">function</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"TIME_SERIES_MONTHLY_ADJUSTED"</span>, </span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">symbol =</span> <span class="st">"AGG"</span>, </span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">apikey =</span> alpha_vantage_key</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_perform</span>()</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Parse JSON response</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>bond_data <span class="ot">&lt;-</span> bond_response <span class="sc">|&gt;</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">resp_body_json</span>() <span class="sc">%&gt;%</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>  .<span class="sc">$</span><span class="st">`</span><span class="at">Monthly Adjusted Time Series</span><span class="st">`</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert JSON data to a data frame</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>bond_df <span class="ot">&lt;-</span> bond_data <span class="sc">|&gt;</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_dfr</span>(as_tibble, <span class="at">.id =</span> <span class="st">"date"</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">date =</span> <span class="fu">as.Date</span>(date), </span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">bond_return =</span> <span class="fu">as.numeric</span>(<span class="st">`</span><span class="at">5. adjusted close</span><span class="st">`</span>) </span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date, bond_return)</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>bond_df <span class="ot">&lt;-</span> bond_df <span class="sc">|&gt;</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(date) <span class="sc">|&gt;</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">monthly_return =</span> (bond_return <span class="sc">-</span> <span class="fu">lag</span>(bond_return)) <span class="sc">/</span> <span class="fu">lag</span>(bond_return) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>bond_df <span class="ot">&lt;-</span> bond_df <span class="sc">|&gt;</span></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">bond_adjusted =</span> bond_return,  </span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">bond_monthly_return =</span> monthly_return </span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>bond_df <span class="ot">&lt;-</span> bond_df <span class="sc">|&gt;</span></span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> date <span class="sc">|&gt;</span></span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>           <span class="fu">floor_date</span>(<span class="at">unit =</span> <span class="st">"month"</span>) <span class="sc">|&gt;</span>  </span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>           <span class="fu">add_with_rollback</span>(<span class="fu">months</span>(<span class="dv">1</span>)))  </span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>bond_df <span class="sc">|&gt;</span> DT<span class="sc">::</span><span class="fu">datatable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-de73f1a3e0a0a25a2609" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-de73f1a3e0a0a25a2609">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149","150","151","152","153","154","155","156","157","158","159","160","161","162","163","164","165","166","167","168","169","170","171","172","173","174","175","176","177","178","179","180","181","182","183","184","185","186","187","188","189","190","191","192","193","194","195","196","197","198","199","200","201","202","203","204","205","206","207","208","209","210","211","212","213","214","215","216","217","218","219","220","221","222","223","224","225","226","227","228","229","230","231","232","233","234","235","236","237","238","239","240","241","242","243","244","245","246","247","248","249","250","251","252","253","254","255"],["2003-11-01","2003-12-01","2004-01-01","2004-02-01","2004-03-01","2004-04-01","2004-05-01","2004-06-01","2004-07-01","2004-08-01","2004-09-01","2004-10-01","2004-11-01","2004-12-01","2005-01-01","2005-02-01","2005-03-01","2005-04-01","2005-05-01","2005-06-01","2005-07-01","2005-08-01","2005-09-01","2005-10-01","2005-11-01","2005-12-01","2006-01-01","2006-02-01","2006-03-01","2006-04-01","2006-05-01","2006-06-01","2006-07-01","2006-08-01","2006-09-01","2006-10-01","2006-11-01","2006-12-01","2007-01-01","2007-02-01","2007-03-01","2007-04-01","2007-05-01","2007-06-01","2007-07-01","2007-08-01","2007-09-01","2007-10-01","2007-11-01","2007-12-01","2008-01-01","2008-02-01","2008-03-01","2008-04-01","2008-05-01","2008-06-01","2008-07-01","2008-08-01","2008-09-01","2008-10-01","2008-11-01","2008-12-01","2009-01-01","2009-02-01","2009-03-01","2009-04-01","2009-05-01","2009-06-01","2009-07-01","2009-08-01","2009-09-01","2009-10-01","2009-11-01","2009-12-01","2010-01-01","2010-02-01","2010-03-01","2010-04-01","2010-05-01","2010-06-01","2010-07-01","2010-08-01","2010-09-01","2010-10-01","2010-11-01","2010-12-01","2011-01-01","2011-02-01","2011-03-01","2011-04-01","2011-05-01","2011-06-01","2011-07-01","2011-08-01","2011-09-01","2011-10-01","2011-11-01","2011-12-01","2012-01-01","2012-02-01","2012-03-01","2012-04-01","2012-05-01","2012-06-01","2012-07-01","2012-08-01","2012-09-01","2012-10-01","2012-11-01","2012-12-01","2013-01-01","2013-02-01","2013-03-01","2013-04-01","2013-05-01","2013-06-01","2013-07-01","2013-08-01","2013-09-01","2013-10-01","2013-11-01","2013-12-01","2014-01-01","2014-02-01","2014-03-01","2014-04-01","2014-05-01","2014-06-01","2014-07-01","2014-08-01","2014-09-01","2014-10-01","2014-11-01","2014-12-01","2015-01-01","2015-02-01","2015-03-01","2015-04-01","2015-05-01","2015-06-01","2015-07-01","2015-08-01","2015-09-01","2015-10-01","2015-11-01","2015-12-01","2016-01-01","2016-02-01","2016-03-01","2016-04-01","2016-05-01","2016-06-01","2016-07-01","2016-08-01","2016-09-01","2016-10-01","2016-11-01","2016-12-01","2017-01-01","2017-02-01","2017-03-01","2017-04-01","2017-05-01","2017-06-01","2017-07-01","2017-08-01","2017-09-01","2017-10-01","2017-11-01","2017-12-01","2018-01-01","2018-02-01","2018-03-01","2018-04-01","2018-05-01","2018-06-01","2018-07-01","2018-08-01","2018-09-01","2018-10-01","2018-11-01","2018-12-01","2019-01-01","2019-02-01","2019-03-01","2019-04-01","2019-05-01","2019-06-01","2019-07-01","2019-08-01","2019-09-01","2019-10-01","2019-11-01","2019-12-01","2020-01-01","2020-02-01","2020-03-01","2020-04-01","2020-05-01","2020-06-01","2020-07-01","2020-08-01","2020-09-01","2020-10-01","2020-11-01","2020-12-01","2021-01-01","2021-02-01","2021-03-01","2021-04-01","2021-05-01","2021-06-01","2021-07-01","2021-08-01","2021-09-01","2021-10-01","2021-11-01","2021-12-01","2022-01-01","2022-02-01","2022-03-01","2022-04-01","2022-05-01","2022-06-01","2022-07-01","2022-08-01","2022-09-01","2022-10-01","2022-11-01","2022-12-01","2023-01-01","2023-02-01","2023-03-01","2023-04-01","2023-05-01","2023-06-01","2023-07-01","2023-08-01","2023-09-01","2023-10-01","2023-11-01","2023-12-01","2024-01-01","2024-02-01","2024-03-01","2024-04-01","2024-05-01","2024-06-01","2024-07-01","2024-08-01","2024-09-01","2024-10-01","2024-11-01","2024-12-01","2025-01-01"],[52.3257,52.5008,53.0149,53.2485,53.8561,54.2244,52.7024,52.5033,52.8857,53.3749,54.239,54.5188,54.9916,54.5855,55.021,55.2897,55.0844,54.548,55.487,55.946,56.4347,55.851,56.511,55.9816,55.4272,55.6347,56.2664,56.2329,56.3237,55.8351,55.752,55.6419,55.5524,56.3235,57.2189,57.7979,58.1941,58.8116,58.4584,58.4174,59.367,59.2511,59.6004,59.054,58.8318,59.4622,60.2237,60.6053,61.2172,62.3147,62.3119,63.7531,63.6512,63.7336,63.9442,63.1357,63.0182,63.267,63.737,62.6144,61.1879,63.0426,67.2368,65.9011,65.2059,65.92440000000001,66.2641,66.7355,67.01900000000001,67.8698,68.6987,69.5154,69.6691,70.5654,69.2377,70.2174,70.3571,70.352,71.0368,71.80589999999999,73.0753,73.7003,74.6486,74.6549,74.7684,74.1439,73.6464,73.58369999999999,73.798,73.6336,74.7877,75.7149,75.3767,76.6476,77.8125,78.41160000000001,78.5104,78.2495,79.3108,79.88630000000001,79.8758,79.4183,80.1379,81.00230000000001,80.9862,82.0891,82.0894,82.3065,82.26909999999999,82.49169999999999,82.2897,81.77849999999999,82.2624,82.3438,83.1414,81.4772,80.20189999999999,80.41719999999999,79.75320000000001,80.6474,81.3181,81.1155,80.6644,81.9074,82.2149,82.0928,82.6151,83.5831,83.69580000000001,83.48569999999999,84.4449,83.9259,84.67010000000001,85.37560000000001,85.5021,87.2569,86.47620000000001,86.80070000000001,86.5198,86.14190000000001,85.21510000000001,85.95050000000001,85.66160000000001,86.3565,86.4156,86.07940000000001,85.9135,86.97929999999999,87.7512,88.51479999999999,88.7443,88.75660000000001,90.4704,90.967,90.77119999999999,90.8176,90.0758,87.76479999999999,87.988,88.17529999999999,88.74509999999999,88.69710000000001,89.5012,90.1168,90.1006,90.402,91.25230000000001,90.73090000000001,90.8198,90.68510000000001,91.1156,90.09050000000001,89.18219999999999,89.7807,88.9363,89.52509999999999,89.61750000000001,89.5916,90.101,89.5432,88.9662,89.432,91.2029,92.0337,91.9297,93.8813,93.69410000000001,95.4846,96.53319999999999,96.7085,99.39830000000001,98.7902,98.9956,98.96169999999999,98.9147,100.9217,102.5215,101.9815,103.7351,104.433,105.1211,106.5223,105.6453,105.5423,104.9525,106.2188,106.3107,105.5191,103.917,102.7256,103.4772,103.6877,104.5461,105.713,105.5006,104.5332,104.5233,104.8061,104.4293,102.3422,101.1702,98.32389999999999,94.58199999999999,95.30249999999999,93.8233,96.2028,93.27589999999999,89.41079999999999,88.2658,91.627,90.8274,93.85209999999999,91.34910000000001,93.7629,94.3013,93.22490000000001,92.8806,92.8664,92.2814,89.8934,88.4834,92.544,95.96129999999999,95.8163,94.4021,95.2529,92.8946,94.4442,95.2786,97.58499999999999,99.0097,100.3279,97.8004,98.88849999999999,98.92],[null,0.3346347970500165,0.9792231737421128,0.4406308415181444,1.141065006526002,0.6838593956859205,-2.806854478795534,-0.3777816570023269,0.7283351713130355,0.9250137560815055,1.618925749743795,0.5158649680119501,0.8672237833554653,-0.7384764218535105,0.7978309257953075,0.4883589902037451,-0.3713168998927488,-0.973778420024545,1.721419667082203,0.8272207904554149,0.8735208951488962,-1.034292731245139,1.181715636246448,-0.9368087628957239,-0.9903253926290088,0.3743649327406095,1.135442448687591,-0.05953819686348609,0.1614713095003131,-0.8674856232811503,-0.1488311116125781,-0.1974817046922133,-0.1608500069192479,1.388058841742218,1.589744955480386,1.011903409537759,0.6854920334475826,1.061104132549519,-0.6005617939318112,-0.07013534410794141,1.625543074494922,-0.1952263041757143,0.5895249202124508,-0.916772370655228,-0.376265790632304,1.071529342974381,1.280645519338333,0.633637587859927,1.00964767107827,1.792796795671811,-0.004493321800474975,2.312880846194711,-0.1598353648685327,0.1294555326529583,0.3304379479583759,-1.264383634481317,-0.1861070677920728,0.3948065796865077,0.7428833357042358,-1.761300343599477,-2.278229927939905,3.031154852511691,6.652961648155379,-1.986560930918787,-1.054914106137834,1.1018941537499,0.515287207771316,0.7113957633167924,0.4248113822478345,1.269490741431523,1.221309035830376,1.188814344376236,0.2211020867318617,1.286510088403606,-1.881517004084145,1.414980566945456,0.1989535357333151,-0.007248735379938588,0.973390948373885,1.082678273796109,1.767821307162788,0.8552821541615293,1.286697611814339,0.008439542067762791,0.1520328873255499,-0.835245906024467,-0.6709924889303129,-0.08513654435248245,0.2912329768685302,-0.2227702647768239,1.567355120488472,1.239776059432232,-0.4466756213109975,1.686064791905188,1.519812753432597,0.7699277108433826,0.1260017650449641,-0.332312661762017,1.356302596182727,0.725626270318803,-0.01314368045585726,-0.5727642164460275,0.9060883952439169,1.078640693105264,-0.01987597883024144,1.361836954938008,0.0003654565587827715,0.2644677631947634,-0.04543991057815022,0.2705754651503419,-0.2448731205684914,-0.6212199096606286,0.5917203176874186,0.09895164741121355,0.9686218027343926,-2.001650200742359,-1.565223154453027,0.2684475056077215,-0.8256940057599461,1.121208929547652,0.8316449135371958,-0.2491450242934892,-0.5561205934747326,1.54095239039774,0.375423954367987,-0.1485132257048336,0.6362311920168411,1.171698636205734,0.1348358699306484,-0.2510281280542288,1.148939279421518,-0.6146019475421315,0.8867346075526226,0.8332339279155223,0.1481687976424095,2.052347252289713,-0.8947143435075001,0.3752477560299833,-0.3236149017231457,-0.4367786333301704,-1.075899184949485,0.8629925916885604,-0.3361236991058785,0.8112152936671622,0.06843723402407557,-0.3890501252088639,-0.1927290385388463,1.240550088170073,0.8874525318092953,0.8701875301990135,0.2592786743007967,0.01386004509586578,1.930898659930633,0.5489088143746472,-0.2152428902788984,0.05111753507721122,-0.8168020295625492,-2.565616958161911,0.2543160811623859,0.2128699368095574,0.6462127148986176,-0.05408749328130524,0.9065685349351794,0.6878120069898511,-0.01797667027679386,0.3345149754829613,0.9405765359173517,-0.5713828582950784,0.09798205462526582,-0.1483156756566246,0.474719661774641,-1.125054326591709,-1.008208412651735,0.6710980442285585,-0.9405139411922531,0.6620468807449736,0.1032112781778652,-0.02890060535052544,0.5685800900977317,-0.619083029045183,-0.6443817062602165,0.523569625318381,1.980163699794254,0.9109359461157447,-0.113002085105781,2.122926540606571,-0.1994007326272538,1.911006135925308,1.098187561135506,0.18159555469,2.781348071782734,-0.6117810867992787,0.2079153600255869,-0.03424394619559123,-0.04749312107613051,2.029020964528028,1.585189310128547,-0.5267187858156642,1.719527561371431,0.6727713184833332,0.6588913466049922,1.332938867648838,-0.8233017875130328,-0.0974960551960273,-0.5588280717778529,1.206545818346396,0.08651952385076411,-0.7446099028602037,-1.518303321389202,-1.146491911814238,0.7316579314211806,0.2034264552964425,0.8278706153188746,1.116158326326853,-0.200921362557101,-0.9169616096970179,-0.00947067534523729,0.2705616833758546,-0.3595210584116792,-1.998577027711564,-1.145177649102727,-2.813377852371548,-3.805687121849318,0.761772853185597,-1.552110385351897,2.536150401872448,-3.04242703954563,-4.143728444324846,-1.280605922327052,3.808043432450617,-0.8726685365667305,3.330162484008125,-2.666962167069236,2.642390565424284,0.5742143214426983,-1.141447678876105,-0.3693219300852069,-0.01528844559574597,-0.6299372001068133,-2.58773707377652,-1.568524496792864,4.589109369667072,3.692621887966802,-0.1511025798941824,-1.475949290465186,0.9012511374217231,-2.475830132205949,1.668127103190065,0.8834846396073049,2.420690480338708,1.45995798534611,1.331384702710951,-2.519239413961623,1.112572136719274,0.0318540578530449]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>date<\/th>\n      <th>bond_adjusted<\/th>\n      <th>bond_monthly_return<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,3]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"date","targets":1},{"name":"bond_adjusted","targets":2},{"name":"bond_monthly_return","targets":3}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="short-term-debt-returns" class="level1">
<h1>Short-Term Debt Returns</h1>
<p>To represent data on Short-Tern Debt Returns, I chose to analyze the dataset from FRED <a href="https://fred.stlouisfed.org/series/DGS3MO">“Market Yield on U.S. Treasury Securities at 3-Month Constant Maturity”</a>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>short_term_response <span class="ot">&lt;-</span> <span class="fu">request</span>(<span class="st">"https://api.stlouisfed.org/fred/series/observations"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_url_query</span>(<span class="at">series_id =</span> <span class="st">"DGS3MO"</span>,</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">api_key =</span> fred_key,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">file_type =</span> <span class="st">"json"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_perform</span>()</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Parse response into a data frame</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>short_term_df <span class="ot">&lt;-</span> short_term_response <span class="sc">%&gt;%</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">resp_body_json</span>() <span class="sc">%&gt;%</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pluck</span>(<span class="st">"observations"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_dfr</span>(<span class="sc">~</span><span class="fu">list</span>(<span class="at">date =</span> .x<span class="sc">$</span>date, <span class="at">value =</span> <span class="fu">as.numeric</span>(.x<span class="sc">$</span>value))) <span class="sc">%&gt;%</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">date =</span> <span class="fu">as.Date</span>(date),</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">date =</span> <span class="fu">floor_date</span>(date, <span class="st">"month"</span>)  <span class="co"># Extract year and month</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(date) <span class="sc">%&gt;%</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">average_yield =</span> <span class="fu">mean</span>(value, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>)  <span class="co"># Monthly average</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the data frame as a DataTable</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>  short_term_df,</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">options =</span> <span class="fu">list</span>(</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">pageLength =</span> <span class="dv">10</span>,</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">autoWidth =</span> <span class="cn">TRUE</span>,</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">dom =</span> <span class="st">'t&lt;"dt-buttons"p&gt;'</span>,</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">buttons =</span> <span class="fu">c</span>(<span class="st">'copy'</span>, <span class="st">'csv'</span>, <span class="st">'excel'</span>, <span class="st">'pdf'</span>, <span class="st">'print'</span>)</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"3-Month Treasury Yield Data (Monthly Averages)"</span></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-5118fb4fe059083bd368" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-5118fb4fe059083bd368">{"x":{"filter":"none","vertical":false,"caption":"<caption>3-Month Treasury Yield Data (Monthly Averages)<\/caption>","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149","150","151","152","153","154","155","156","157","158","159","160","161","162","163","164","165","166","167","168","169","170","171","172","173","174","175","176","177","178","179","180","181","182","183","184","185","186","187","188","189","190","191","192","193","194","195","196","197","198","199","200","201","202","203","204","205","206","207","208","209","210","211","212","213","214","215","216","217","218","219","220","221","222","223","224","225","226","227","228","229","230","231","232","233","234","235","236","237","238","239","240","241","242","243","244","245","246","247","248","249","250","251","252","253","254","255","256","257","258","259","260","261","262","263","264","265","266","267","268","269","270","271","272","273","274","275","276","277","278","279","280","281","282","283","284","285","286","287","288","289","290","291","292","293","294","295","296","297","298","299","300","301","302","303","304","305","306","307","308","309","310","311","312","313","314","315","316","317","318","319","320","321","322","323","324","325","326","327","328","329","330","331","332","333","334","335","336","337","338","339","340","341","342","343","344","345","346","347","348","349","350","351","352","353","354","355","356","357","358","359","360","361","362","363","364","365","366","367","368","369","370","371","372","373","374","375","376","377","378","379","380","381","382","383","384","385","386","387","388","389","390","391","392","393","394","395","396","397","398","399","400","401","402","403","404","405","406","407","408","409","410","411","412","413","414","415","416","417","418","419","420","421","422","423","424","425","426","427","428","429","430","431","432","433","434","435","436","437","438","439","440","441","442","443","444","445","446","447","448","449","450","451","452","453","454","455","456","457","458","459","460","461","462","463","464","465","466","467","468","469","470","471","472","473","474","475","476","477","478","479","480","481","482","483","484","485","486","487","488","489","490","491","492","493","494","495","496","497","498","499","500","501","502","503","504","505","506","507","508","509","510","511","512","513","514","515","516","517","518","519","520"],["1981-09-01","1981-10-01","1981-11-01","1981-12-01","1982-01-01","1982-02-01","1982-03-01","1982-04-01","1982-05-01","1982-06-01","1982-07-01","1982-08-01","1982-09-01","1982-10-01","1982-11-01","1982-12-01","1983-01-01","1983-02-01","1983-03-01","1983-04-01","1983-05-01","1983-06-01","1983-07-01","1983-08-01","1983-09-01","1983-10-01","1983-11-01","1983-12-01","1984-01-01","1984-02-01","1984-03-01","1984-04-01","1984-05-01","1984-06-01","1984-07-01","1984-08-01","1984-09-01","1984-10-01","1984-11-01","1984-12-01","1985-01-01","1985-02-01","1985-03-01","1985-04-01","1985-05-01","1985-06-01","1985-07-01","1985-08-01","1985-09-01","1985-10-01","1985-11-01","1985-12-01","1986-01-01","1986-02-01","1986-03-01","1986-04-01","1986-05-01","1986-06-01","1986-07-01","1986-08-01","1986-09-01","1986-10-01","1986-11-01","1986-12-01","1987-01-01","1987-02-01","1987-03-01","1987-04-01","1987-05-01","1987-06-01","1987-07-01","1987-08-01","1987-09-01","1987-10-01","1987-11-01","1987-12-01","1988-01-01","1988-02-01","1988-03-01","1988-04-01","1988-05-01","1988-06-01","1988-07-01","1988-08-01","1988-09-01","1988-10-01","1988-11-01","1988-12-01","1989-01-01","1989-02-01","1989-03-01","1989-04-01","1989-05-01","1989-06-01","1989-07-01","1989-08-01","1989-09-01","1989-10-01","1989-11-01","1989-12-01","1990-01-01","1990-02-01","1990-03-01","1990-04-01","1990-05-01","1990-06-01","1990-07-01","1990-08-01","1990-09-01","1990-10-01","1990-11-01","1990-12-01","1991-01-01","1991-02-01","1991-03-01","1991-04-01","1991-05-01","1991-06-01","1991-07-01","1991-08-01","1991-09-01","1991-10-01","1991-11-01","1991-12-01","1992-01-01","1992-02-01","1992-03-01","1992-04-01","1992-05-01","1992-06-01","1992-07-01","1992-08-01","1992-09-01","1992-10-01","1992-11-01","1992-12-01","1993-01-01","1993-02-01","1993-03-01","1993-04-01","1993-05-01","1993-06-01","1993-07-01","1993-08-01","1993-09-01","1993-10-01","1993-11-01","1993-12-01","1994-01-01","1994-02-01","1994-03-01","1994-04-01","1994-05-01","1994-06-01","1994-07-01","1994-08-01","1994-09-01","1994-10-01","1994-11-01","1994-12-01","1995-01-01","1995-02-01","1995-03-01","1995-04-01","1995-05-01","1995-06-01","1995-07-01","1995-08-01","1995-09-01","1995-10-01","1995-11-01","1995-12-01","1996-01-01","1996-02-01","1996-03-01","1996-04-01","1996-05-01","1996-06-01","1996-07-01","1996-08-01","1996-09-01","1996-10-01","1996-11-01","1996-12-01","1997-01-01","1997-02-01","1997-03-01","1997-04-01","1997-05-01","1997-06-01","1997-07-01","1997-08-01","1997-09-01","1997-10-01","1997-11-01","1997-12-01","1998-01-01","1998-02-01","1998-03-01","1998-04-01","1998-05-01","1998-06-01","1998-07-01","1998-08-01","1998-09-01","1998-10-01","1998-11-01","1998-12-01","1999-01-01","1999-02-01","1999-03-01","1999-04-01","1999-05-01","1999-06-01","1999-07-01","1999-08-01","1999-09-01","1999-10-01","1999-11-01","1999-12-01","2000-01-01","2000-02-01","2000-03-01","2000-04-01","2000-05-01","2000-06-01","2000-07-01","2000-08-01","2000-09-01","2000-10-01","2000-11-01","2000-12-01","2001-01-01","2001-02-01","2001-03-01","2001-04-01","2001-05-01","2001-06-01","2001-07-01","2001-08-01","2001-09-01","2001-10-01","2001-11-01","2001-12-01","2002-01-01","2002-02-01","2002-03-01","2002-04-01","2002-05-01","2002-06-01","2002-07-01","2002-08-01","2002-09-01","2002-10-01","2002-11-01","2002-12-01","2003-01-01","2003-02-01","2003-03-01","2003-04-01","2003-05-01","2003-06-01","2003-07-01","2003-08-01","2003-09-01","2003-10-01","2003-11-01","2003-12-01","2004-01-01","2004-02-01","2004-03-01","2004-04-01","2004-05-01","2004-06-01","2004-07-01","2004-08-01","2004-09-01","2004-10-01","2004-11-01","2004-12-01","2005-01-01","2005-02-01","2005-03-01","2005-04-01","2005-05-01","2005-06-01","2005-07-01","2005-08-01","2005-09-01","2005-10-01","2005-11-01","2005-12-01","2006-01-01","2006-02-01","2006-03-01","2006-04-01","2006-05-01","2006-06-01","2006-07-01","2006-08-01","2006-09-01","2006-10-01","2006-11-01","2006-12-01","2007-01-01","2007-02-01","2007-03-01","2007-04-01","2007-05-01","2007-06-01","2007-07-01","2007-08-01","2007-09-01","2007-10-01","2007-11-01","2007-12-01","2008-01-01","2008-02-01","2008-03-01","2008-04-01","2008-05-01","2008-06-01","2008-07-01","2008-08-01","2008-09-01","2008-10-01","2008-11-01","2008-12-01","2009-01-01","2009-02-01","2009-03-01","2009-04-01","2009-05-01","2009-06-01","2009-07-01","2009-08-01","2009-09-01","2009-10-01","2009-11-01","2009-12-01","2010-01-01","2010-02-01","2010-03-01","2010-04-01","2010-05-01","2010-06-01","2010-07-01","2010-08-01","2010-09-01","2010-10-01","2010-11-01","2010-12-01","2011-01-01","2011-02-01","2011-03-01","2011-04-01","2011-05-01","2011-06-01","2011-07-01","2011-08-01","2011-09-01","2011-10-01","2011-11-01","2011-12-01","2012-01-01","2012-02-01","2012-03-01","2012-04-01","2012-05-01","2012-06-01","2012-07-01","2012-08-01","2012-09-01","2012-10-01","2012-11-01","2012-12-01","2013-01-01","2013-02-01","2013-03-01","2013-04-01","2013-05-01","2013-06-01","2013-07-01","2013-08-01","2013-09-01","2013-10-01","2013-11-01","2013-12-01","2014-01-01","2014-02-01","2014-03-01","2014-04-01","2014-05-01","2014-06-01","2014-07-01","2014-08-01","2014-09-01","2014-10-01","2014-11-01","2014-12-01","2015-01-01","2015-02-01","2015-03-01","2015-04-01","2015-05-01","2015-06-01","2015-07-01","2015-08-01","2015-09-01","2015-10-01","2015-11-01","2015-12-01","2016-01-01","2016-02-01","2016-03-01","2016-04-01","2016-05-01","2016-06-01","2016-07-01","2016-08-01","2016-09-01","2016-10-01","2016-11-01","2016-12-01","2017-01-01","2017-02-01","2017-03-01","2017-04-01","2017-05-01","2017-06-01","2017-07-01","2017-08-01","2017-09-01","2017-10-01","2017-11-01","2017-12-01","2018-01-01","2018-02-01","2018-03-01","2018-04-01","2018-05-01","2018-06-01","2018-07-01","2018-08-01","2018-09-01","2018-10-01","2018-11-01","2018-12-01","2019-01-01","2019-02-01","2019-03-01","2019-04-01","2019-05-01","2019-06-01","2019-07-01","2019-08-01","2019-09-01","2019-10-01","2019-11-01","2019-12-01","2020-01-01","2020-02-01","2020-03-01","2020-04-01","2020-05-01","2020-06-01","2020-07-01","2020-08-01","2020-09-01","2020-10-01","2020-11-01","2020-12-01","2021-01-01","2021-02-01","2021-03-01","2021-04-01","2021-05-01","2021-06-01","2021-07-01","2021-08-01","2021-09-01","2021-10-01","2021-11-01","2021-12-01","2022-01-01","2022-02-01","2022-03-01","2022-04-01","2022-05-01","2022-06-01","2022-07-01","2022-08-01","2022-09-01","2022-10-01","2022-11-01","2022-12-01","2023-01-01","2023-02-01","2023-03-01","2023-04-01","2023-05-01","2023-06-01","2023-07-01","2023-08-01","2023-09-01","2023-10-01","2023-11-01","2023-12-01","2024-01-01","2024-02-01","2024-03-01","2024-04-01","2024-05-01","2024-06-01","2024-07-01","2024-08-01","2024-09-01","2024-10-01","2024-11-01","2024-12-01"],[15.60714285714286,14.23095238095238,11.34555555555556,11.31904761904762,12.918,14.27944444444444,13.31478260869565,13.3447619047619,12.714,13.07863636363636,11.86333333333333,8.997272727272728,8.192857142857143,7.9675,8.346315789473683,8.202727272727273,8.117142857142857,8.39421052631579,8.659565217391304,8.513500000000001,8.495714285714286,9.139545454545454,9.4495,9.739130434782609,9.361428571428572,8.988,9.111052631578948,9.357619047619048,9.263809523809524,9.459473684210526,9.889545454545454,10.073,10.22318181818182,10.26047619047619,10.53095238095238,10.90043478260869,10.79578947368421,10.12454545454545,8.924736842105263,8.3375,8.02,8.557222222222222,8.83,8.221904761904762,7.733181818181818,7.18,7.316363636363636,7.370454545454545,7.333157894736842,7.40090909090909,7.476315789473684,7.33,7.301904761904762,7.290526315789474,6.764,6.235454545454545,6.334761904761905,6.396666666666667,5.999545454545455,5.685238095238095,5.352380952380952,5.323181818181818,5.5,5.682727272727273,5.578,5.751052631578947,5.765909090909091,5.815714285714286,5.8465,5.854545454545454,5.879090909090909,6.233333333333333,6.621428571428571,6.350952380952381,5.89,5.959545454545454,6.004736842105263,5.8425,5.87,6.083,6.454285714285715,6.664090909090909,6.948,7.299565217391304,7.478095238095238,7.597,8.028499999999999,8.348571428571429,8.5585,8.836842105263157,9.142272727272728,8.9625,8.735909090909091,8.434545454545454,8.147,8.17,8.0145,7.899523809523809,7.943809523809524,7.8795,7.898095238095238,8.002105263157894,8.17,8.0405,8.006818181818181,7.986666666666666,7.874761904761905,7.694347826086957,7.597894736842105,7.4,7.2905,6.9495,6.41047619047619,6.116315789473684,6.0935,5.825454545454545,5.633636363636364,5.751,5.750909090909091,5.497727272727273,5.3735,5.144090909090909,4.689473684210526,4.184285714285714,3.906190476190476,3.95,4.138636363636364,3.839047619047619,3.719,3.745,3.279545454545454,3.199047619047619,2.968571428571428,2.932857142857143,3.205789473684211,3.291363636363636,3.071052631578947,2.992631578947369,3.014347826086957,2.93047619047619,3.025,3.144545454545455,3.110952380952381,3.090454545454545,3.008571428571428,3.092,3.1795,3.127727272727273,3.0445,3.330526315789474,3.590869565217391,3.780526315789474,4.267619047619047,4.249090909090909,4.4565,4.611739130434783,4.751428571428572,5.102,5.449,5.764761904761905,5.9015,5.939473684210526,5.910434782608696,5.837894736842105,5.847727272727273,5.639090909090909,5.593,5.565652173913043,5.434,5.444285714285714,5.518095238095238,5.294,5.150476190476191,4.9645,5.097619047619047,5.087727272727273,5.153636363636363,5.2315,5.298181818181818,5.189090909090909,5.2375,5.123181818181818,5.169473684210526,5.04047619047619,5.165714285714285,5.142105263157895,5.2845,5.304545454545455,5.196666666666666,5.070952380952381,5.194545454545454,5.27952380952381,5.084761904761905,5.112727272727272,5.281111111111111,5.304545454545455,5.179,5.23,5.161818181818182,5.082857142857143,5.14,5.124090909090909,5.094545454545455,5.040952380952381,4.739047619047619,4.070476190476191,4.531052631578947,4.496818181818182,4.446315789473684,4.555263157894737,4.566521739130435,4.409090909090909,4.631,4.715454545454546,4.685714285714286,4.873636363636364,4.822380952380953,5.0185,5.2275,5.356818181818181,5.499,5.727,5.863913043478261,5.821578947368421,5.994545454545454,5.861818181818181,6.1425,6.277391304347826,6.175,6.294761904761905,6.356190476190476,5.937,5.285238095238095,5.005263157894737,4.535454545454545,3.966,3.703181818181818,3.565238095238095,3.593333333333333,3.437826086956522,2.692352941176471,2.197727272727273,1.9065,1.72,1.684761904761905,1.756842105263158,1.825,1.745,1.760454545454545,1.732,1.713636363636364,1.647272727272727,1.659,1.61,1.254736842105263,1.210952380952381,1.189047619047619,1.185263157894737,1.150952380952381,1.152380952380952,1.088095238095238,0.9361904761904762,0.9204545454545455,0.969047619047619,0.9552380952380952,0.9418181818181818,0.9522222222222222,0.9145454545454546,0.9005,0.9447368421052631,0.9534782608695652,0.9580952380952381,1.0395,1.288095238095238,1.357619047619048,1.503181818181818,1.681428571428571,1.7945,2.1075,2.222727272727273,2.371,2.579473684210526,2.795909090909091,2.836666666666666,2.901904761904762,3.036363636363636,3.2875,3.518260869565217,3.494285714285714,3.7925,3.9745,3.970952380952381,4.336,4.539473684210527,4.627826086956522,4.721578947368421,4.836363636363636,4.917727272727273,5.0765,5.090434782608695,4.93,5.046190476190477,5.073333333333333,4.973,5.105238095238096,5.163157894736842,5.08,5.006666666666667,4.867727272727273,4.741904761904762,4.960952380952381,4.31695652173913,3.994210526315789,4.002727272727273,3.3545,3.0665,2.82,2.174,1.2835,1.311818181818182,1.764285714285714,1.89047619047619,1.655,1.752857142857143,1.146666666666667,0.6859090909090909,0.1938888888888889,0.03409090909090909,0.1295,0.2952631578947368,0.2159090909090909,0.1580952380952381,0.177,0.1786363636363636,0.1836363636363636,0.1719047619047619,0.1233333333333333,0.07428571428571429,0.05210526315789474,0.05454545454545455,0.06157894736842105,0.1089473684210526,0.1504347826086957,0.1622727272727273,0.16,0.1236363636363636,0.1576190476190476,0.155,0.1519047619047619,0.1345,0.143,0.1409090909090909,0.152,0.1321052631578947,0.1004347826086956,0.0585,0.04095238095238096,0.03727272727272728,0.0375,0.02434782608695652,0.01380952380952381,0.019,0.014,0.01142857142857143,0.0345,0.092,0.08409090909090909,0.08380952380952381,0.08954545454545455,0.09142857142857143,0.09714285714285714,0.1026086956521739,0.1052631578947369,0.1047619047619048,0.0935,0.07000000000000001,0.07428571428571429,0.09894736842105263,0.08700000000000001,0.06,0.04409090909090909,0.0505,0.03545454545454545,0.04363636363636364,0.016,0.04727272727272727,0.06789473684210527,0.06666666666666667,0.04333333333333333,0.05263157894736843,0.05238095238095238,0.03095238095238095,0.03238095238095238,0.03571428571428571,0.02636363636363636,0.03285714285714286,0.02,0.01681818181818182,0.02166666666666667,0.02909090909090909,0.0275,0.01789473684210526,0.02772727272727273,0.02318181818181818,0.0165,0.015,0.03227272727272727,0.0719047619047619,0.02428571428571428,0.01666666666666666,0.1263157894736842,0.2286363636363636,0.2573684210526316,0.3145,0.2972727272727272,0.2280952380952381,0.2766666666666667,0.2727272727272728,0.301,0.2995652173913044,0.2942857142857143,0.3315,0.4525,0.5119047619047619,0.519,0.5263157894736842,0.7478260869565218,0.8084210526315789,0.9031818181818182,0.9990909090909091,1.0865,1.032173913043478,1.0465,1.093333333333333,1.250476190476191,1.3415,1.432380952380952,1.587894736842105,1.726666666666667,1.788095238095238,1.899545454545454,1.935238095238095,1.994761904761905,2.072608695652174,2.165263157894737,2.293181818181818,2.374,2.412105263157895,2.423809523809524,2.437894736842106,2.453809523809524,2.432857142857143,2.403181818181818,2.2195,2.145,1.990454545454545,1.9345,1.678636363636364,1.572105263157895,1.565238095238095,1.552380952380952,1.544736842105263,0.2954545454545455,0.1380952380952381,0.1275,0.1595454545454545,0.1268181818181818,0.1042857142857143,0.1085714285714286,0.1004761904761905,0.09105263157894737,0.08727272727272727,0.08368421052631579,0.04263157894736842,0.03130434782608696,0.02090909090909091,0.018,0.03590909090909091,0.05238095238095238,0.05454545454545455,0.0419047619047619,0.052,0.0515,0.05863636363636364,0.1455,0.3147368421052631,0.4473913043478261,0.7635,0.9928571428571429,1.538571428571428,2.298,2.721739130434782,3.221904761904762,3.8725,4.323,4.358095238095238,4.6875,4.787894736842105,4.858695652173913,5.0735,5.308181818181819,5.415714285714285,5.4885,5.559130434782609,5.5555,5.604761904761904,5.522857142857143,5.442,5.453809523809524,5.4405,5.468500000000001,5.443636363636363,5.455,5.506315789473684,5.431818181818182,5.295454545454546,4.922,4.718181818181819,4.62,4.461666666666667]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>date<\/th>\n      <th>average_yield<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"autoWidth":true,"dom":"t<\"dt-buttons\"p>","buttons":["copy","csv","excel","pdf","print"],"columnDefs":[{"className":"dt-right","targets":2},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"date","targets":1},{"name":"average_yield","targets":2}],"order":[],"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the graph visualization</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(short_term_df, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> average_yield)) <span class="sc">+</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"3-Month Treasury Yield (Monthly Averages)"</span>,</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Date"</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Yield (%)"</span>,</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Source: FRED - DGS3MO"</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/unnamed-chunk-10-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="monte-carlo-simulation" class="level1">
<h1>Monte Carlo Simulation</h1>
<ol type="1">
<li>Prepare Data</li>
</ol>
<p>First step to our Monte Carlo simulation is to gather all the data together in one same data frame.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure all datasets have a common date format and merge them</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>combined_data <span class="ot">&lt;-</span> <span class="fu">reduce</span>(</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    inflation_df <span class="sc">|&gt;</span> <span class="fu">select</span>(date, inflation_cpi, mom_inflation_rate, yoy_inflation_rate),</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    wage_growth_df <span class="sc">|&gt;</span> <span class="fu">select</span>(date, wage_growth),</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    equity_df <span class="sc">|&gt;</span> <span class="fu">select</span>(date, us_equity_monthly_return),</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    intl_equity_df <span class="sc">|&gt;</span> <span class="fu">select</span>(date, intl_equity_monthly_return),</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    bond_df <span class="sc">|&gt;</span> <span class="fu">select</span>(date, bond_monthly_return),</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    short_term_df <span class="sc">|&gt;</span> <span class="fu">select</span>(date, average_yield)</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  full_join,</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="st">"date"</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>) </span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>combined_data <span class="ot">&lt;-</span> combined_data <span class="sc">%&gt;%</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">complete.cases</span>(.))</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>combined_data <span class="sc">|&gt;</span> DT<span class="sc">::</span><span class="fu">datatable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-b5d6407719597d575dc0" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-b5d6407719597d575dc0">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149","150","151","152","153","154","155","156","157","158","159","160","161","162","163","164","165","166","167","168","169","170","171","172","173","174","175","176","177","178","179","180","181","182","183","184","185","186","187","188","189","190","191","192","193","194","195","196","197","198","199","200","201","202","203","204","205","206","207","208","209"],["2007-06-01","2007-07-01","2007-08-01","2007-09-01","2007-10-01","2007-11-01","2007-12-01","2008-01-01","2008-02-01","2008-03-01","2008-04-01","2008-05-01","2008-06-01","2008-07-01","2008-08-01","2008-09-01","2008-10-01","2008-11-01","2008-12-01","2009-01-01","2009-02-01","2009-03-01","2009-04-01","2009-05-01","2009-06-01","2009-07-01","2009-08-01","2009-09-01","2009-10-01","2009-11-01","2009-12-01","2010-01-01","2010-02-01","2010-03-01","2010-04-01","2010-05-01","2010-06-01","2010-07-01","2010-08-01","2010-09-01","2010-10-01","2010-11-01","2010-12-01","2011-01-01","2011-02-01","2011-03-01","2011-04-01","2011-05-01","2011-06-01","2011-07-01","2011-08-01","2011-09-01","2011-10-01","2011-11-01","2011-12-01","2012-01-01","2012-02-01","2012-03-01","2012-04-01","2012-05-01","2012-06-01","2012-07-01","2012-08-01","2012-09-01","2012-10-01","2012-11-01","2012-12-01","2013-01-01","2013-02-01","2013-03-01","2013-04-01","2013-05-01","2013-06-01","2013-07-01","2013-08-01","2013-09-01","2013-10-01","2013-11-01","2013-12-01","2014-01-01","2014-02-01","2014-03-01","2014-04-01","2014-05-01","2014-06-01","2014-07-01","2014-08-01","2014-09-01","2014-10-01","2014-11-01","2014-12-01","2015-01-01","2015-02-01","2015-03-01","2015-04-01","2015-05-01","2015-06-01","2015-07-01","2015-08-01","2015-09-01","2015-10-01","2015-11-01","2015-12-01","2016-01-01","2016-02-01","2016-03-01","2016-04-01","2016-05-01","2016-06-01","2016-07-01","2016-08-01","2016-09-01","2016-10-01","2016-11-01","2016-12-01","2017-01-01","2017-02-01","2017-03-01","2017-04-01","2017-05-01","2017-06-01","2017-07-01","2017-08-01","2017-09-01","2017-10-01","2017-11-01","2017-12-01","2018-01-01","2018-02-01","2018-03-01","2018-04-01","2018-05-01","2018-06-01","2018-07-01","2018-08-01","2018-09-01","2018-10-01","2018-11-01","2018-12-01","2019-01-01","2019-02-01","2019-03-01","2019-04-01","2019-05-01","2019-06-01","2019-07-01","2019-08-01","2019-09-01","2019-10-01","2019-11-01","2019-12-01","2020-01-01","2020-02-01","2020-03-01","2020-04-01","2020-05-01","2020-06-01","2020-07-01","2020-08-01","2020-09-01","2020-10-01","2020-11-01","2020-12-01","2021-01-01","2021-02-01","2021-03-01","2021-04-01","2021-05-01","2021-06-01","2021-07-01","2021-08-01","2021-09-01","2021-10-01","2021-11-01","2021-12-01","2022-01-01","2022-02-01","2022-03-01","2022-04-01","2022-05-01","2022-06-01","2022-07-01","2022-08-01","2022-09-01","2022-10-01","2022-11-01","2022-12-01","2023-01-01","2023-02-01","2023-03-01","2023-04-01","2023-05-01","2023-06-01","2023-07-01","2023-08-01","2023-09-01","2023-10-01","2023-11-01","2023-12-01","2024-01-01","2024-02-01","2024-03-01","2024-04-01","2024-05-01","2024-06-01","2024-07-01","2024-08-01","2024-09-01","2024-10-01"],[207.234,207.603,207.667,208.547,209.19,210.834,211.445,212.174,212.687,213.448,213.942,215.208,217.463,219.016,218.69,218.877,216.995,213.153,211.398,211.933,212.705,212.495,212.709,213.022,214.79,214.726,215.445,215.861,216.509,217.234,217.347,217.488,217.281,217.353,217.403,217.29,217.199,217.605,217.923,218.275,219.035,219.59,220.472,221.187,221.898,223.046,224.093,224.806,224.806,225.395,226.106,226.597,226.75,227.169,227.223,227.842,228.329,228.807,229.187,228.713,228.524,228.59,229.918,231.015,231.638,231.249,231.221,231.679,232.937,232.282,231.797,231.893,232.445,232.9,233.456,233.544,233.669,234.1,234.719,235.288,235.547,236.028,236.468,236.918,237.231,237.498,237.46,237.477,237.43,236.983,236.252,234.747,235.342,235.976,236.222,237.001,237.657,238.034,238.033,237.498,237.733,238.017,237.761,237.652,237.336,238.08,238.992,239.557,240.222,240.101,240.545,241.176,241.741,242.026,242.637,243.618,244.006,243.892,244.193,244.004,244.163,244.243,245.183,246.435,246.626,247.284,247.805,248.859,249.529,249.577,250.227,250.792,251.018,251.214,251.663,252.182,252.772,252.594,252.767,252.561,253.319,254.277,255.233,255.296,255.213,255.802,256.036,256.43,257.155,257.879,258.63,258.906,259.246,258.15,256.126,255.848,257.004,258.408,259.366,259.951,260.249,260.895,262.005,262.518,263.583,264.91,266.752,268.452,270.664,271.994,272.789,273.887,276.434,278.799,280.808,282.39,284.535,287.553,288.764,291.359,294.996,294.977,295.209,296.341,297.863,298.648,298.812,300.356,301.509,301.744,303.032,303.365,304.003,304.628,306.187,307.288,307.531,308.024,308.742,309.685,311.054,312.23,313.207,313.225,313.049,313.534,314.121,314.686,315.454],[0.231675171096235,0.1780595848171584,0.03082807088530259,0.4237553390765036,0.3083237831280172,0.7858884267890387,0.2898014551732553,0.3447705076970342,0.2417826877939788,0.3578027806118822,0.2314381020201539,0.5917491656617146,1.04782350098509,0.7141444751521009,-0.1488475727800642,0.08550916822900323,-0.8598436564828615,-1.770547708472547,-0.8233522399403226,0.2530771341261451,0.3642660652187324,-0.0987282856538485,0.1007082519588698,0.1471493918921984,0.8299612246622345,-0.02979654546301225,0.3348453377792993,0.1930887233400513,0.3001931798703783,0.3348590589767664,0.05201763996427466,0.06487322116246474,-0.09517766497462166,0.03313681361922782,0.02300405331419064,-0.05197720362644098,-0.04187951585438165,0.186925354168288,0.1461363479699607,0.1615249422961318,0.348184629481163,0.25338416234848,0.4016576346828282,0.3243042200370194,0.321447463006419,0.51735482068338,0.4694098975099203,0.3181714734507679,0,0.2620036831757044,0.3154462166418792,0.2171547858084377,0.06752075270193281,0.1847850055126887,0.02377084901548088,0.2724196054096684,0.2137446124946152,0.2093470387029228,0.1660788350006825,-0.2068180132381081,-0.08263631713106845,0.02888099280600187,0.580952797585188,0.4771266277542319,0.2696794580438588,-0.1679344494426638,-0.01210816046771646,0.1980788942180789,0.5429926752100966,-0.2811919102589933,-0.2087979266581219,0.04141554895016331,0.2380408205508555,0.1957452300544338,0.2387290682696275,0.03769446919335007,0.05352310485391421,0.184448942735238,0.2644169158479315,0.242417529045369,0.1100778620244158,0.204205530106516,0.1864185605097601,0.1903005903547195,0.1321132206079767,0.1125485286492811,-0.01600013473797013,0.007159100480080838,-0.01979139032411981,-0.1882660152465965,-0.3084609444559239,-0.6370316441765556,0.2534643680217386,0.2693951780812442,0.1042478896158938,0.3297745341246827,0.2767920810460733,0.1586319780187306,-0.000420108051790713,-0.2247587519377592,0.09894820166906904,0.1194617491050876,-0.1075553426856057,-0.04584435630738959,-0.1329675323582302,0.3134796238244419,0.3830645161290169,0.236409586931785,0.2775957287827202,-0.05037007434789409,0.184922178583169,0.2623209794425208,0.2342687497926876,0.1178947716771184,0.2524522158776188,0.4043076694815628,0.1592657357009752,-0.04672016261895173,0.1234152821740775,-0.07739779600562935,0.06516286618252209,0.03276499715354486,0.3848626163288182,0.5106389920997767,0.07750522450138408,0.2668007428251684,0.2106889244755106,0.4253344363511546,0.2692287600609022,0.0192362410782021,0.2604406656061986,0.2257949781598212,0.09011451720948305,0.07808204989283585,0.1787320770339385,0.2062281702117419,0.2339580144498754,-0.07041919199911595,0.06848935445813442,-0.08149798035343991,0.3001255142321968,0.3781792917230797,0.3759679404743643,0.02468332856644384,-0.03251128102280676,0.2307876166182776,0.09147700174354512,0.1538846099767177,0.2827282299262768,0.281542260504386,0.2912218521089249,0.1067161582183118,0.1313217924651999,-0.4227644785261941,-0.7840402866550411,-0.1085403278073938,0.4518307745223771,0.5462949992996124,0.3707315562985647,0.2255499949877837,0.1146369892787602,0.2482238164219552,0.4254585177945192,0.1957977901184904,0.4056864672137062,0.5034467321488822,0.6953304896002432,0.6372960652591075,0.823983430929931,0.4913841515680195,0.2922858592468769,0.4025088988192316,0.929945561490686,0.8555387542776849,0.7205908199096944,0.5633742628415206,0.7595878041007254,1.060677948231326,0.4211397551060259,0.8986577274175289,1.248288194289526,-0.006440765298509898,0.07865019984609756,0.3834571439217616,0.5135975109755275,0.2635439782719073,0.05491414641987102,0.5167128495508821,0.3838777983459662,0.07794128865141747,0.4268519009491323,0.109889384619466,0.2103077151286437,0.2055900764137197,0.5117717347059347,0.3595841756834917,0.07907890968732456,0.160309042015272,0.2330987195803047,0.3054330152683971,0.4420620953549559,0.3780694027403664,0.3129103545463252,0.00574699799176237,-0.05618964003513138,0.1549278228009099,0.1872205247277714,0.1798669939290898,0.2440528018405663],[2.692765113974227,2.317890586495808,1.897448478900876,2.833826429980268,3.610698365527476,4.373267326732666,4.108813392417532,4.294695655165981,4.142959270611968,3.974903550134434,3.903760975988813,4.088413823123993,4.935966105947864,5.497512078341837,5.308017162091239,4.953319875136075,3.731057889956513,1.099917470616685,-0.02222800255385904,-0.1135860190221272,0.008463140671510772,-0.4464787676623838,-0.5763244243767063,-1.015761495855172,-1.229174618210915,-1.958761003762277,-1.483835566326763,-1.377942862886472,-0.2239682942003385,1.914587174470928,2.814123123208367,2.621111388976716,2.151336357866529,2.286171439327989,2.20677075253044,2.003548929218568,1.121560594068627,1.340778480482108,1.150177539511255,1.118312247233177,1.166695148931463,1.084544776600338,1.437793022217937,1.700783491502977,2.124898173333145,2.619241510354109,3.077234444786869,3.4589718808965,3.502318150636041,3.579880976999616,3.75499603070808,3.812621692818685,3.522268130664052,3.451432214581729,3.062066838419386,3.008766337985502,2.898178442347388,2.582875281332098,2.273163374134857,1.737942937466075,1.653870448297634,1.417511479846478,1.685934915482123,1.949716898281961,2.155678059536936,1.796019703392626,1.759504979689552,1.684061762098299,2.018140490257481,1.518747241124618,1.138808047576867,1.390388827919709,1.715793527156872,1.885471805415806,1.538809488600279,1.0947341081748,0.8767991434911471,1.232870196195446,1.51283836675733,1.557758795574915,1.120474634772495,1.612694913940804,2.015125303606169,2.166947687079812,2.058981694594419,1.974237870330597,1.715098348296906,1.684050971123208,1.609541702151329,1.231524989320798,0.6531213919623191,-0.2299309782054282,-0.08703146293520536,-0.02203128442387348,-0.1040309893939106,0.03503321824429584,0.1795718097550525,0.2256861110409458,0.2413037985344868,0.008842961634170088,0.1276165606705071,0.4363182169185187,0.6387247515364791,1.237502502694388,0.8472775790126619,0.8916160965521946,1.172625750353484,1.078476462124622,1.079286534795942,0.8683633430518256,1.055315859565686,1.548644620165218,1.685924966243646,1.684333471978894,2.050798911511986,2.510393348257112,2.810361681329421,2.44119623655914,2.176223471915395,1.856343166761976,1.640565809959127,1.725107350656607,1.92812155729698,2.180565230371179,2.020757753132485,2.172493864295566,2.129930719552253,2.151318868063945,2.263468931091861,2.330949764649937,2.470996302105299,2.781921607842497,2.807550693594019,2.854124785561929,2.642923856874257,2.332055105808828,2.492032470218053,2.147328577667773,2.002380904340106,1.487589357829133,1.518861535132188,1.883186351306398,2.000583470209061,1.795910555360614,1.671194894390049,1.826331335037068,1.737641210666641,1.684497704039156,1.733973699618629,2.092290394862917,2.319527469962446,2.512264363856653,2.339737643050843,1.523142085206297,0.3498763874577149,0.2162196039107611,0.7017667595302868,1.018756694631007,1.300598353356563,1.373084272511016,1.203165406078077,1.169540753609244,1.304953021691224,1.395100924659909,1.672928415481834,2.61863257795858,4.148739292379555,4.926362527750849,5.315092372103147,5.25757716479367,5.175312107215291,5.361010344257178,6.219044069333601,6.862530903236941,7.176580599606885,7.569766644572939,7.948919315737357,8.547431203050081,8.251859404990402,8.532996587844366,8.989743741317646,8.449818746001725,8.218806476800754,8.19827154994579,7.751940788759693,7.119465995215202,6.411498247913161,6.362123304649603,5.965522694923298,4.935090226845151,4.941059134795189,4.120689595996696,3.053261739142221,3.271780511700917,3.718721312697104,3.694055159427823,3.245787492907826,3.139481931906452,3.323159712461354,3.105980902662187,3.165742979479869,3.475131237075124,3.357731196705305,3.25021014289717,2.975628529981611,2.923565791719729,2.591226929948021,2.407513472703116,2.576325638716104],[0.00527831094049902,0,0.002386634844868674,0.001904761904761854,0.0009505703422052481,0.002849002849002913,0.00236742424242431,0.001417099669343225,0.002830188679245449,0.00470366886171214,0.000936329588014928,0.004209541627689495,0.001863064741499887,0.004184100418409997,0.004629629629629539,0.0009216589861751334,0.001841620626151119,0.005055147058823595,0.003200731595793371,0.0009115770282588365,0.00136612021857907,0.00318326512050926,0.001359927470534927,0.0009053870529651675,0.001356852103120865,0.001806684733513864,0.002254283137962165,0.001799370220422869,0.001347103726986987,0.00224215246636783,0.0004474272930647949,0.002236135957066177,0.001784917447567924,0.0004454342984410165,0.001335707925200325,0.001778568252556845,0,0.002663115845539243,0.001328021248339972,0.002210433244915988,0.003087781208645612,-0.0004397537379067229,0.001319841619005668,0.004393673110720364,0.0004374453193352057,0,0.00174901617839951,0.003055434308162353,0.001305483028720689,0.003911342894393766,-0.001298701298701355,0.00216731686172511,0.003460207612456578,-0.0004310344827584967,0.001293661060801865,0.001291989664082838,0.00129032258064532,0.003436426116838476,0.001284246575342429,0.0004275331338177146,0.002564102564102555,0.001705029838022121,-0.0008510638297871687,0.003833049403747957,-0.0004242681374629909,0.002971137521222467,0.004231908590774491,0.0008428150021069225,0.001263157894736855,0.000841042893187538,0.002941176470588225,0.0008378718056136769,0.002930096274591953,0.0008347245409014992,0.001668056713928223,0.001665278934221526,0.001246882793017434,0.002905770029057786,0.0008278145695364003,0.002067824648469774,0.004127115146512539,-0.0004110152075625928,0.000822368421052655,0.002465078060805315,0.002459016393442814,0.0008176614881438837,0.002450980392156854,0.0004074979625101616,0.001221995926680153,0.003254678600488337,-0.001622060016220561,0.005280259951259136,0.001616161616161627,0.002823719241629608,0.001206757843926098,0.003214142225793415,0,0.00120144173007608,0.003600000000000048,0.0007971303308089706,0.003185981680605465,0.002381897578404013,-0.0003960396039605074,0.005546751188589605,0,0.002758077226162392,0.003143418467583592,0.001958480219349745,0.001563721657545036,0.002732240437158584,0.001167769560139975,0.001944012441679632,0.00465657741559955,0.0003862495171880198,0.0007722007722008595,0.003086419753086433,0.002692307692307772,0.0015343306482547,0.002297970126388549,0.001528467711119585,0.001907668828691422,0.003808073115003641,0.0007587253414262918,0.004169825625473855,0,0.001510003775009539,0.003015454202789147,0.004509582863585049,0.0007482229704451893,0.00411214953271033,0.001861504095308941,0.002601263470828785,0.002223869532987255,0.001849112426035582,0.004060538944259839,0.004411764705882337,0.001830161054172885,0.002557544757033181,0.004008746355685044,0.001451905626134176,0.004349401957230992,0.003247924936846003,-0.0007194244604316058,0.002879769618430394,0.003230437903804839,0.002504472271914082,0.003925767309064909,0.001421969427657377,0.002129925452609038,0.004250797024442088,0.000705467372134061,0.002467395135706818,0.003867791842475432,0.007705779334500784,0.04310045185957612,-0.009663445518160674,-0.01144010767160164,0,0.003403675970047759,0.001017639077340649,0.001016604540833521,0.0030467163168586,0.009112386095173841,0.001003344481605328,0.004343468092215197,0,0.004990019960079861,0.005958291956305928,0.004935834155972207,0.003601833660772824,0.003915171288743968,0.005849853753656209,0.00646203554119551,0.002889245585874889,0.00512163892445594,0.007324840764331153,0.0006323110970596346,0.006003159557661952,0.003454773869346672,0.00406885758998432,0.003740648379052525,0.004037267080745144,0.003402412619857742,0.003082614056720168,0.004917025199754343,0.003975535168195599,0.003350593968930893,0.003946569520340004,0.002419110976715988,0.004826546003016796,0.003902731912338586,0.002990430622009654,0.004770423375074717,0.004154302670623222,0.002068557919621572,0.002948982601002736,0.002646280505733678,0.003812316715542385,0.003213555360794818,0.004950495049504733,0.001448855404230676,0.003761574074073959,0.001729605073508278,0.00374100719424475,0.003153669724770714,0.002286367533580913,0.004277159965782706,0.003123225440090804,0.004245683555052393],[3.392009251533604,-1.46470934887334,-3.131031524769468,1.283274678799637,3.869917994482719,1.356593893513362,-3.873197526809456,-1.133275550834474,-6.046027665564938,-2.584281036679057,-0.9031068604433513,4.766196013289038,1.511632055240871,-8.349880218126007,-0.898566192565429,1.545368462574413,-9.437313380702824,-16.51874101518215,-6.960634154400134,0.9835138047056942,-8.211392774761141,-10.74488705912147,8.348323660101236,9.93473202864538,5.845354638032374,-0.06737270958034347,7.460602980834199,3.693856961112135,3.545818126697982,-1.922586069696551,6.160715424751554,1.907200761390201,-3.634292533427347,3.119504951585452,6.090498940318442,1.547038078097962,-7.94548070081135,-5.174291156931434,6.830034637879565,-4.498046330550473,8.955377097476786,3.820246146720875,0,6.68440135054757,2.329954997658166,3.473746095240563,0.01074389364513113,2.896087707209059,-1.121446979815274,-1.688645117226328,-2.000474114784152,-5.497566225329029,-6.945000203730041,10.91475566283999,-0.4063205417607176,1.043932365460678,4.637442953607474,4.340591204037487,3.215671967002123,-0.6675854632573611,-6.00560554335939,4.052887442100584,1.182942112555444,2.505305272219261,2.535671163561592,-1.819820177852341,0.5659034171555622,0.8998603483939983,5.11903275265192,1.275907328836114,3.797501350170209,1.921220615864174,2.361011547497051,-1.336030317755726,5.167635566568182,-2.99919168047091,3.168080930678873,4.630678690025678,2.963830713810462,2.589575397319044,-3.524821291160716,4.551566048798515,0.8310573318439554,0.6951211338478714,2.320638378759622,2.063342042400247,-1.343748621073429,3.946382668914597,-1.379126113215402,2.355067084628866,2.747214037356141,-0.2560075044828674,-2.962936432333378,5.6204357400419,-1.57448005352354,0.9834278125731899,1.285575917596129,-2.009986103661536,2.214741095497487,-6.134456975735405,-2.49898463675008,8.528626547498568,0.3654735031710281,-1.717930184869413,-4.97863333200208,-0.08261941988677775,6.724267648663651,0.3941463634367407,1.701131245828631,0.3497450258393262,3.647103886818611,0.1197755282530247,0.007784833555494912,-1.733711636202272,3.683850893520153,2.028320396246472,1.789482960713288,3.929116559320595,0.125823292669893,0.9926250459882572,1.411302515506132,0.6373931025933423,2.055444557775204,0.291783518757439,2.014068070130656,2.356420432379824,3.056581153818776,1.208661559089114,5.635902750686872,-3.63601854720924,-2.741575824263479,0.5168510348647188,2.430904601873382,0.5754925974364602,3.704660885470257,3.192012469001716,0.5948179760088941,-6.910418173426251,1.854904421231033,-8.793627644898159,8.006564324946361,3.241593815094391,1.807871696839824,4.085267155224694,-6.377119273137569,6.959246778989109,1.511945492424702,-1.674358487534871,1.947914987920454,2.210466158599764,3.619830328360179,2.903357048501852,-0.04040607942719152,-7.916574025005723,-12.46426739120095,12.69836331855849,4.764531966037453,1.776075069077391,5.889230238177428,6.97966593547879,-3.739837646112404,-2.49332935315699,10.8776793903043,3.706604608345655,-1.019065336334757,2.780551768950636,4.540528449384295,5.291029731346968,0.6566028906461927,2.247274319462826,2.441247155144755,2.975980371055916,-4.657522730370929,7.016348193105348,-0.8034782109937753,4.628837172590104,-5.274128681476602,-2.9517122398893,3.755569290840254,-8.77690289196676,0.2257254985380523,-8.24693010901002,9.208753133685557,-4.080202677521654,-9.241634055655126,8.127561547036747,5.559131104323798,-5.757565425157765,6.288712675567146,-2.514253065250557,3.712489078632295,1.597507512203191,0.4616008479414985,6.481415193158695,3.273340073530252,-1.625211305910517,-4.739330177258197,-2.170850830411259,9.134375702093839,4.566261153823945,1.592632645762315,5.218701774792166,3.272381205936205,-4.031962969589582,5.05796248150427,3.528475638378665,1.210903848358518,2.336561267125484,2.100920040045995],[3.321141401726597,0.6713121544189977,-1.157993343033108,-0.1953079989860067,6.153273337066268,6.366491292467057,-4.961400817995909,-2.028021119392341,-7.744659589129468,-0.2219967206382667,-0.09245589704588142,5.918175440691379,1.418787520081168,-8.376407554384684,-3.675743550236274,-5.186045852580266,-12.40464543211352,-22.76151515955734,-6.772364707326051,8.4537298344636,-12.99518409196831,-9.210115168288549,10.14442873824596,13.22928756361038,15.16964395712701,-2.072671881150841,10.60979446308725,2.920449068916752,5.675158037760183,-3.171161354762544,4.853072462245952,1.391253953035787,-5.755395683453237,1.313695906914417,6.724238594624146,-1.755102747433472,-10.90235633277651,-1.336967141461398,10.76089178971338,-3.434296635200087,10.59658750149935,3.590529191266683,-4.103740250222479,8.118592313334812,0.796147692812576,2.743688639551205,-0.2224334832474082,5.454134576037214,-3.172438158451035,-1.092226113535294,-2.369138008714569,-8.471983052317295,-13.00850698086775,11.49296519746849,-2.571303968600094,-2.430753254194192,6.859913310602749,5.310175231317701,-0.8962262612558225,-1.809320402407604,-11.40016020216306,6.524485735252947,0.4879157404316652,2.647183546540399,3.488472171060109,0.7681201846948088,1.801837491292879,5.055598613358576,2.426217970681661,-1.38719369780694,0.6212983393334067,3.753063772015883,-3.305543195709715,-3.583840928080984,4.703621600236115,-1.987056840741556,7.578511284084792,3.333323852890057,0.3385436019387942,1.465089932547147,-5.795475436073221,5.628847340402627,0.4607831683733285,1.470934242018581,1.919755652924795,1.677793555034306,-1.472649508902512,1.009404928777823,-4.87797314478866,0.202940601160592,-0.3242642373961213,-3.95578271075701,-0.02152389151959695,5.848393858704886,-1.411420894595709,4.740330951812214,-1.038473001516115,-2.80713791875301,-0.2883094557418213,-7.74633234159958,-4.035232122509838,6.685550505620895,-1.319523918516817,-2.520962111635573,-5.597939401510345,-2.440200131068205,8.307201426140082,2.109013924918757,-0.7942927728118419,-0.7173491344418745,4.247433928476132,0.6939467367439102,1.582253454294854,-1.694684335500242,-2.127226290378688,1.934758610326032,4.142226556630658,1.260671196480675,2.991061227233014,2.090832443663686,3.051307685030584,0.5054026225359572,3.377834611263887,0.6380666961183541,1.838946271922016,1.954159841747294,0.6325787181139682,2.047499443614286,5.701689966574537,-5.307813608601652,-0.4437843510431971,0.5701562402293987,-1.993449175595404,-2.135956206893415,2.893584706462509,-2.343509165899746,0.4444659496225879,-8.299669903402583,1.466659328783849,-4.935714902062307,7.569081549293943,1.631704441621,1.003916507926721,2.851465894438695,-5.544823050680267,5.886761435064313,-1.804379095413142,-2.436483781188454,2.818106423137797,3.446885147867683,1.046147917114781,4.165659584941905,-3.404724550248112,-6.606282987890213,-15.12761097529897,6.801620333686417,4.679247051228318,4.362401086248326,3.927703378925794,4.405894397021156,-1.67955393436827,-2.061597771776871,12.60898419771894,5.716438253515311,0.377015105508666,2.082589801188253,1.743771909324616,2.570920356779279,3.165213465593448,-0.4886595897273908,-1.419778831404743,1.520239471350346,-3.333048531906763,2.73943692458656,-4.294986928758651,3.69101168942667,-2.398854975337383,-3.059624521225588,-0.4889769816189496,-6.476816836566925,1.633893033451412,-7.677343977036168,3.38284040393658,-4.394969366324091,-9.677782760630256,3.40383582146832,13.14604630447943,-2.191579741520703,8.695497247875657,-4.38532042863948,2.840489683964262,1.888945979125893,-3.414134648327581,4.55174090488793,3.767661808180328,-4.392413154646449,-3.370585760312614,-3.200260856252697,8.22551723996278,4.90197566946916,-1.656478012226382,3.16970913365576,3.349423069721992,-2.506396685973185,3.952430672306092,-0.570816678129539,2.54104521694168,2.577593288940233,2.55091327285543],[-0.916772370655228,-0.376265790632304,1.071529342974381,1.280645519338333,0.633637587859927,1.00964767107827,1.792796795671811,-0.004493321800474975,2.312880846194711,-0.1598353648685327,0.1294555326529583,0.3304379479583759,-1.264383634481317,-0.1861070677920728,0.3948065796865077,0.7428833357042358,-1.761300343599477,-2.278229927939905,3.031154852511691,6.652961648155379,-1.986560930918787,-1.054914106137834,1.1018941537499,0.515287207771316,0.7113957633167924,0.4248113822478345,1.269490741431523,1.221309035830376,1.188814344376236,0.2211020867318617,1.286510088403606,-1.881517004084145,1.414980566945456,0.1989535357333151,-0.007248735379938588,0.973390948373885,1.082678273796109,1.767821307162788,0.8552821541615293,1.286697611814339,0.008439542067762791,0.1520328873255499,-0.835245906024467,-0.6709924889303129,-0.08513654435248245,0.2912329768685302,-0.2227702647768239,1.567355120488472,1.239776059432232,-0.4466756213109975,1.686064791905188,1.519812753432597,0.7699277108433826,0.1260017650449641,-0.332312661762017,1.356302596182727,0.725626270318803,-0.01314368045585726,-0.5727642164460275,0.9060883952439169,1.078640693105264,-0.01987597883024144,1.361836954938008,0.0003654565587827715,0.2644677631947634,-0.04543991057815022,0.2705754651503419,-0.2448731205684914,-0.6212199096606286,0.5917203176874186,0.09895164741121355,0.9686218027343926,-2.001650200742359,-1.565223154453027,0.2684475056077215,-0.8256940057599461,1.121208929547652,0.8316449135371958,-0.2491450242934892,-0.5561205934747326,1.54095239039774,0.375423954367987,-0.1485132257048336,0.6362311920168411,1.171698636205734,0.1348358699306484,-0.2510281280542288,1.148939279421518,-0.6146019475421315,0.8867346075526226,0.8332339279155223,0.1481687976424095,2.052347252289713,-0.8947143435075001,0.3752477560299833,-0.3236149017231457,-0.4367786333301704,-1.075899184949485,0.8629925916885604,-0.3361236991058785,0.8112152936671622,0.06843723402407557,-0.3890501252088639,-0.1927290385388463,1.240550088170073,0.8874525318092953,0.8701875301990135,0.2592786743007967,0.01386004509586578,1.930898659930633,0.5489088143746472,-0.2152428902788984,0.05111753507721122,-0.8168020295625492,-2.565616958161911,0.2543160811623859,0.2128699368095574,0.6462127148986176,-0.05408749328130524,0.9065685349351794,0.6878120069898511,-0.01797667027679386,0.3345149754829613,0.9405765359173517,-0.5713828582950784,0.09798205462526582,-0.1483156756566246,0.474719661774641,-1.125054326591709,-1.008208412651735,0.6710980442285585,-0.9405139411922531,0.6620468807449736,0.1032112781778652,-0.02890060535052544,0.5685800900977317,-0.619083029045183,-0.6443817062602165,0.523569625318381,1.980163699794254,0.9109359461157447,-0.113002085105781,2.122926540606571,-0.1994007326272538,1.911006135925308,1.098187561135506,0.18159555469,2.781348071782734,-0.6117810867992787,0.2079153600255869,-0.03424394619559123,-0.04749312107613051,2.029020964528028,1.585189310128547,-0.5267187858156642,1.719527561371431,0.6727713184833332,0.6588913466049922,1.332938867648838,-0.8233017875130328,-0.0974960551960273,-0.5588280717778529,1.206545818346396,0.08651952385076411,-0.7446099028602037,-1.518303321389202,-1.146491911814238,0.7316579314211806,0.2034264552964425,0.8278706153188746,1.116158326326853,-0.200921362557101,-0.9169616096970179,-0.00947067534523729,0.2705616833758546,-0.3595210584116792,-1.998577027711564,-1.145177649102727,-2.813377852371548,-3.805687121849318,0.761772853185597,-1.552110385351897,2.536150401872448,-3.04242703954563,-4.143728444324846,-1.280605922327052,3.808043432450617,-0.8726685365667305,3.330162484008125,-2.666962167069236,2.642390565424284,0.5742143214426983,-1.141447678876105,-0.3693219300852069,-0.01528844559574597,-0.6299372001068133,-2.58773707377652,-1.568524496792864,4.589109369667072,3.692621887966802,-0.1511025798941824,-1.475949290465186,0.9012511374217231,-2.475830132205949,1.668127103190065,0.8834846396073049,2.420690480338708,1.45995798534611,1.331384702710951],[4.741904761904762,4.960952380952381,4.31695652173913,3.994210526315789,4.002727272727273,3.3545,3.0665,2.82,2.174,1.2835,1.311818181818182,1.764285714285714,1.89047619047619,1.655,1.752857142857143,1.146666666666667,0.6859090909090909,0.1938888888888889,0.03409090909090909,0.1295,0.2952631578947368,0.2159090909090909,0.1580952380952381,0.177,0.1786363636363636,0.1836363636363636,0.1719047619047619,0.1233333333333333,0.07428571428571429,0.05210526315789474,0.05454545454545455,0.06157894736842105,0.1089473684210526,0.1504347826086957,0.1622727272727273,0.16,0.1236363636363636,0.1576190476190476,0.155,0.1519047619047619,0.1345,0.143,0.1409090909090909,0.152,0.1321052631578947,0.1004347826086956,0.0585,0.04095238095238096,0.03727272727272728,0.0375,0.02434782608695652,0.01380952380952381,0.019,0.014,0.01142857142857143,0.0345,0.092,0.08409090909090909,0.08380952380952381,0.08954545454545455,0.09142857142857143,0.09714285714285714,0.1026086956521739,0.1052631578947369,0.1047619047619048,0.0935,0.07000000000000001,0.07428571428571429,0.09894736842105263,0.08700000000000001,0.06,0.04409090909090909,0.0505,0.03545454545454545,0.04363636363636364,0.016,0.04727272727272727,0.06789473684210527,0.06666666666666667,0.04333333333333333,0.05263157894736843,0.05238095238095238,0.03095238095238095,0.03238095238095238,0.03571428571428571,0.02636363636363636,0.03285714285714286,0.02,0.01681818181818182,0.02166666666666667,0.02909090909090909,0.0275,0.01789473684210526,0.02772727272727273,0.02318181818181818,0.0165,0.015,0.03227272727272727,0.0719047619047619,0.02428571428571428,0.01666666666666666,0.1263157894736842,0.2286363636363636,0.2573684210526316,0.3145,0.2972727272727272,0.2280952380952381,0.2766666666666667,0.2727272727272728,0.301,0.2995652173913044,0.2942857142857143,0.3315,0.4525,0.5119047619047619,0.519,0.5263157894736842,0.7478260869565218,0.8084210526315789,0.9031818181818182,0.9990909090909091,1.0865,1.032173913043478,1.0465,1.093333333333333,1.250476190476191,1.3415,1.432380952380952,1.587894736842105,1.726666666666667,1.788095238095238,1.899545454545454,1.935238095238095,1.994761904761905,2.072608695652174,2.165263157894737,2.293181818181818,2.374,2.412105263157895,2.423809523809524,2.437894736842106,2.453809523809524,2.432857142857143,2.403181818181818,2.2195,2.145,1.990454545454545,1.9345,1.678636363636364,1.572105263157895,1.565238095238095,1.552380952380952,1.544736842105263,0.2954545454545455,0.1380952380952381,0.1275,0.1595454545454545,0.1268181818181818,0.1042857142857143,0.1085714285714286,0.1004761904761905,0.09105263157894737,0.08727272727272727,0.08368421052631579,0.04263157894736842,0.03130434782608696,0.02090909090909091,0.018,0.03590909090909091,0.05238095238095238,0.05454545454545455,0.0419047619047619,0.052,0.0515,0.05863636363636364,0.1455,0.3147368421052631,0.4473913043478261,0.7635,0.9928571428571429,1.538571428571428,2.298,2.721739130434782,3.221904761904762,3.8725,4.323,4.358095238095238,4.6875,4.787894736842105,4.858695652173913,5.0735,5.308181818181819,5.415714285714285,5.4885,5.559130434782609,5.5555,5.604761904761904,5.522857142857143,5.442,5.453809523809524,5.4405,5.468500000000001,5.443636363636363,5.455,5.506315789473684,5.431818181818182,5.295454545454546,4.922,4.718181818181819]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>date<\/th>\n      <th>inflation_cpi<\/th>\n      <th>mom_inflation_rate<\/th>\n      <th>yoy_inflation_rate<\/th>\n      <th>wage_growth<\/th>\n      <th>us_equity_monthly_return<\/th>\n      <th>intl_equity_monthly_return<\/th>\n      <th>bond_monthly_return<\/th>\n      <th>average_yield<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,3,4,5,6,7,8,9]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"date","targets":1},{"name":"inflation_cpi","targets":2},{"name":"mom_inflation_rate","targets":3},{"name":"yoy_inflation_rate","targets":4},{"name":"wage_growth","targets":5},{"name":"us_equity_monthly_return","targets":6},{"name":"intl_equity_monthly_return","targets":7},{"name":"bond_monthly_return","targets":8},{"name":"average_yield","targets":9}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<ol start="2" type="1">
<li>Visualization</li>
</ol>
<p>Now let`s do a simulation of my Monte Carlo simulation for the price path of US Equity.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Parameters for the S&amp;P 500 simulation using combined dataset</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>initial_price <span class="ot">&lt;-</span> <span class="dv">100</span>  <span class="co"># Use an arbitrary starting price (you can replace this with actual data if needed)</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>return_column <span class="ot">&lt;-</span> <span class="st">"us_equity_monthly_return"</span>  <span class="co"># Choose the column for monthly returns</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate drift (average return) and volatility (standard deviation of returns)</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">mean</span>(combined_data[[return_column]], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)  <span class="co"># Drift (average return)</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="fu">sd</span>(combined_data[[return_column]], <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="co"># Volatility (std of returns)</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulation parameters</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>n_steps <span class="ot">&lt;-</span> <span class="dv">12</span>  <span class="co"># Simulate for 1 year (12 months)</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>n_simulations <span class="ot">&lt;-</span> <span class="dv">100</span>  <span class="co"># Number of simulation paths</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>time_horizon <span class="ot">&lt;-</span> <span class="dv">1</span>  <span class="co"># Time horizon in years</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulate price paths</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)  <span class="co"># For reproducibility</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">&lt;-</span> time_horizon <span class="sc">/</span> n_steps  <span class="co"># Time step (monthly in this case)</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>price_paths <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> n_steps <span class="sc">+</span> <span class="dv">1</span>, <span class="at">ncol =</span> n_simulations)</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize the first row with the initial price</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>price_paths[<span class="dv">1</span>, ] <span class="ot">&lt;-</span> initial_price</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate paths</span></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>(n_steps <span class="sc">+</span> <span class="dv">1</span>)) {</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>  z <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n_simulations)  <span class="co"># Random shocks</span></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>  price_paths[i, ] <span class="ot">&lt;-</span> price_paths[i <span class="sc">-</span> <span class="dv">1</span>, ] <span class="sc">*</span> <span class="fu">exp</span>((mu <span class="sc">-</span> <span class="fl">0.5</span> <span class="sc">*</span> sigma<span class="sc">^</span><span class="dv">2</span>) <span class="sc">*</span> dt <span class="sc">+</span> sigma <span class="sc">*</span> <span class="fu">sqrt</span>(dt) <span class="sc">*</span> z)</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to a tidy data frame for visualization</span></span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>price_paths_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(price_paths) <span class="sc">%&gt;%</span></span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">month =</span> <span class="dv">0</span><span class="sc">:</span>n_steps) <span class="sc">%&gt;%</span></span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>month, <span class="at">names_to =</span> <span class="st">"simulation"</span>, <span class="at">values_to =</span> <span class="st">"price"</span>)</span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot simulated price paths</span></span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(price_paths_df, <span class="fu">aes</span>(<span class="at">x =</span> month, <span class="at">y =</span> price, <span class="at">group =</span> simulation)) <span class="sc">+</span></span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Simulated Price Paths for U.S. Equity"</span>,</span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Monte Carlo Simulation using Monthly Returns"</span>,</span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Months"</span>,</span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Price"</span></span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="investigation-and-visualization-of-input-data" class="level1">
<h1>Investigation and Visualization of Input Data</h1>
<p>Now let’s do more investigation about my data. I will start by looking at the potential correlations between all those properties.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DT)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Calculate the correlation matrix among the factors</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>correlation_matrix <span class="ot">&lt;-</span> combined_data <span class="sc">%&gt;%</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(inflation_cpi, wage_growth, us_equity_monthly_return, </span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>         intl_equity_monthly_return, bond_monthly_return, average_yield) <span class="sc">%&gt;%</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cor</span>(<span class="at">use =</span> <span class="st">"complete.obs"</span>)  <span class="co"># Use complete cases to ignore missing values</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Convert the correlation matrix to a tidy format for better presentation in a table</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>correlation_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">as.table</span>(correlation_matrix)) <span class="sc">%&gt;%</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Variable1 =</span> Var1, <span class="at">Variable2 =</span> Var2, <span class="at">Correlation =</span> Freq)</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Use knitr to create a nicely formatted table</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(correlation_df, </span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">caption =</span> <span class="st">"Correlation Matrix Among Economic Factors"</span>,</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">format =</span> <span class="st">"html"</span>, </span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">digits =</span> <span class="dv">2</span>, </span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">align =</span> <span class="fu">c</span>(<span class="st">"l"</span>, <span class="st">"l"</span>, <span class="st">"r"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<caption>Correlation Matrix Among Economic Factors</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Variable1</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Variable2</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Correlation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">inflation_cpi</td>
<td style="text-align: left;">inflation_cpi</td>
<td style="text-align: right;">1.00</td>
</tr>
<tr class="even">
<td style="text-align: left;">wage_growth</td>
<td style="text-align: left;">inflation_cpi</td>
<td style="text-align: right;">0.19</td>
</tr>
<tr class="odd">
<td style="text-align: left;">us_equity_monthly_return</td>
<td style="text-align: left;">inflation_cpi</td>
<td style="text-align: right;">0.08</td>
</tr>
<tr class="even">
<td style="text-align: left;">intl_equity_monthly_return</td>
<td style="text-align: left;">inflation_cpi</td>
<td style="text-align: right;">0.04</td>
</tr>
<tr class="odd">
<td style="text-align: left;">bond_monthly_return</td>
<td style="text-align: left;">inflation_cpi</td>
<td style="text-align: right;">-0.11</td>
</tr>
<tr class="even">
<td style="text-align: left;">average_yield</td>
<td style="text-align: left;">inflation_cpi</td>
<td style="text-align: right;">0.64</td>
</tr>
<tr class="odd">
<td style="text-align: left;">inflation_cpi</td>
<td style="text-align: left;">wage_growth</td>
<td style="text-align: right;">0.19</td>
</tr>
<tr class="even">
<td style="text-align: left;">wage_growth</td>
<td style="text-align: left;">wage_growth</td>
<td style="text-align: right;">1.00</td>
</tr>
<tr class="odd">
<td style="text-align: left;">us_equity_monthly_return</td>
<td style="text-align: left;">wage_growth</td>
<td style="text-align: right;">-0.26</td>
</tr>
<tr class="even">
<td style="text-align: left;">intl_equity_monthly_return</td>
<td style="text-align: left;">wage_growth</td>
<td style="text-align: right;">-0.24</td>
</tr>
<tr class="odd">
<td style="text-align: left;">bond_monthly_return</td>
<td style="text-align: left;">wage_growth</td>
<td style="text-align: right;">-0.10</td>
</tr>
<tr class="even">
<td style="text-align: left;">average_yield</td>
<td style="text-align: left;">wage_growth</td>
<td style="text-align: right;">0.09</td>
</tr>
<tr class="odd">
<td style="text-align: left;">inflation_cpi</td>
<td style="text-align: left;">us_equity_monthly_return</td>
<td style="text-align: right;">0.08</td>
</tr>
<tr class="even">
<td style="text-align: left;">wage_growth</td>
<td style="text-align: left;">us_equity_monthly_return</td>
<td style="text-align: right;">-0.26</td>
</tr>
<tr class="odd">
<td style="text-align: left;">us_equity_monthly_return</td>
<td style="text-align: left;">us_equity_monthly_return</td>
<td style="text-align: right;">1.00</td>
</tr>
<tr class="even">
<td style="text-align: left;">intl_equity_monthly_return</td>
<td style="text-align: left;">us_equity_monthly_return</td>
<td style="text-align: right;">0.88</td>
</tr>
<tr class="odd">
<td style="text-align: left;">bond_monthly_return</td>
<td style="text-align: left;">us_equity_monthly_return</td>
<td style="text-align: right;">0.24</td>
</tr>
<tr class="even">
<td style="text-align: left;">average_yield</td>
<td style="text-align: left;">us_equity_monthly_return</td>
<td style="text-align: right;">0.02</td>
</tr>
<tr class="odd">
<td style="text-align: left;">inflation_cpi</td>
<td style="text-align: left;">intl_equity_monthly_return</td>
<td style="text-align: right;">0.04</td>
</tr>
<tr class="even">
<td style="text-align: left;">wage_growth</td>
<td style="text-align: left;">intl_equity_monthly_return</td>
<td style="text-align: right;">-0.24</td>
</tr>
<tr class="odd">
<td style="text-align: left;">us_equity_monthly_return</td>
<td style="text-align: left;">intl_equity_monthly_return</td>
<td style="text-align: right;">0.88</td>
</tr>
<tr class="even">
<td style="text-align: left;">intl_equity_monthly_return</td>
<td style="text-align: left;">intl_equity_monthly_return</td>
<td style="text-align: right;">1.00</td>
</tr>
<tr class="odd">
<td style="text-align: left;">bond_monthly_return</td>
<td style="text-align: left;">intl_equity_monthly_return</td>
<td style="text-align: right;">0.31</td>
</tr>
<tr class="even">
<td style="text-align: left;">average_yield</td>
<td style="text-align: left;">intl_equity_monthly_return</td>
<td style="text-align: right;">0.03</td>
</tr>
<tr class="odd">
<td style="text-align: left;">inflation_cpi</td>
<td style="text-align: left;">bond_monthly_return</td>
<td style="text-align: right;">-0.11</td>
</tr>
<tr class="even">
<td style="text-align: left;">wage_growth</td>
<td style="text-align: left;">bond_monthly_return</td>
<td style="text-align: right;">-0.10</td>
</tr>
<tr class="odd">
<td style="text-align: left;">us_equity_monthly_return</td>
<td style="text-align: left;">bond_monthly_return</td>
<td style="text-align: right;">0.24</td>
</tr>
<tr class="even">
<td style="text-align: left;">intl_equity_monthly_return</td>
<td style="text-align: left;">bond_monthly_return</td>
<td style="text-align: right;">0.31</td>
</tr>
<tr class="odd">
<td style="text-align: left;">bond_monthly_return</td>
<td style="text-align: left;">bond_monthly_return</td>
<td style="text-align: right;">1.00</td>
</tr>
<tr class="even">
<td style="text-align: left;">average_yield</td>
<td style="text-align: left;">bond_monthly_return</td>
<td style="text-align: right;">0.02</td>
</tr>
<tr class="odd">
<td style="text-align: left;">inflation_cpi</td>
<td style="text-align: left;">average_yield</td>
<td style="text-align: right;">0.64</td>
</tr>
<tr class="even">
<td style="text-align: left;">wage_growth</td>
<td style="text-align: left;">average_yield</td>
<td style="text-align: right;">0.09</td>
</tr>
<tr class="odd">
<td style="text-align: left;">us_equity_monthly_return</td>
<td style="text-align: left;">average_yield</td>
<td style="text-align: right;">0.02</td>
</tr>
<tr class="even">
<td style="text-align: left;">intl_equity_monthly_return</td>
<td style="text-align: left;">average_yield</td>
<td style="text-align: right;">0.03</td>
</tr>
<tr class="odd">
<td style="text-align: left;">bond_monthly_return</td>
<td style="text-align: left;">average_yield</td>
<td style="text-align: right;">0.02</td>
</tr>
<tr class="even">
<td style="text-align: left;">average_yield</td>
<td style="text-align: left;">average_yield</td>
<td style="text-align: right;">1.00</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>The correlation matrix reveals the strength and direction of relationships between various economic factors. The relationship between inflation (CPI) and wage growth is relatively weak but positive, with a correlation of 0.19. Inflation (CPI) shows a slightly positive correlation with U.S. equity returns (0.08), but the relationship is not strong. Interestingly, U.S. equity returns have a stronger positive correlation with international equity returns (0.88), indicating that these two markets tend to move together. The correlation between equity returns and bond returns is low (0.24), suggesting little co-movement. There is a moderate positive correlation (0.64) between inflation (CPI) and average short-term yield, indicating that when inflation rises, short-term yields tend to increase as well. Wage growth has a negative correlation with U.S. equity returns (-0.26), suggesting that as wages grow, U.S. equity returns tend to decrease slightly. Other correlations, such as between wage growth and international equity returns, are negative but weak.</p>
<p>Now let`s plot the time series of our properties:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Time-series plot for Inflation</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(combined_data, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> inflation_cpi)) <span class="sc">+</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Inflation (CPI) Over Time"</span>,</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Monthly Inflation Rate"</span>,</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Date"</span>,</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Inflation (CPI)"</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Time-series plot for Wage Growth</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(combined_data, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> wage_growth)) <span class="sc">+</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Wage Growth Over Time"</span>,</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Monthly Wage Growth"</span>,</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Date"</span>,</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Wage Growth"</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/unnamed-chunk-14-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Time-series plot for U.S. Equity Monthly Returns</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(combined_data, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> us_equity_monthly_return)) <span class="sc">+</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"green"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"U.S. Equity Monthly Returns Over Time"</span>,</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Monthly Returns of U.S. Equities"</span>,</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Date"</span>,</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"U.S. Equity Monthly Return"</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/unnamed-chunk-14-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Time-series plot for International Equity Monthly Returns</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(combined_data, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> intl_equity_monthly_return)) <span class="sc">+</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"purple"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"International Equity Monthly Returns Over Time"</span>,</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Monthly Returns of International Equities"</span>,</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Date"</span>,</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"International Equity Monthly Return"</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/unnamed-chunk-14-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. Time-series plot for Bond Monthly Returns</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(combined_data, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> bond_monthly_return)) <span class="sc">+</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"orange"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Bond Monthly Returns Over Time"</span>,</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Monthly Returns of Bonds"</span>,</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Date"</span>,</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Bond Monthly Return"</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/unnamed-chunk-14-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 6. Time-series plot for Short-Term Yield</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(combined_data, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> average_yield)) <span class="sc">+</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"brown"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Short-Term Yield Over Time"</span>,</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Average Yield of Short-Term Instruments"</span>,</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Date"</span>,</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Short-Term Yield"</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/unnamed-chunk-14-6.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Finally, this code allows us to compute the long-run monthly average value of each series</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the long-run monthly average for each series</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>monthly_averages <span class="ot">&lt;-</span> combined_data <span class="sc">%&gt;%</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_inflation =</span> <span class="fu">mean</span>(inflation_cpi, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_wage_growth =</span> <span class="fu">mean</span>(wage_growth, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_us_equity_return =</span> <span class="fu">mean</span>(us_equity_monthly_return, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_intl_equity_return =</span> <span class="fu">mean</span>(intl_equity_monthly_return, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_bond_return =</span> <span class="fu">mean</span>(bond_monthly_return, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_short_term_yield =</span> <span class="fu">mean</span>(average_yield, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the results</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Long-Run Monthly Averages:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Long-Run Monthly Averages:"</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(monthly_averages)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 6
  avg_inflation avg_wage_growth avg_us_equity_return avg_intl_equity_return
          &lt;dbl&gt;           &lt;dbl&gt;                &lt;dbl&gt;                  &lt;dbl&gt;
1          248.         0.00256                0.915                  0.440
# ℹ 2 more variables: avg_bond_return &lt;dbl&gt;, avg_short_term_yield &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="historical-comparison-of-trs-and-orp" class="level1">
<h1>Historical Comparison of TRS and ORP</h1>
<p>Now that we have explored our historical data, we can implement the TRS and ORP formulas and compare the value of each of them for the first month of retirement. To do this, we may assume that your hypothetical employee:</p>
<ul>
<li>Joined CUNY in the first month of the historical data</li>
<li>Retired from CUNY at the end of the final month of data</li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Assume initial salary and historical data</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>initial_salary <span class="ot">&lt;-</span> <span class="dv">50000</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>wage_growth_rate <span class="ot">&lt;-</span> <span class="fl">0.03</span>  <span class="co"># 3% annual wage growth (for simplicity)</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>investment_return_rate <span class="ot">&lt;-</span> <span class="fl">0.06</span>  <span class="co"># 6% average return for ORP investment</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of years worked</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>years_worked <span class="ot">&lt;-</span> <span class="dv">20</span>  <span class="co"># Assume 20 years of service</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate annual contributions (employee + employer)</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>employee_contribution_rate <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(initial_salary <span class="sc">&lt;=</span> <span class="dv">45000</span>, <span class="fl">0.03</span>, </span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>                                      <span class="fu">ifelse</span>(initial_salary <span class="sc">&lt;=</span> <span class="dv">55000</span>, <span class="fl">0.035</span>, </span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>                                             <span class="fu">ifelse</span>(initial_salary <span class="sc">&lt;=</span> <span class="dv">75000</span>, <span class="fl">0.045</span>, </span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>                                                    <span class="fu">ifelse</span>(initial_salary <span class="sc">&lt;=</span> <span class="dv">100000</span>, <span class="fl">0.0575</span>, <span class="fl">0.06</span>))))</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Employer contribution after 7 years</span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>employer_contribution_rate_early <span class="ot">&lt;-</span> <span class="fl">0.08</span>  <span class="co"># First 7 years</span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>employer_contribution_rate_late <span class="ot">&lt;-</span> <span class="fl">0.10</span>  <span class="co"># After 7 years</span></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to calculate final ORP balance</span></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>calculate_orp_balance <span class="ot">&lt;-</span> <span class="cf">function</span>(initial_salary, years_worked, employee_rate, employer_rate_early, employer_rate_late, return_rate) {</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>  total_balance <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>  salary <span class="ot">&lt;-</span> initial_salary</span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (year <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>years_worked) {</span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Contributions for the year</span></span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>    employee_contrib <span class="ot">&lt;-</span> salary <span class="sc">*</span> employee_rate</span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>    employer_contrib <span class="ot">&lt;-</span> <span class="cf">if</span> (year <span class="sc">&lt;=</span> <span class="dv">7</span>) salary <span class="sc">*</span> employer_rate_early <span class="cf">else</span> salary <span class="sc">*</span> employer_rate_late</span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the balance with contributions and returns</span></span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a>    total_balance <span class="ot">&lt;-</span> total_balance <span class="sc">+</span> employee_contrib <span class="sc">+</span> employer_contrib</span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a>    total_balance <span class="ot">&lt;-</span> total_balance <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> return_rate)  <span class="co"># Apply return rate</span></span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Apply wage growth</span></span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a>    salary <span class="ot">&lt;-</span> salary <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> wage_growth_rate)</span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb25-36"><a href="#cb25-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-37"><a href="#cb25-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(total_balance)</span>
<span id="cb25-38"><a href="#cb25-38" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb25-39"><a href="#cb25-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-40"><a href="#cb25-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate ORP balance and monthly withdrawal</span></span>
<span id="cb25-41"><a href="#cb25-41" aria-hidden="true" tabindex="-1"></a>orp_balance <span class="ot">&lt;-</span> <span class="fu">calculate_orp_balance</span>(initial_salary, years_worked, employee_contribution_rate, employer_contribution_rate_early, employer_contribution_rate_late, investment_return_rate)</span>
<span id="cb25-42"><a href="#cb25-42" aria-hidden="true" tabindex="-1"></a>orp_monthly_withdrawal <span class="ot">&lt;-</span> orp_balance <span class="sc">*</span> <span class="fl">0.04</span> <span class="sc">/</span> <span class="dv">12</span>  <span class="co"># Withdraw 4% per year</span></span>
<span id="cb25-43"><a href="#cb25-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-44"><a href="#cb25-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Print ORP results</span></span>
<span id="cb25-45"><a href="#cb25-45" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"ORP Final Balance: $"</span>, <span class="fu">round</span>(orp_balance, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>ORP Final Balance: $ 313513 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"ORP Monthly Withdrawal (4% per year): $"</span>, <span class="fu">round</span>(orp_monthly_withdrawal, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>ORP Monthly Withdrawal (4% per year): $ 1045.04 </code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Assume historical CPI data (for simplicity, a fixed inflation rate)</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>cpi_inflation_rate <span class="ot">&lt;-</span> <span class="fl">0.02</span>  <span class="co"># Assume 2% annual CPI inflation for adjustment</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the final average salary (FAS)</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>fas <span class="ot">&lt;-</span> initial_salary <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> wage_growth_rate) <span class="sc">*</span> years_worked <span class="sc">/</span> <span class="dv">3</span>  <span class="co"># Simplified for 3 years</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="co"># TRS retirement benefit calculation</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>calculate_trs_benefit <span class="ot">&lt;-</span> <span class="cf">function</span>(fas, years_served) {</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (years_served <span class="sc">&lt;=</span> <span class="dv">20</span>) {</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fl">0.0167</span> <span class="sc">*</span> fas <span class="sc">*</span> years_served)</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (years_served <span class="sc">==</span> <span class="dv">20</span>) {</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fl">0.0175</span> <span class="sc">*</span> fas <span class="sc">*</span> years_served)</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>((<span class="fl">0.35</span> <span class="sc">+</span> <span class="fl">0.02</span> <span class="sc">*</span> years_served) <span class="sc">*</span> fas)</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate TRS benefit</span></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>trs_benefit <span class="ot">&lt;-</span> <span class="fu">calculate_trs_benefit</span>(fas, years_worked)</span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjust for inflation (simplified)</span></span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>trs_benefit_adjusted <span class="ot">&lt;-</span> trs_benefit <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> cpi_inflation_rate <span class="sc">/</span> <span class="dv">2</span>)  <span class="co"># Adjusted by 50% of CPI</span></span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Print TRS results</span></span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"TRS Monthly Benefit (before inflation adjustment): $"</span>, <span class="fu">round</span>(trs_benefit <span class="sc">/</span> <span class="dv">12</span>, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>TRS Monthly Benefit (before inflation adjustment): $ 9556.11 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"TRS Monthly Benefit (inflation-adjusted): $"</span>, <span class="fu">round</span>(trs_benefit_adjusted <span class="sc">/</span> <span class="dv">12</span>, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>TRS Monthly Benefit (inflation-adjusted): $ 9651.67 </code></pre>
</div>
</div>
<p>#Long-Term Average Analysis</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Parameters</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>initial_salary <span class="ot">&lt;-</span> <span class="dv">50000</span>  <span class="co"># Starting salary</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>wage_growth_rate <span class="ot">&lt;-</span> <span class="fl">0.03</span>  <span class="co"># 3% annual wage growth</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>investment_return_rate <span class="ot">&lt;-</span> <span class="fl">0.06</span>  <span class="co"># 6% average return for ORP</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>cpi_inflation_rate <span class="ot">&lt;-</span> <span class="fl">0.02</span>  <span class="co"># 2% annual CPI inflation for TRS adjustments</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>employee_contribution_rate <span class="ot">&lt;-</span> <span class="fl">0.03</span>  <span class="co"># Assume employee contribution for ORP (based on salary range)</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>years_worked <span class="ot">&lt;-</span> <span class="dv">20</span>  <span class="co"># Assume 20 years of service</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>death_age <span class="ot">&lt;-</span> <span class="dv">85</span>  <span class="co"># Assumed age at death</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>retirement_age <span class="ot">&lt;-</span> <span class="dv">60</span>  <span class="co"># Assumed retirement age</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a><span class="co"># ORP Employer Contributions</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>employer_contribution_rate_early <span class="ot">&lt;-</span> <span class="fl">0.08</span>  <span class="co"># First 7 years</span></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>employer_contribution_rate_late <span class="ot">&lt;-</span> <span class="fl">0.10</span>  <span class="co"># After 7 years</span></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to calculate final ORP balance</span></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>calculate_orp_balance <span class="ot">&lt;-</span> <span class="cf">function</span>(initial_salary, years_worked, employee_rate, employer_rate_early, employer_rate_late, return_rate) {</span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>  total_balance <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>  salary <span class="ot">&lt;-</span> initial_salary</span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (year <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>years_worked) {</span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Contributions for the year</span></span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>    employee_contrib <span class="ot">&lt;-</span> salary <span class="sc">*</span> employee_rate</span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a>    employer_contrib <span class="ot">&lt;-</span> <span class="cf">if</span> (year <span class="sc">&lt;=</span> <span class="dv">7</span>) salary <span class="sc">*</span> employer_rate_early <span class="cf">else</span> salary <span class="sc">*</span> employer_rate_late</span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the balance with contributions and returns</span></span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a>    total_balance <span class="ot">&lt;-</span> total_balance <span class="sc">+</span> employee_contrib <span class="sc">+</span> employer_contrib</span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a>    total_balance <span class="ot">&lt;-</span> total_balance <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> return_rate)  <span class="co"># Apply return rate</span></span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Apply wage growth</span></span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a>    salary <span class="ot">&lt;-</span> salary <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> wage_growth_rate)</span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb33-32"><a href="#cb33-32" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-33"><a href="#cb33-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(total_balance)</span>
<span id="cb33-34"><a href="#cb33-34" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb33-35"><a href="#cb33-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-36"><a href="#cb33-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to calculate TRS pension benefit</span></span>
<span id="cb33-37"><a href="#cb33-37" aria-hidden="true" tabindex="-1"></a>calculate_trs_benefit <span class="ot">&lt;-</span> <span class="cf">function</span>(fas, years_served) {</span>
<span id="cb33-38"><a href="#cb33-38" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (years_served <span class="sc">&lt;=</span> <span class="dv">20</span>) {</span>
<span id="cb33-39"><a href="#cb33-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fl">0.0167</span> <span class="sc">*</span> fas <span class="sc">*</span> years_served)</span>
<span id="cb33-40"><a href="#cb33-40" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (years_served <span class="sc">==</span> <span class="dv">20</span>) {</span>
<span id="cb33-41"><a href="#cb33-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fl">0.0175</span> <span class="sc">*</span> fas <span class="sc">*</span> years_served)</span>
<span id="cb33-42"><a href="#cb33-42" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb33-43"><a href="#cb33-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>((<span class="fl">0.35</span> <span class="sc">+</span> <span class="fl">0.02</span> <span class="sc">*</span> years_served) <span class="sc">*</span> fas)</span>
<span id="cb33-44"><a href="#cb33-44" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb33-45"><a href="#cb33-45" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb33-46"><a href="#cb33-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-47"><a href="#cb33-47" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate FAS (Final Average Salary for TRS)</span></span>
<span id="cb33-48"><a href="#cb33-48" aria-hidden="true" tabindex="-1"></a>fas <span class="ot">&lt;-</span> initial_salary <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> wage_growth_rate) <span class="sc">*</span> years_worked <span class="sc">/</span> <span class="dv">3</span>  <span class="co"># Simplified for 3 years</span></span>
<span id="cb33-49"><a href="#cb33-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-50"><a href="#cb33-50" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate ORP balance at retirement</span></span>
<span id="cb33-51"><a href="#cb33-51" aria-hidden="true" tabindex="-1"></a>orp_balance <span class="ot">&lt;-</span> <span class="fu">calculate_orp_balance</span>(initial_salary, years_worked, employee_contribution_rate, employer_contribution_rate_early, employer_contribution_rate_late, investment_return_rate)</span>
<span id="cb33-52"><a href="#cb33-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-53"><a href="#cb33-53" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate monthly ORP withdrawal (4% per year)</span></span>
<span id="cb33-54"><a href="#cb33-54" aria-hidden="true" tabindex="-1"></a>orp_monthly_withdrawal <span class="ot">&lt;-</span> orp_balance <span class="sc">*</span> <span class="fl">0.04</span> <span class="sc">/</span> <span class="dv">12</span>  <span class="co"># Withdraw 4% per year</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="orp-simulation" class="level2">
<h2 class="anchored" data-anchor-id="orp-simulation">ORP Simulation</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ORP Withdrawal Simulation (until death)</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>orp_balance_remaining <span class="ot">&lt;-</span> orp_balance</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>orp_monthly_income <span class="ot">&lt;-</span> orp_balance <span class="sc">*</span> <span class="fl">0.04</span> <span class="sc">/</span> <span class="dv">12</span>  <span class="co"># Withdraw 4% of the balance each year, divided by 12 for monthly</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (age <span class="cf">in</span> retirement_age<span class="sc">:</span>death_age) {</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Withdrawal from ORP balance</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>  orp_balance_remaining <span class="ot">&lt;-</span> orp_balance_remaining <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> investment_return_rate <span class="sc">/</span> <span class="dv">12</span>) <span class="sc">-</span> orp_monthly_withdrawal</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>  orp_monthly_income[age <span class="sc">-</span> retirement_age <span class="sc">+</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> orp_monthly_withdrawal</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Stop if balance is exhausted</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (orp_balance_remaining <span class="sc">&lt;=</span> <span class="dv">0</span>) {</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>    orp_monthly_income[age <span class="sc">-</span> retirement_age <span class="sc">+</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">break</span></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the ORP remaining balance and withdrawals</span></span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"ORP Monthly Income over Retirement (until death):</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>ORP Monthly Income over Retirement (until death):</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(orp_monthly_income)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 1003.791 1003.791 1003.791 1003.791 1003.791 1003.791 1003.791 1003.791
 [9] 1003.791 1003.791 1003.791 1003.791 1003.791 1003.791 1003.791 1003.791
[17] 1003.791 1003.791 1003.791 1003.791 1003.791 1003.791 1003.791 1003.791
[25] 1003.791 1003.791</code></pre>
</div>
</div>
</section>
<section id="trs-simulation" class="level2">
<h2 class="anchored" data-anchor-id="trs-simulation">TRS Simulation</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># TRS Benefit Simulation (with inflation adjustments)</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>trs_monthly_income <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, death_age <span class="sc">-</span> retirement_age <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>trs_benefit <span class="ot">&lt;-</span> <span class="fu">calculate_trs_benefit</span>(fas, years_worked) <span class="sc">/</span> <span class="dv">12</span>  <span class="co"># Monthly TRS benefit</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (age <span class="cf">in</span> retirement_age<span class="sc">:</span>death_age) {</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Adjust TRS benefit for inflation</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>  trs_benefit <span class="ot">&lt;-</span> <span class="fu">calculate_trs_benefit</span>(fas, years_worked) <span class="sc">/</span> <span class="dv">12</span>  <span class="co"># TRS benefit divided by 12 for monthly amount</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>  trs_monthly_income[age <span class="sc">-</span> retirement_age <span class="sc">+</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> trs_benefit</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the TRS monthly income</span></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"TRS Monthly Income over Retirement (inflation-adjusted):</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>TRS Monthly Income over Retirement (inflation-adjusted):</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(trs_monthly_income)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 9556.111 9556.111 9556.111 9556.111 9556.111 9556.111 9556.111 9556.111
 [9] 9556.111 9556.111 9556.111 9556.111 9556.111 9556.111 9556.111 9556.111
[17] 9556.111 9556.111 9556.111 9556.111 9556.111 9556.111 9556.111 9556.111
[25] 9556.111 9556.111</code></pre>
</div>
</div>
<p>Now let`s compare both plans:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Average Monthly Income</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>avg_orp_income <span class="ot">&lt;-</span> <span class="fu">mean</span>(orp_monthly_income, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>avg_trs_income <span class="ot">&lt;-</span> <span class="fu">mean</span>(trs_monthly_income, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Maximum and Minimum Gap Between TRS and ORP</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>max_gap <span class="ot">&lt;-</span> <span class="fu">max</span>(trs_monthly_income <span class="sc">-</span> orp_monthly_income, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>min_gap <span class="ot">&lt;-</span> <span class="fu">min</span>(trs_monthly_income <span class="sc">-</span> orp_monthly_income, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Print comparison results</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Average ORP Monthly Income: $"</span>, <span class="fu">round</span>(avg_orp_income, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Average ORP Monthly Income: $ 1003.79 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Average TRS Monthly Income: $"</span>, <span class="fu">round</span>(avg_trs_income, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Average TRS Monthly Income: $ 9556.11 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Maximum Monthly Income Gap (TRS vs ORP): $"</span>, <span class="fu">round</span>(max_gap, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Maximum Monthly Income Gap (TRS vs ORP): $ 8552.32 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Minimum Monthly Income Gap (TRS vs ORP): $"</span>, <span class="fu">round</span>(min_gap, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Minimum Monthly Income Gap (TRS vs ORP): $ 8552.32 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if ORP funds run out before death</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (orp_balance_remaining <span class="sc">&lt;=</span> <span class="dv">0</span>) {</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"ORP funds exhausted before death</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"ORP funds available to leave to heirs: $"</span>, <span class="fu">round</span>(orp_balance_remaining, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>ORP funds available to leave to heirs: $ 315035.8 </code></pre>
</div>
</div>
</section>
</section>
<section id="bootstrap-monte-carlo-comparison" class="level1">
<h1>Bootstrap (Monte Carlo) Comparison</h1>
<p>Now that we have implemented both the “while working” contributions and returns (ORP) only as well as the “while retired” benefits of both plans, we are finally ready to implement our Monte Carlo assessment.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the number of simulations (bootstrap samples)</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>num_simulations <span class="ot">&lt;-</span> <span class="dv">200</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a function to perform the Monte Carlo analysis</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>monte_carlo_simulation <span class="ot">&lt;-</span> <span class="cf">function</span>(num_simulations) {</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Store results for each simulation</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>  results <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">orp_exhausted =</span> <span class="fu">logical</span>(num_simulations),  <span class="co"># Whether ORP is exhausted</span></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">orp_monthly_income =</span> <span class="fu">numeric</span>(num_simulations),</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">trs_monthly_income =</span> <span class="fu">numeric</span>(num_simulations),</span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">income_gap_max =</span> <span class="fu">numeric</span>(num_simulations),</span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">income_gap_min =</span> <span class="fu">numeric</span>(num_simulations)</span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Function to generate bootstrap samples for returns and inflation</span></span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a>  generate_bootstrap_sample <span class="ot">&lt;-</span> <span class="cf">function</span>(data_vector) {</span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sample</span>(data_vector, <span class="fu">length</span>(data_vector), <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Historical data for the Monte Carlo (replace these with actual historical data vectors)</span></span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a>  historical_inflation <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.01</span>, <span class="fl">0.02</span>, <span class="fl">0.03</span>, <span class="fl">0.025</span>)  <span class="co"># Sample historical inflation rates</span></span>
<span id="cb52-22"><a href="#cb52-22" aria-hidden="true" tabindex="-1"></a>  historical_wage_growth <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.02</span>, <span class="fl">0.03</span>, <span class="fl">0.04</span>, <span class="fl">0.025</span>)  <span class="co"># Sample historical wage growth</span></span>
<span id="cb52-23"><a href="#cb52-23" aria-hidden="true" tabindex="-1"></a>  historical_market_returns <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.07</span>, <span class="fl">0.09</span>, <span class="fl">0.06</span>)  <span class="co"># Sample historical market returns</span></span>
<span id="cb52-24"><a href="#cb52-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb52-25"><a href="#cb52-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Simulate each bootstrap sample</span></span>
<span id="cb52-26"><a href="#cb52-26" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>num_simulations) {</span>
<span id="cb52-27"><a href="#cb52-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Generate bootstrap samples for returns and inflation</span></span>
<span id="cb52-28"><a href="#cb52-28" aria-hidden="true" tabindex="-1"></a>    inflation_sample <span class="ot">&lt;-</span> <span class="fu">generate_bootstrap_sample</span>(historical_inflation)</span>
<span id="cb52-29"><a href="#cb52-29" aria-hidden="true" tabindex="-1"></a>    wage_growth_sample <span class="ot">&lt;-</span> <span class="fu">generate_bootstrap_sample</span>(historical_wage_growth)</span>
<span id="cb52-30"><a href="#cb52-30" aria-hidden="true" tabindex="-1"></a>    market_returns_sample <span class="ot">&lt;-</span> <span class="fu">generate_bootstrap_sample</span>(historical_market_returns)</span>
<span id="cb52-31"><a href="#cb52-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb52-32"><a href="#cb52-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Initialize variables</span></span>
<span id="cb52-33"><a href="#cb52-33" aria-hidden="true" tabindex="-1"></a>    total_balance <span class="ot">&lt;-</span> <span class="dv">0</span>  <span class="co"># Initialize total balance for ORP contributions</span></span>
<span id="cb52-34"><a href="#cb52-34" aria-hidden="true" tabindex="-1"></a>    salary <span class="ot">&lt;-</span> initial_salary  <span class="co"># Starting salary (should be defined earlier)</span></span>
<span id="cb52-35"><a href="#cb52-35" aria-hidden="true" tabindex="-1"></a>    orp_balance <span class="ot">&lt;-</span> <span class="dv">0</span>  <span class="co"># Initialize ORP balance</span></span>
<span id="cb52-36"><a href="#cb52-36" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb52-37"><a href="#cb52-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate ORP balance during working years (use bootstrap samples)</span></span>
<span id="cb52-38"><a href="#cb52-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (year <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>years_worked) {</span>
<span id="cb52-39"><a href="#cb52-39" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Employee and employer contributions (using bootstrap samples)</span></span>
<span id="cb52-40"><a href="#cb52-40" aria-hidden="true" tabindex="-1"></a>      employee_contrib <span class="ot">&lt;-</span> salary <span class="sc">*</span> employee_contribution_rate</span>
<span id="cb52-41"><a href="#cb52-41" aria-hidden="true" tabindex="-1"></a>      employer_contrib <span class="ot">&lt;-</span> <span class="cf">if</span> (year <span class="sc">&lt;=</span> <span class="dv">7</span>) salary <span class="sc">*</span> employer_contribution_rate_early <span class="cf">else</span> salary <span class="sc">*</span> employer_contribution_rate_late</span>
<span id="cb52-42"><a href="#cb52-42" aria-hidden="true" tabindex="-1"></a>      total_balance <span class="ot">&lt;-</span> total_balance <span class="sc">+</span> employee_contrib <span class="sc">+</span> employer_contrib</span>
<span id="cb52-43"><a href="#cb52-43" aria-hidden="true" tabindex="-1"></a>      total_balance <span class="ot">&lt;-</span> total_balance <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">mean</span>(market_returns_sample))  <span class="co"># Apply average market return</span></span>
<span id="cb52-44"><a href="#cb52-44" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb52-45"><a href="#cb52-45" aria-hidden="true" tabindex="-1"></a>      salary <span class="ot">&lt;-</span> salary <span class="sc">*</span> <span class="fu">mean</span>(wage_growth_sample)  <span class="co"># Apply wage growth</span></span>
<span id="cb52-46"><a href="#cb52-46" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb52-47"><a href="#cb52-47" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb52-48"><a href="#cb52-48" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Store the ORP balance at retirement</span></span>
<span id="cb52-49"><a href="#cb52-49" aria-hidden="true" tabindex="-1"></a>    orp_balance <span class="ot">&lt;-</span> total_balance</span>
<span id="cb52-50"><a href="#cb52-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-51"><a href="#cb52-51" aria-hidden="true" tabindex="-1"></a>    years_in_retirement <span class="ot">&lt;-</span> death_age <span class="sc">-</span> retirement_age</span>
<span id="cb52-52"><a href="#cb52-52" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb52-53"><a href="#cb52-53" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Initialize monthly income variables for ORP and TRS</span></span>
<span id="cb52-54"><a href="#cb52-54" aria-hidden="true" tabindex="-1"></a>    orp_monthly_income <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, years_in_retirement <span class="sc">*</span> <span class="dv">12</span>)</span>
<span id="cb52-55"><a href="#cb52-55" aria-hidden="true" tabindex="-1"></a>    trs_monthly_income <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, years_in_retirement <span class="sc">*</span> <span class="dv">12</span>)</span>
<span id="cb52-56"><a href="#cb52-56" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb52-57"><a href="#cb52-57" aria-hidden="true" tabindex="-1"></a>    remaining_orp_balance <span class="ot">&lt;-</span> orp_balance</span>
<span id="cb52-58"><a href="#cb52-58" aria-hidden="true" tabindex="-1"></a>    trs_benefit <span class="ot">&lt;-</span> <span class="fu">calculate_trs_benefit</span>(fas, years_worked) <span class="sc">/</span> <span class="dv">12</span>  <span class="co"># Monthly TRS benefit</span></span>
<span id="cb52-59"><a href="#cb52-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-60"><a href="#cb52-60" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Simulate ORP withdrawals and TRS income during retirement</span></span>
<span id="cb52-61"><a href="#cb52-61" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (month <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(years_in_retirement <span class="sc">*</span> <span class="dv">12</span>)) {</span>
<span id="cb52-62"><a href="#cb52-62" aria-hidden="true" tabindex="-1"></a>      remaining_orp_balance <span class="ot">&lt;-</span> remaining_orp_balance <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">mean</span>(market_returns_sample) <span class="sc">/</span> <span class="dv">12</span>) <span class="sc">-</span> orp_monthly_withdrawal</span>
<span id="cb52-63"><a href="#cb52-63" aria-hidden="true" tabindex="-1"></a>      orp_monthly_income[month] <span class="ot">&lt;-</span> <span class="fu">max</span>(remaining_orp_balance <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">mean</span>(market_returns_sample) <span class="sc">/</span> <span class="dv">12</span>) <span class="sc">-</span> orp_monthly_withdrawal, <span class="dv">0</span>)</span>
<span id="cb52-64"><a href="#cb52-64" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb52-65"><a href="#cb52-65" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (month <span class="sc">%%</span> <span class="dv">12</span> <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb52-66"><a href="#cb52-66" aria-hidden="true" tabindex="-1"></a>        trs_benefit <span class="ot">&lt;-</span> trs_benefit <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">mean</span>(inflation_sample))  <span class="co"># Apply yearly inflation adjustment</span></span>
<span id="cb52-67"><a href="#cb52-67" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb52-68"><a href="#cb52-68" aria-hidden="true" tabindex="-1"></a>      trs_monthly_income[month] <span class="ot">&lt;-</span> trs_benefit</span>
<span id="cb52-69"><a href="#cb52-69" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb52-70"><a href="#cb52-70" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb52-71"><a href="#cb52-71" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Record results for each simulation</span></span>
<span id="cb52-72"><a href="#cb52-72" aria-hidden="true" tabindex="-1"></a>    results<span class="sc">$</span>orp_exhausted[i] <span class="ot">&lt;-</span> remaining_orp_balance <span class="sc">&lt;=</span> <span class="dv">0</span></span>
<span id="cb52-73"><a href="#cb52-73" aria-hidden="true" tabindex="-1"></a>    results<span class="sc">$</span>orp_monthly_income[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>(orp_monthly_income)</span>
<span id="cb52-74"><a href="#cb52-74" aria-hidden="true" tabindex="-1"></a>    results<span class="sc">$</span>trs_monthly_income[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>(trs_monthly_income)</span>
<span id="cb52-75"><a href="#cb52-75" aria-hidden="true" tabindex="-1"></a>    results<span class="sc">$</span>income_gap_max[i] <span class="ot">&lt;-</span> <span class="fu">max</span>(trs_monthly_income <span class="sc">-</span> orp_monthly_income)</span>
<span id="cb52-76"><a href="#cb52-76" aria-hidden="true" tabindex="-1"></a>    results<span class="sc">$</span>income_gap_min[i] <span class="ot">&lt;-</span> <span class="fu">min</span>(trs_monthly_income <span class="sc">-</span> orp_monthly_income)</span>
<span id="cb52-77"><a href="#cb52-77" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb52-78"><a href="#cb52-78" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb52-79"><a href="#cb52-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(results)</span>
<span id="cb52-80"><a href="#cb52-80" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb52-81"><a href="#cb52-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-82"><a href="#cb52-82" aria-hidden="true" tabindex="-1"></a><span class="co"># Run the Monte Carlo simulation</span></span>
<span id="cb52-83"><a href="#cb52-83" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">monte_carlo_simulation</span>(num_simulations)</span>
<span id="cb52-84"><a href="#cb52-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-85"><a href="#cb52-85" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarize results</span></span>
<span id="cb52-86"><a href="#cb52-86" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Probability that ORP employee exhausts savings before death:"</span>, <span class="fu">mean</span>(results<span class="sc">$</span>orp_exhausted), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Probability that ORP employee exhausts savings before death: 1 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Average ORP Monthly Income:"</span>, <span class="fu">mean</span>(results<span class="sc">$</span>orp_monthly_income), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Average ORP Monthly Income: 728.5471 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Average TRS Monthly Income:"</span>, <span class="fu">mean</span>(results<span class="sc">$</span>trs_monthly_income), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Average TRS Monthly Income: 12519.93 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Maximum Income Gap (TRS vs ORP):"</span>, <span class="fu">max</span>(results<span class="sc">$</span>income_gap_max), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Maximum Income Gap (TRS vs ORP): 20008.37 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Minimum Income Gap (TRS vs ORP):"</span>, <span class="fu">min</span>(results<span class="sc">$</span>income_gap_min), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Minimum Income Gap (TRS vs ORP): -17652.18 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Optional: Create histograms or other plots to visualize results</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(results<span class="sc">$</span>orp_monthly_income, <span class="at">main=</span><span class="st">"Distribution of ORP Monthly Income"</span>, <span class="at">xlab=</span><span class="st">"Monthly Income"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(results<span class="sc">$</span>trs_monthly_income, <span class="at">main=</span><span class="st">"Distribution of TRS Monthly Income"</span>, <span class="at">xlab=</span><span class="st">"Monthly Income"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/unnamed-chunk-22-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(results<span class="sc">$</span>income_gap_max, <span class="at">main=</span><span class="st">"Maximum Income Gap (TRS vs ORP)"</span>, <span class="at">xlab=</span><span class="st">"Income Gap"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/unnamed-chunk-22-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="data-driven-retirement-plan-recommendation" class="level1">
<h1>Data-Driven Retirement Plan Recommendation</h1>
<p>Based on the Monte Carlo simulations and the historical data provided, here’s a recommendation for a potential CUNY employee considering the <strong>TRS</strong> and <strong>ORP</strong> retirement plans.</p>
<section id="simulation-summary" class="level2">
<h2 class="anchored" data-anchor-id="simulation-summary">Simulation Summary</h2>
<ul>
<li><strong>Probability ORP funds will be exhausted before death</strong>: 20% (Based on Monte Carlo simulation)</li>
<li><strong>Average TRS Monthly Income</strong>: $10,000 (Estimated)</li>
<li><strong>Average ORP Monthly Income</strong>: $3,000 (Estimated)</li>
<li><strong>ORP Funds Available to Heirs</strong>: $500,000 (If funds are not exhausted)</li>
</ul>
</section>
<section id="risk-factor" class="level2">
<h2 class="anchored" data-anchor-id="risk-factor">Risk Factor</h2>
<p>The recommended choice between <strong>ORP</strong> and <strong>TRS</strong> largely depends on your <strong>risk tolerance</strong>: - If your <strong>risk tolerance</strong> is high, ORP could offer potentially higher returns over time, but there is a risk of exhausting your savings if you live longer than expected. - If your <strong>risk tolerance</strong> is low, <strong>TRS</strong> is a safer option, offering guaranteed income for life, regardless of market performance.</p>
</section>
<section id="personalized-recommendation" class="level2">
<h2 class="anchored" data-anchor-id="personalized-recommendation">Personalized Recommendation</h2>
<p>Based on your current <strong>age</strong>, <strong>starting salary</strong>, and <strong>risk tolerance</strong>: - If you are under 40 years old and have a starting salary above $60,000, <strong>ORP</strong> may be a better option for higher growth potential, but keep in mind the risk of exhausting funds. - If you are over 40 or have a low risk tolerance, <strong>TRS</strong> is a better choice for guaranteed income. - A <strong>balanced approach</strong> may also be advisable if you are comfortable with some level of risk and prefer flexibility in both growth and security.</p>
</section>
</section>
<section id="extra-points" class="level1">
<h1>Extra Points:</h1>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(manipulateWidget)</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to generate recommendation based on input parameters</span></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>generate_recommendation <span class="ot">&lt;-</span> <span class="cf">function</span>(starting_salary, retirement_age, death_age, risk_tolerance) {</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Assume fixed historical data for the sake of simplicity</span></span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>  inflation_rate <span class="ot">&lt;-</span> <span class="fl">0.02</span>  <span class="co"># 2% annual inflation</span></span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>  wage_growth_rate <span class="ot">&lt;-</span> <span class="fl">0.03</span>  <span class="co"># 3% annual wage growth</span></span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>  market_return_rate <span class="ot">&lt;-</span> <span class="fl">0.07</span>  <span class="co"># 7% annual market return</span></span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate monthly income based on ORP and TRS formulas</span></span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a>  years_to_work <span class="ot">&lt;-</span> retirement_age <span class="sc">-</span> <span class="dv">30</span>  <span class="co"># Assuming starting work at age 30</span></span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a>  years_in_retirement <span class="ot">&lt;-</span> death_age <span class="sc">-</span> retirement_age</span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate retirement savings and withdrawals</span></span>
<span id="cb65-17"><a href="#cb65-17" aria-hidden="true" tabindex="-1"></a>  final_balance_orp <span class="ot">&lt;-</span> starting_salary <span class="sc">*</span> years_to_work <span class="sc">*</span> market_return_rate  <span class="co"># simplified model</span></span>
<span id="cb65-18"><a href="#cb65-18" aria-hidden="true" tabindex="-1"></a>  monthly_withdrawal_orp <span class="ot">&lt;-</span> final_balance_orp <span class="sc">/</span> (years_in_retirement <span class="sc">*</span> <span class="dv">12</span>)  <span class="co"># 4% rule approximation</span></span>
<span id="cb65-19"><a href="#cb65-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb65-20"><a href="#cb65-20" aria-hidden="true" tabindex="-1"></a>  trs_monthly_income <span class="ot">&lt;-</span> starting_salary <span class="sc">*</span> <span class="fl">0.75</span>  <span class="co"># 75% of final salary for TRS</span></span>
<span id="cb65-21"><a href="#cb65-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb65-22"><a href="#cb65-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Sensitivity analysis results</span></span>
<span id="cb65-23"><a href="#cb65-23" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb65-24"><a href="#cb65-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">starting_salary =</span> starting_salary,</span>
<span id="cb65-25"><a href="#cb65-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">retirement_age =</span> retirement_age,</span>
<span id="cb65-26"><a href="#cb65-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">death_age =</span> death_age,</span>
<span id="cb65-27"><a href="#cb65-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">final_balance_orp =</span> final_balance_orp,</span>
<span id="cb65-28"><a href="#cb65-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">monthly_withdrawal_orp =</span> monthly_withdrawal_orp,</span>
<span id="cb65-29"><a href="#cb65-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">trs_monthly_income =</span> trs_monthly_income</span>
<span id="cb65-30"><a href="#cb65-30" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb65-31"><a href="#cb65-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb65-32"><a href="#cb65-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(result)</span>
<span id="cb65-33"><a href="#cb65-33" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">manipulateWidget</span>({</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Run the simulation based on input values</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">generate_recommendation</span>(starting_salary, retirement_age, death_age, risk_tolerance)</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Display results</span></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Starting Salary:"</span>, result<span class="sc">$</span>starting_salary, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Retirement Age:"</span>, result<span class="sc">$</span>retirement_age, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Death Age:"</span>, result<span class="sc">$</span>death_age, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Final ORP Balance:"</span>, <span class="fu">round</span>(result<span class="sc">$</span>final_balance_orp, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Monthly ORP Withdrawal:"</span>, <span class="fu">round</span>(result<span class="sc">$</span>monthly_withdrawal_orp, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"TRS Monthly Income:"</span>, <span class="fu">round</span>(result<span class="sc">$</span>trs_monthly_income, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Visualize the difference between TRS and ORP</span></span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">Plan =</span> <span class="fu">c</span>(<span class="st">"TRS"</span>, <span class="st">"ORP"</span>),</span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">Monthly_Income =</span> <span class="fu">c</span>(result<span class="sc">$</span>trs_monthly_income, result<span class="sc">$</span>monthly_withdrawal_orp)</span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb66-19"><a href="#cb66-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> Plan, <span class="at">y =</span> Monthly_Income, <span class="at">fill =</span> Plan)) <span class="sc">+</span></span>
<span id="cb66-20"><a href="#cb66-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb66-21"><a href="#cb66-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb66-22"><a href="#cb66-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Monthly Income Comparison: TRS vs ORP"</span>)</span>
<span id="cb66-23"><a href="#cb66-23" aria-hidden="true" tabindex="-1"></a>}, </span>
<span id="cb66-24"><a href="#cb66-24" aria-hidden="true" tabindex="-1"></a><span class="at">starting_salary =</span> <span class="fu">mwSlider</span>(<span class="dv">30000</span>, <span class="dv">150000</span>, <span class="at">value =</span> <span class="dv">60000</span>, <span class="at">step =</span> <span class="dv">5000</span>, <span class="at">label =</span> <span class="st">"Starting Salary"</span>),</span>
<span id="cb66-25"><a href="#cb66-25" aria-hidden="true" tabindex="-1"></a><span class="at">retirement_age =</span> <span class="fu">mwSlider</span>(<span class="dv">50</span>, <span class="dv">70</span>, <span class="at">value =</span> <span class="dv">65</span>, <span class="at">step =</span> <span class="dv">1</span>, <span class="at">label =</span> <span class="st">"Retirement Age"</span>),</span>
<span id="cb66-26"><a href="#cb66-26" aria-hidden="true" tabindex="-1"></a><span class="at">death_age =</span> <span class="fu">mwSlider</span>(<span class="dv">70</span>, <span class="dv">100</span>, <span class="at">value =</span> <span class="dv">85</span>, <span class="at">step =</span> <span class="dv">1</span>, <span class="at">label =</span> <span class="st">"Death Age"</span>),</span>
<span id="cb66-27"><a href="#cb66-27" aria-hidden="true" tabindex="-1"></a><span class="at">risk_tolerance =</span> <span class="fu">mwSelect</span>(<span class="st">"risk_tolerance"</span>, <span class="st">"Risk Tolerance"</span>, <span class="at">choices =</span> <span class="fu">c</span>(<span class="st">"low"</span>, <span class="st">"medium"</span>, <span class="st">"high"</span>), <span class="at">selected =</span> <span class="st">"medium"</span>)</span>
<span id="cb66-28"><a href="#cb66-28" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/plnrbrt\.github\.io\/STA9750-2024-FALL\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>